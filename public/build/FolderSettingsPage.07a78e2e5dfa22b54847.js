"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4827],{"./public/app/features/folders/FolderSettingsPage.tsx":(e,s,t)=>{t.r(s),t.d(s,{FolderSettingsPage:()=>y,default:()=>S});var a,i,r=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),n=t("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/0/cache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),o=t("./packages/grafana-ui/src/index.ts"),d=t("./public/app/core/components/Page/Page.tsx"),l=t("./public/app/core/app_events.ts"),c=t("./public/app/core/selectors/navModel.ts"),p=t("./public/app/features/folders/state/actions.ts"),u=t("./public/app/features/folders/state/navModel.ts"),f=t("./public/app/features/folders/state/reducers.ts"),h=t("./public/app/types/events.ts"),m=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");function g(e,s,t){return s in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}const{Input:v}=o.LegacyForms,b={getFolderByUid:p.Pb,saveFolder:p.OD,setFolderTitle:f.Ss,deleteFolder:p.Go},x=(0,n.connect)(((e,s)=>{const t=s.match.params.uid;return{navModel:(0,c.h)(e.navIndex,`folder-settings-${t}`,(0,u._)(2)),folderUid:t,folder:e.folder}}),b);class y extends r.PureComponent{constructor(e){super(e),g(this,"onTitleChange",(e=>{this.props.setFolderTitle(e.target.value)})),g(this,"onSave",(async e=>{e.preventDefault(),e.stopPropagation(),this.setState({isLoading:!0}),await this.props.saveFolder(this.props.folder),this.setState({isLoading:!1})})),g(this,"onDelete",(e=>{e.stopPropagation(),e.preventDefault();l.Z.publish(new h.VJ({title:"Delete",text:"Do you want to delete this folder and all its dashboards and alerts?",icon:"trash-alt",yesText:"Delete",onConfirm:()=>{this.props.deleteFolder(this.props.folder.uid)}}))})),this.state={isLoading:!1}}componentDidMount(){this.props.getFolderByUid(this.props.folderUid)}render(){const{navModel:e,folder:s}=this.props;return(0,m.jsx)(d.Z,{navModel:e,children:(0,m.jsxs)(d.Z.Contents,{isLoading:this.state.isLoading,children:[a||(a=(0,m.jsx)("h3",{className:"page-sub-heading",children:"Folder settings"})),(0,m.jsx)("div",{className:"section gf-form-group",children:(0,m.jsxs)("form",{name:"folderSettingsForm",onSubmit:this.onSave,children:[(0,m.jsxs)("div",{className:"gf-form",children:[i||(i=(0,m.jsx)("label",{className:"gf-form-label width-7",children:"Name"})),(0,m.jsx)(v,{type:"text",className:"gf-form-input width-30",value:s.title,onChange:this.onTitleChange})]}),(0,m.jsxs)("div",{className:"gf-form-button-row",children:[(0,m.jsx)(o.Button,{type:"submit",disabled:!s.canSave||!s.hasChanged,children:"Save"}),(0,m.jsx)(o.Button,{variant:"destructive",onClick:this.onDelete,disabled:!s.canSave,children:"Delete"})]})]})})]})})}}const S=x(y)},"./public/app/features/folders/state/actions.ts":(e,s,t)=>{t.d(s,{Pb:()=>c,OD:()=>p,Go:()=>u,a:()=>f,v7:()=>m,Uk:()=>g,pz:()=>v,W7:()=>b});var a=t("./packages/grafana-data/src/index.ts"),i=t("./packages/grafana-runtime/src/index.ts"),r=t("./public/app/core/services/backend_srv.ts"),n=t("./public/app/core/actions/index.ts"),o=t("./public/app/features/folders/state/navModel.ts"),d=t("./public/app/core/app_events.ts"),l=t("./public/app/features/folders/state/reducers.ts");function c(e){return async s=>{const t=await r.ae.getFolderByUid(e);s((0,l.G3)(t)),s((0,n.RL)((0,o.B)(t)))}}function p(e){return async s=>{const t=await r.ae.put(`/api/folders/${e.uid}`,{title:e.title,version:e.version});d.Z.emit(a.AppEvents.alertSuccess,["Folder saved"]),i.locationService.push(`${t.url}/settings`)}}function u(e){return async()=>{await r.ae.delete(`/api/folders/${e}?forceDeleteRules=false`),i.locationService.push("/dashboards")}}function f(e){return async s=>{const t=await r.ae.get(`/api/folders/${e}/permissions`);s((0,l.R7)(t))}}function h(e){return{userId:e.userId,teamId:e.teamId,role:e.role,permission:e.permission}}function m(e,s){return async(t,a)=>{const i=a().folder,n=[];for(const t of i.permissions){if(t.inherited)continue;const a=h(t);e===t&&(a.permission=s),n.push(a)}await r.ae.post(`/api/folders/${i.uid}/permissions`,{items:n}),await t(f(i.uid))}}function g(e){return async(s,t)=>{const a=t().folder,i=[];for(const s of a.permissions)s.inherited||s===e||i.push(h(s));await r.ae.post(`/api/folders/${a.uid}/permissions`,{items:i}),await s(f(a.uid))}}function v(e){return async(s,t)=>{const a=t().folder,i=[];for(const e of a.permissions)e.inherited||i.push(h(e));i.push({userId:e.userId,teamId:e.teamId,role:e.role,permission:e.permission}),await r.ae.post(`/api/folders/${a.uid}/permissions`,{items:i}),await s(f(a.uid))}}function b(e){return async()=>{const s=await(0,i.getBackendSrv)().post("/api/folders",{title:e});d.Z.emit(a.AppEvents.alertSuccess,["Folder Created","OK"]),i.locationService.push(a.locationUtil.stripBaseFromUrl(s.url))}}},"./public/app/features/folders/state/navModel.ts":(e,s,t)=>{function a(e){const s={icon:"folder",id:"manage-folder",subTitle:"Manage folder dashboards and permissions",url:"",text:e.title,breadcrumbs:[{title:"Dashboards",url:"dashboards"}],children:[{active:!1,icon:"apps",id:`folder-dashboards-${e.uid}`,text:"Dashboards",url:e.url}]};return s.children.push({active:!1,icon:"library-panel",id:`folder-library-panels-${e.uid}`,text:"Panels",url:`${e.url}/library-panels`}),e.canAdmin&&s.children.push({active:!1,icon:"lock",id:`folder-permissions-${e.uid}`,text:"Permissions",url:`${e.url}/permissions`}),e.canSave&&s.children.push({active:!1,icon:"cog",id:`folder-settings-${e.uid}`,text:"Settings",url:`${e.url}/settings`}),s}function i(e){const s=a({id:1,uid:"loading",title:"Loading",url:"url",canSave:!0,canEdit:!0,canAdmin:!0,version:0});return s.children[e].active=!0,{main:s,node:s.children[e]}}t.d(s,{B:()=>a,_:()=>i})}}]);
//# sourceMappingURL=FolderSettingsPage.07a78e2e5dfa22b54847.js.map