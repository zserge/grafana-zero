"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8648],{"./public/app/core/hooks/useCleanup.ts":(e,a,t)=>{t.d(a,{x:()=>i});var n=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),r=t("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/0/cache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),l=t("./public/app/core/actions/cleanUp.ts");function i(e){const a=(0,r.useDispatch)(),t=(0,n.useRef)(e);t.current=e,(0,n.useEffect)((()=>()=>{a((0,l.e)({stateSelector:t.current}))}),[a])}},"./public/app/core/hooks/useQueryParams.ts":(e,a,t)=>{t.d(a,{K:()=>i});var n=t("./packages/grafana-runtime/src/index.ts"),r=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),l=t("./.yarn/__virtual__/react-router-virtual-31642fe47a/0/cache/react-router-npm-5.2.1-ea754d7473-7daae084bf.zip/node_modules/react-router/esm/react-router.js");function i(){const{search:e}=(0,l.TH)();return[(0,r.useMemo)((()=>(0,n.locationSearchToObject)(e||"")),[e]),(0,r.useCallback)(((e,a)=>setImmediate((()=>n.locationService.partial(e,a)))),[])]}},"./public/app/features/alerting/unified/AmRoutes.tsx":(e,a,t)=>{t.r(a),t.d(a,{default:()=>_e});var n=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),r=t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),l=t("./packages/grafana-ui/src/index.ts"),i=t("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/0/cache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),s=t("./.yarn/__virtual__/react-router-virtual-31642fe47a/0/cache/react-router-npm-5.2.1-ea754d7473-7daae084bf.zip/node_modules/react-router/esm/react-router.js"),o=t("./public/app/core/hooks/useCleanup.ts"),c=t("./public/app/features/alerting/unified/components/AlertingPageWrapper.tsx"),d=t("./public/app/features/alerting/unified/components/AlertManagerPicker.tsx"),u=t("./public/app/plugins/datasource/alertmanager/types.ts"),p=t("./public/app/features/alerting/unified/utils/time.ts"),m=t("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),g=t("./public/app/features/alerting/unified/utils/alertmanager.ts"),v=t("./public/app/features/alerting/unified/utils/datasource.ts");const h=["",p.qr[0].value],x=(e,a)=>Object.entries(null!=e?e:{}).reduce(((e,t)=>{let[n,r]=t;return[...e,{name:n,value:r,operator:a?u._M.regex:u._M.equal}]}),[]),f=e=>{if(!e)return h;const[a,t]=e?(0,p.bG)(e):[void 0,void 0],n=p.qr.find((e=>e.value===t));return a&&n?[String(a),n.value]:h},b=e=>e.value,j={name:"",value:"",operator:u._M.equal},y={id:"",groupBy:[],object_matchers:[],routes:[],continue:!1,receiver:"",groupWaitValue:"",groupWaitValueType:p.qr[0].value,groupIntervalValue:"",groupIntervalValueType:p.qr[0].value,repeatIntervalValue:"",repeatIntervalValueType:p.qr[0].value},C=e=>{var a,t,n,r,l,i,s,o;if(!e||0===Object.keys(e).length)return[y,{}];const[c,d]=f(e.group_wait),[u,p]=f(e.group_interval),[m,v]=f(e.repeat_interval),h=String(Math.random()),b={[h]:e},j=[];null===(a=e.routes)||void 0===a||a.forEach((e=>{const[a,t]=C(e);j.push(a),Object.assign(b,t)}));return[{id:h,object_matchers:[...e.matchers?null!==(t=null===(n=e.matchers)||void 0===n?void 0:n.map((e=>(0,g.cm)((0,g.tC)(e)))))&&void 0!==t?t:[]:null!==(r=null===(l=e.object_matchers)||void 0===l?void 0:l.map((e=>({name:e[0],operator:e[1],value:e[2]}))))&&void 0!==r?r:[],...x(e.match,!1),...x(e.match_re,!0)],continue:null!==(i=e.continue)&&void 0!==i&&i,receiver:null!==(s=e.receiver)&&void 0!==s?s:"",groupBy:null!==(o=e.group_by)&&void 0!==o?o:[],groupWaitValue:c,groupWaitValueType:d,groupIntervalValue:u,groupIntervalValueType:p,repeatIntervalValue:m,repeatIntervalValueType:v,routes:j},b]},$=(e,a,t)=>{const n=t[a.id],r=Object.assign({},null!=n?n:{},{continue:a.continue,group_by:a.groupBy,object_matchers:a.object_matchers.length?a.object_matchers.map((e=>[e.name,e.operator,e.value])):void 0,match:void 0,match_re:void 0,group_wait:a.groupWaitValue?`${a.groupWaitValue}${a.groupWaitValueType}`:void 0,group_interval:a.groupIntervalValue?`${a.groupIntervalValue}${a.groupIntervalValueType}`:void 0,repeat_interval:a.repeatIntervalValue?`${a.repeatIntervalValue}${a.repeatIntervalValueType}`:void 0,routes:a.routes.map((a=>$(e,a,t)))});return e!==v.GC?(r.matchers=a.object_matchers.map((e=>{let{name:a,operator:t,value:n}=e;return`${a}${t}${n}`})),r.object_matchers=void 0):r.matchers=void 0,a.receiver&&(r.receiver=a.receiver),(0,m.omitBy)(r,m.isUndefined)},I=e=>({label:e,value:e}),S=e=>(null!=e?e:[]).map(I),_=e=>{var a;return e&&null!==(a=b(e))&&void 0!==a?a:""},N=e=>{return e?(null!=(a=e)?a:[]).map(b):[];var a},w=e=>{if(e)return/^\d+$/.test(e)?void 0:"Must be a positive integer."};var V=t("./public/app/features/alerting/unified/utils/misc.ts");const k=e=>({container:r.css`
      align-items: center;
      display: flex;
      flex-flow: row nowrap;

      & > * + * {
        margin-left: ${e.spacing(1)};
      }
    `,input:r.css`
      flex: 1;
    `,timingContainer:r.css`
      max-width: ${e.spacing(33)};
    `,smallInput:r.css`
      width: ${e.spacing(6.5)};
    `,linkText:r.css`
      text-decoration: underline;
    `,collapse:r.css`
      border: none;
      background: none;
      color: ${e.colors.text.primary};
    `});var O,B,M=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const T=["onChange","ref"],z=["onChange","ref"],E=["onChange","ref"],F=["onChange","ref"],G=["onChange","ref"];function R(e,a){if(null==e)return{};var t,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)t=l[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}const W=e=>{var a;let{alertManagerSourceName:t,onCancel:i,onSave:s,receivers:o,routes:c}=e;const d=(0,l.useStyles2)(k),[u,m]=(0,n.useState)(!1),[g,v]=(0,n.useState)(S(c.groupBy));return(0,M.jsx)(l.Form,{defaultValues:c,onSubmit:s,children:e=>{var n,s,c,h;let{control:x,errors:f,setValue:b}=e;return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(l.Field,{label:"Default contact point",invalid:!!f.receiver,error:null===(n=f.receiver)||void 0===n?void 0:n.message,children:(0,M.jsx)(M.Fragment,{children:(0,M.jsxs)("div",{className:d.container,"data-testid":"am-receiver-select",children:[(0,M.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=R(e.field,T);return(0,M.jsx)(l.Select,Object.assign({"aria-label":"Default contact point"},t,{className:d.input,onChange:e=>a(_(e)),options:o,menuShouldPortal:!0}))},control:x,name:"receiver",rules:{required:{value:!0,message:"Required."}}}),O||(O=(0,M.jsx)("span",{children:"or"})),(0,M.jsx)(l.Link,{className:d.linkText,href:(0,V.eQ)("/alerting/notifications/receivers/new",t),children:"Create a contact point"})]})})}),(0,M.jsx)(l.Field,{label:"Group by",description:"Group alerts when you receive a notification based on labels.","data-testid":"am-group-select",children:(0,M.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=R(e.field,z);return(0,M.jsx)(l.MultiSelect,Object.assign({"aria-label":"Group by",menuShouldPortal:!0},t,{allowCustomValue:!0,className:d.input,onCreateOption:e=>{v((a=>[...a,I(e)])),b("groupBy",[...t.value,e])},onChange:e=>a(N(e)),options:g}))},control:x,name:"groupBy"})}),(0,M.jsxs)(l.Collapse,{collapsible:!0,className:d.collapse,isOpen:u,label:"Timing options",onToggle:m,children:[(0,M.jsx)(l.Field,{label:"Group wait",description:"The waiting time until the initial notification is sent for a new group created by an incoming alert. Default 30 seconds.",invalid:!!f.groupWaitValue,error:null===(s=f.groupWaitValue)||void 0===s?void 0:s.message,"data-testid":"am-group-wait",children:(0,M.jsx)(M.Fragment,{children:(0,M.jsxs)("div",{className:(0,r.cx)(d.container,d.timingContainer),children:[(0,M.jsx)(l.InputControl,{render:e=>{let{field:a,fieldState:{invalid:t}}=e;return(0,M.jsx)(l.Input,Object.assign({},a,{className:d.smallInput,invalid:t,placeholder:"Default 30 seconds"}))},control:x,name:"groupWaitValue",rules:{validate:w}}),(0,M.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=R(e.field,E);return(0,M.jsx)(l.Select,Object.assign({menuShouldPortal:!0},t,{className:d.input,onChange:e=>a(_(e)),options:p.qr,"aria-label":"Group wait type"}))},control:x,name:"groupWaitValueType"})]})})}),(0,M.jsx)(l.Field,{label:"Group interval",description:"The waiting time to send a batch of new alerts for that group after the first notification was sent. Default 5 minutes.",invalid:!!f.groupIntervalValue,error:null===(c=f.groupIntervalValue)||void 0===c?void 0:c.message,"data-testid":"am-group-interval",children:(0,M.jsx)(M.Fragment,{children:(0,M.jsxs)("div",{className:(0,r.cx)(d.container,d.timingContainer),children:[(0,M.jsx)(l.InputControl,{render:e=>{let{field:a,fieldState:{invalid:t}}=e;return(0,M.jsx)(l.Input,Object.assign({},a,{className:d.smallInput,invalid:t,placeholder:"Default 5 minutes"}))},control:x,name:"groupIntervalValue",rules:{validate:w}}),(0,M.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=R(e.field,F);return(0,M.jsx)(l.Select,Object.assign({menuShouldPortal:!0},t,{className:d.input,onChange:e=>a(_(e)),options:p.qr,"aria-label":"Group interval type"}))},control:x,name:"groupIntervalValueType"})]})})}),(0,M.jsx)(l.Field,{label:"Repeat interval",description:"The waiting time to resend an alert after they have successfully been sent. Default 4 hours.",invalid:!!f.repeatIntervalValue,error:null===(h=f.repeatIntervalValue)||void 0===h?void 0:h.message,"data-testid":"am-repeat-interval",children:(0,M.jsx)(M.Fragment,{children:(0,M.jsxs)("div",{className:(0,r.cx)(d.container,d.timingContainer),children:[(0,M.jsx)(l.InputControl,{render:e=>{let{field:a,fieldState:{invalid:t}}=e;return(0,M.jsx)(l.Input,Object.assign({},a,{className:d.smallInput,invalid:t,placeholder:"Default 4 hours"}))},control:x,name:"repeatIntervalValue",rules:{validate:w}}),(0,M.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=R(e.field,G);return(0,M.jsx)(l.Select,Object.assign({menuShouldPortal:!0},t,{className:d.input,menuPlacement:"top",onChange:e=>a(_(e)),options:p.qr,"aria-label":"Repeat interval type"}))},control:x,name:"repeatIntervalValueType"})]})})})]}),(0,M.jsxs)("div",{className:d.container,children:[B||(B=(0,M.jsx)(l.Button,{type:"submit",children:"Save"})),a||(a=(0,M.jsx)(l.Button,{onClick:i,type:"reset",variant:"secondary",fill:"outline",children:"Cancel"}))]})]})}})},A=e=>({container:r.css`
      display: grid;
      font-style: ${e.typography.fontSize};
      grid-template-columns: ${e.spacing(15.5)} auto;

      ${e.breakpoints.down("md")} {
        grid-template-columns: 100%;
      }
    `,titleCell:r.css`
      color: ${e.colors.text.primary};
    `,valueCell:r.css`
      color: ${e.colors.text.secondary};
      margin-bottom: ${e.spacing(1)};
    `}),P=e=>{let{routes:a}=e;const t=(0,l.useStyles2)(A),n=a.receiver||"-",r=a.groupBy.join(", ")||"-",i=a.groupWaitValue?`${a.groupWaitValue}${a.groupWaitValueType}`:"-",s=a.groupIntervalValue?`${a.groupIntervalValue}${a.groupIntervalValueType}`:"-",o=a.repeatIntervalValue?`${a.repeatIntervalValue}${a.repeatIntervalValueType}`:"-";return(0,M.jsxs)("div",{className:t.container,children:[(0,M.jsx)("div",{className:t.titleCell,children:"Contact point"}),(0,M.jsx)("div",{className:t.valueCell,"data-testid":"am-routes-root-receiver",children:n}),(0,M.jsx)("div",{className:t.titleCell,children:"Group by"}),(0,M.jsx)("div",{className:t.valueCell,"data-testid":"am-routes-root-group-by",children:r}),(0,M.jsx)("div",{className:t.titleCell,children:"Timings"}),(0,M.jsxs)("div",{className:t.valueCell,"data-testid":"am-routes-root-timings",children:["Group wait: ",i," | Group interval: ",s," | Repeat interval: ",o]})]})};var q,D;const L=e=>{let{isEditMode:a,onSave:t,onEnterEditMode:n,onExitEditMode:r,receivers:i,routes:s,alertManagerSourceName:o}=e;const c=(0,l.useStyles2)(Y),d=(0,v.RY)(o);return(0,M.jsxs)("div",{className:c.container,"data-testid":"am-root-route-container",children:[(0,M.jsxs)("div",{className:c.titleContainer,children:[(0,M.jsxs)("h5",{className:c.title,children:["Root policy - ",q||(q=(0,M.jsx)("i",{children:"default for all alerts"}))]}),!a&&!d&&(0,M.jsx)(l.Button,{icon:"pen",onClick:n,size:"sm",type:"button",variant:"secondary",children:"Edit"})]}),D||(D=(0,M.jsx)("p",{children:"All alerts will go to the default contact point, unless you set additional matchers in the specific routing area."})),a?(0,M.jsx)(W,{alertManagerSourceName:o,onCancel:r,onSave:t,receivers:i,routes:s}):(0,M.jsx)(P,{routes:s})]})},Y=e=>({container:r.css`
      background-color: ${e.colors.background.secondary};
      color: ${e.colors.text.secondary};
      padding: ${e.spacing(2)};
    `,titleContainer:r.css`
      color: ${e.colors.text.primary};
      display: flex;
      flex-flow: row nowrap;
    `,title:r.css`
      flex: 100%;
    `}),Z=e=>{let{children:a}=e;const t=(0,l.useStyles)(H);return(0,M.jsx)("div",{className:t.container,children:a})},H=e=>({container:r.css`
      background-color: ${e.colors.bg2};
      color: ${e.colors.textSemiWeak};
      padding: ${e.spacing.xl};
      text-align: center;
    `});var U=t("./public/app/features/alerting/unified/components/DynamicTable.tsx");const J=["onChange","ref"],K=["onChange","ref"],Q=["onChange","ref"],X=["onChange","ref"],ee=["onChange","ref"],ae=["onChange","ref"];var te,ne;function re(e,a){if(null==e)return{};var t,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)t=l[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}const le=e=>{var a;let{onCancel:t,onSave:i,receivers:s,routes:o}=e;const c=(0,l.useStyles2)(ie),d=(0,l.useStyles2)(k),[u,m]=(0,n.useState)(o.groupBy.length>0),[v,h]=(0,n.useState)(!!o.groupWaitValue||!!o.groupIntervalValue||!!o.repeatIntervalValue),[x,f]=(0,n.useState)(S(o.groupBy));return(0,M.jsx)(l.Form,{defaultValues:o,onSubmit:i,children:e=>{var n,i,o;let{control:b,register:y,errors:C,setValue:$}=e;return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("input",Object.assign({type:"hidden"},y("id"))),(0,M.jsx)(l.FieldArray,{name:"object_matchers",control:b,children:e=>{let{fields:a,append:t,remove:n}=e;return(0,M.jsxs)(M.Fragment,{children:[te||(te=(0,M.jsx)("div",{children:"Matching labels"})),(0,M.jsx)("div",{className:c.matchersContainer,children:a.map(((e,a)=>{var t,r,i,s,o,d,u,p,m,v;const h=`object_matchers[${a}]`;return(0,M.jsxs)(l.HorizontalGroup,{align:"flex-start",children:[(0,M.jsx)(l.Field,{label:"Label",invalid:!(null===(t=C.object_matchers)||void 0===t||null===(r=t[a])||void 0===r||!r.name),error:null===(i=C.object_matchers)||void 0===i||null===(s=i[a])||void 0===s||null===(o=s.name)||void 0===o?void 0:o.message,children:(0,M.jsx)(l.Input,Object.assign({},y(`${h}.name`,{required:"Field is required"}),{defaultValue:e.name,placeholder:"label"}))}),(0,M.jsx)(l.Field,{label:"Operator",children:(0,M.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=re(e.field,J);return(0,M.jsx)(l.Select,Object.assign({},t,{className:c.matchersOperator,onChange:e=>a(null==e?void 0:e.value),options:g.tA,"aria-label":"Operator"}))},defaultValue:e.operator,control:b,name:`${h}.operator`,rules:{required:{value:!0,message:"Required."}}})}),(0,M.jsx)(l.Field,{label:"Value",invalid:!(null===(d=C.object_matchers)||void 0===d||null===(u=d[a])||void 0===u||!u.value),error:null===(p=C.object_matchers)||void 0===p||null===(m=p[a])||void 0===m||null===(v=m.value)||void 0===v?void 0:v.message,children:(0,M.jsx)(l.Input,Object.assign({},y(`${h}.value`,{required:"Field is required"}),{defaultValue:e.value,placeholder:"value"}))}),(0,M.jsx)(l.IconButton,{className:c.removeButton,tooltip:"Remove matcher",name:"trash-alt",onClick:()=>n(a),children:"Remove"})]},e.id)}))}),(0,M.jsx)(l.Button,{className:c.addMatcherBtn,icon:"plus",onClick:()=>t(j),variant:"secondary",type:"button",children:"Add matcher"})]})}}),(0,M.jsx)(l.Field,{label:"Contact point",children:(0,M.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=re(e.field,K);return(0,M.jsx)(l.Select,Object.assign({"aria-label":"Contact point"},t,{className:d.input,onChange:e=>a(_(e)),options:s,menuShouldPortal:!0}))},control:b,name:"receiver"})}),(0,M.jsx)(l.Field,{label:"Continue matching subsequent sibling nodes",children:(0,M.jsx)(l.Switch,Object.assign({id:"continue-toggle"},y("continue")))}),(0,M.jsx)(l.Field,{label:"Override grouping",children:(0,M.jsx)(l.Switch,{id:"override-grouping-toggle",value:u,onChange:()=>m((e=>!e))})}),u&&(0,M.jsx)(l.Field,{label:"Group by",description:"Group alerts when you receive a notification based on labels.",children:(0,M.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=re(e.field,Q);return(0,M.jsx)(l.MultiSelect,Object.assign({"aria-label":"Group by",menuShouldPortal:!0},t,{allowCustomValue:!0,className:d.input,onCreateOption:e=>{f((a=>[...a,I(e)])),$("groupBy",[...t.value,e])},onChange:e=>a(N(e)),options:x}))},control:b,name:"groupBy"})}),(0,M.jsx)(l.Field,{label:"Override general timings",children:(0,M.jsx)(l.Switch,{id:"override-timings-toggle",value:v,onChange:()=>h((e=>!e))})}),v&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(l.Field,{label:"Group wait",description:"The waiting time until the initial notification is sent for a new group created by an incoming alert.",invalid:!!C.groupWaitValue,error:null===(n=C.groupWaitValue)||void 0===n?void 0:n.message,children:(0,M.jsx)(M.Fragment,{children:(0,M.jsxs)("div",{className:(0,r.cx)(d.container,d.timingContainer),children:[(0,M.jsx)(l.InputControl,{render:e=>{let{field:a,fieldState:{invalid:t}}=e;return(0,M.jsx)(l.Input,Object.assign({},a,{className:d.smallInput,invalid:t,placeholder:"Time","aria-label":"Group wait value"}))},control:b,name:"groupWaitValue",rules:{validate:w}}),(0,M.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=re(e.field,X);return(0,M.jsx)(l.Select,Object.assign({menuShouldPortal:!0},t,{className:d.input,onChange:e=>a(_(e)),options:p.qr,"aria-label":"Group wait type"}))},control:b,name:"groupWaitValueType"})]})})}),(0,M.jsx)(l.Field,{label:"Group interval",description:"The waiting time to send a batch of new alerts for that group after the first notification was sent.",invalid:!!C.groupIntervalValue,error:null===(i=C.groupIntervalValue)||void 0===i?void 0:i.message,children:(0,M.jsx)(M.Fragment,{children:(0,M.jsxs)("div",{className:(0,r.cx)(d.container,d.timingContainer),children:[(0,M.jsx)(l.InputControl,{render:e=>{let{field:a,fieldState:{invalid:t}}=e;return(0,M.jsx)(l.Input,Object.assign({},a,{className:d.smallInput,invalid:t,placeholder:"Time","aria-label":"Group interval value"}))},control:b,name:"groupIntervalValue",rules:{validate:w}}),(0,M.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=re(e.field,ee);return(0,M.jsx)(l.Select,Object.assign({menuShouldPortal:!0},t,{className:d.input,onChange:e=>a(_(e)),options:p.qr,"aria-label":"Group interval type"}))},control:b,name:"groupIntervalValueType"})]})})}),(0,M.jsx)(l.Field,{label:"Repeat interval",description:"The waiting time to resend an alert after they have successfully been sent.",invalid:!!C.repeatIntervalValue,error:null===(o=C.repeatIntervalValue)||void 0===o?void 0:o.message,children:(0,M.jsx)(M.Fragment,{children:(0,M.jsxs)("div",{className:(0,r.cx)(d.container,d.timingContainer),children:[(0,M.jsx)(l.InputControl,{render:e=>{let{field:a,fieldState:{invalid:t}}=e;return(0,M.jsx)(l.Input,Object.assign({},a,{className:d.smallInput,invalid:t,placeholder:"Time","aria-label":"Repeat interval value"}))},control:b,name:"repeatIntervalValue",rules:{validate:w}}),(0,M.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=re(e.field,ae);return(0,M.jsx)(l.Select,Object.assign({menuShouldPortal:!0},t,{className:d.input,menuPlacement:"top",onChange:e=>a(_(e)),options:p.qr,"aria-label":"Repeat interval type"}))},control:b,name:"repeatIntervalValueType"})]})})})]}),(0,M.jsxs)("div",{className:c.buttonGroup,children:[ne||(ne=(0,M.jsx)(l.Button,{type:"submit",children:"Save policy"})),a||(a=(0,M.jsx)(l.Button,{onClick:t,fill:"outline",type:"button",variant:"secondary",children:"Cancel"}))]})]})}})},ie=e=>{const a=e.spacing(3.5);return{addMatcherBtn:r.css`
      margin-bottom: ${a};
    `,matchersContainer:r.css`
      background-color: ${e.colors.background.secondary};
      margin: ${e.spacing(1,0)};
      padding: ${e.spacing(1,4.6,1,1.5)};
      width: fit-content;
    `,matchersOperator:r.css`
      min-width: 140px;
    `,nestedPolicies:r.css`
      margin-top: ${a};
    `,removeButton:r.css`
      margin-left: ${e.spacing(1)};
      margin-top: ${e.spacing(2.5)};
    `,buttonGroup:r.css`
      margin: ${e.spacing(6)} 0 ${a};

      & > * + * {
        margin-left: ${e.spacing(1.5)};
      }
    `}};var se;const oe=e=>{let{onChange:a,receivers:t,routes:r,readOnly:i=!1}=e;const s=(0,l.useStyles2)(ce),o=(0,l.useStyles2)(A),c=r.groupWaitValue?`${r.groupWaitValue}${r.groupWaitValueType}`:"-",d=r.groupIntervalValue?`${r.groupIntervalValue}${r.groupIntervalValueType}`:"-",u=r.repeatIntervalValue?`${r.repeatIntervalValue}${r.repeatIntervalValueType}`:"-",[p,m]=(0,n.useState)(r.routes),[g,v]=(0,n.useState)(!1);return(0,M.jsxs)("div",{className:o.container,children:[(0,M.jsx)("div",{className:o.titleCell,children:"Group wait"}),(0,M.jsx)("div",{className:o.valueCell,children:c}),(0,M.jsx)("div",{className:o.titleCell,children:"Group interval"}),(0,M.jsx)("div",{className:o.valueCell,children:d}),(0,M.jsx)("div",{className:o.titleCell,children:"Repeat interval"}),(0,M.jsx)("div",{className:o.valueCell,children:u}),(0,M.jsx)("div",{className:o.titleCell,children:"Nested policies"}),(0,M.jsxs)("div",{className:o.valueCell,children:[p.length?(0,M.jsx)(ue,{isAddMode:g,onCancelAdd:()=>{v(!1),m((e=>{const a=[...e];return a.pop(),a}))},onChange:e=>{a(Object.assign({},r,{routes:e})),g&&v(!1)},receivers:t,routes:p}):se||(se=(0,M.jsx)("p",{children:"No nested policies configured."})),!g&&!i&&(0,M.jsx)(l.Button,{className:s.addNestedRoutingBtn,icon:"plus",onClick:()=>{m((e=>[...e,y])),v(!0)},variant:"secondary",type:"button",children:"Add nested policy"})]})]})},ce=e=>({addNestedRoutingBtn:r.css`
      margin-top: ${e.spacing(2)};
    `});var de=t("./public/app/features/alerting/unified/components/silences/Matchers.tsx");const ue=e=>{let{isAddMode:a,onCancelAdd:t,onChange:r,receivers:i,routes:s,readOnly:o=!1}=e;const[c,d]=(0,n.useState)(!1),[u,p]=(0,n.useState)(),m=(0,n.useCallback)((e=>p(e.id)),[]),v=(0,n.useCallback)((()=>p(void 0)),[]),h=[{id:"matchingCriteria",label:"Matching labels",renderCell:e=>(0,M.jsx)(de.g,{matchers:e.data.object_matchers.map(g._J)}),size:10},{id:"groupBy",label:"Group by",renderCell:e=>e.data.groupBy.join(", ")||"-",size:5},{id:"receiverChannel",label:"Contact point",renderCell:e=>e.data.receiver||"-",size:5},...o?[]:[{id:"actions",label:"Actions",renderCell:(e,a)=>{if(e.renderExpandedContent)return null;return(0,M.jsxs)(l.HorizontalGroup,{children:[(0,M.jsx)(l.Button,{"aria-label":"Edit route",icon:"pen",onClick:()=>{m(e),d(!0)},size:"sm",type:"button",variant:"secondary",children:"Edit"}),(0,M.jsx)(l.IconButton,{"aria-label":"Delete route",name:"trash-alt",onClick:()=>{const e=[...s];e.splice(a,1),r(e)},type:"button"})]})},size:"100px"}]],x=(0,n.useMemo)((()=>((e,a)=>e.map(((e,t)=>{var n;return{id:null!==(n=null==a?void 0:a(e))&&void 0!==n?n:t,data:e}})))(s)),[s]);return(0,n.useEffect)((()=>{a&&x.length&&p(x[x.length-1].id)}),[a,x]),(0,M.jsx)(U.t,{cols:h,isExpandable:!0,items:x,testIdGenerator:()=>"am-routes-row",onCollapse:v,onExpand:m,isExpanded:e=>u===e.id,renderExpandedContent:(e,n)=>a||c?(0,M.jsx)(le,{onCancel:()=>{a&&t(),d(!1)},onSave:e=>{const a=[...s];a[n]=Object.assign({},a[n],e),d(!1),r(a)},receivers:i,routes:e.data}):(0,M.jsx)(oe,{onChange:a=>{const t=[...s];t[n]=Object.assign({},e.data,a),r(t)},receivers:i,routes:e.data,readOnly:o})})},pe=e=>{let{buttonIcon:a,buttonLabel:t,buttonSize:n="lg",buttonVariant:r="primary",onButtonClick:i,text:s}=e;const o=(0,l.useStyles)(me);return(0,M.jsx)(Z,{children:(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("p",{className:o.text,children:s}),(0,M.jsx)(l.Button,{className:o.button,icon:a,onClick:i,size:n,type:"button",variant:r,children:t})]})})},me=e=>({container:r.css`
      background-color: ${e.colors.bg2};
      color: ${e.colors.textSemiWeak};
      padding: ${e.spacing.xl};
      text-align: center;
    `,text:r.css`
      margin-bottom: ${e.spacing.md};
    `,button:r.css`
      margin: ${e.spacing.md} 0 ${e.spacing.sm};
    `});var ge,ve,he,xe;const fe=e=>{let{onChange:a,onRootRouteEdit:t,receivers:r,routes:i,readOnly:s=!1}=e;const[o,c]=(0,n.useState)(i.routes),[d,u]=(0,n.useState)(!1),p=(0,l.useStyles2)(be),m=()=>{u(!0),c((e=>[...e,Object.assign({},y,{matchers:[j]})]))};return(0,M.jsxs)("div",{className:p.container,children:[ge||(ge=(0,M.jsx)("h5",{children:"Specific routing"})),ve||(ve=(0,M.jsx)("p",{children:"Send specific alerts to chosen contact points, based on matching criteria"})),i.receiver?o.length>0?(0,M.jsxs)(M.Fragment,{children:[!d&&!s&&(0,M.jsx)(l.Button,{className:p.addMatcherBtn,icon:"plus",onClick:m,type:"button",children:"New policy"}),(0,M.jsx)(ue,{isAddMode:d,readOnly:s,onCancelAdd:()=>{u(!1),c((e=>{const a=[...e];return a.pop(),a}))},onChange:e=>{a(Object.assign({},i,{routes:e})),d&&u(!1)},receivers:r,routes:o})]}):s?xe||(xe=(0,M.jsx)(Z,{children:(0,M.jsx)("p",{children:"There are no specific policies configured."})})):(0,M.jsx)(pe,{buttonIcon:"plus",buttonLabel:"New specific policy",onButtonClick:m,text:"You haven't created any specific policies yet."}):s?he||(he=(0,M.jsx)(Z,{children:(0,M.jsx)("p",{children:"There is no default contact point configured for the root route."})})):(0,M.jsx)(pe,{buttonIcon:"rocket",buttonLabel:"Set a default contact point",onButtonClick:t,text:"You haven't set a default contact point for the root route yet."})]})},be=e=>({container:r.css`
      display: flex;
      flex-flow: column nowrap;
    `,addMatcherBtn:r.css`
      align-self: flex-end;
      margin-bottom: ${e.spacing(3.5)};
    `});var je,ye,Ce=t("./public/app/features/alerting/unified/hooks/useAlertManagerSourceName.ts"),$e=t("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts"),Ie=t("./public/app/features/alerting/unified/state/actions.ts"),Se=t("./public/app/features/alerting/unified/utils/redux.ts");const _e=(0,l.withErrorBoundary)((()=>{var e;const a=(0,i.useDispatch)(),t=(0,l.useStyles2)(Ne),[r,u]=(0,n.useState)(!1),[p,m]=(0,Ce.k)(),g=!p||(0,v.RY)(p),h=(0,$e._)((e=>e.amConfigs)),x=(0,n.useCallback)((()=>{p&&a((0,Ie.Yh)(p))}),[p,a]);(0,n.useEffect)((()=>{x()}),[x]);const{result:f,loading:b,error:j}=p&&h[p]||Se.oq,y=null==f?void 0:f.alertmanager_config,[I,_]=(0,n.useMemo)((()=>C(null==y?void 0:y.route)),[null==y?void 0:y.route]),N=S((null!==(e=null==y?void 0:y.receivers)&&void 0!==e?e:[]).map((e=>e.name))),w=()=>{u(!0)},V=()=>{u(!1)};(0,o.x)((e=>e.unifiedAlerting.saveAMConfig));const k=e=>{if(!f)return;const t=$(p,Object.assign({},I,e),_);r&&V(),a((0,Ie.mM)({newConfig:Object.assign({},f,{alertmanager_config:Object.assign({},f.alertmanager_config,{route:t})}),oldConfig:f,alertManagerSourceName:p,successMessage:"Saved",refetch:!0}))};return p?(0,M.jsxs)(c.J,{pageId:"am-routes",children:[(0,M.jsx)(d.P,{current:p,onChange:m}),j&&!b&&(0,M.jsx)(l.Alert,{severity:"error",title:"Error loading Alertmanager config",children:j.message||"Unknown error."}),b&&(ye||(ye=(0,M.jsx)(l.LoadingPlaceholder,{text:"Loading Alertmanager config..."}))),f&&!b&&!j&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(L,{alertManagerSourceName:p,isEditMode:r,onSave:k,onEnterEditMode:w,onExitEditMode:V,receivers:N,routes:I}),(0,M.jsx)("div",{className:t.break}),(0,M.jsx)(fe,{onChange:k,readOnly:g,onRootRouteEdit:w,receivers:N,routes:I})]})]}):je||(je=(0,M.jsx)(s.l_,{to:"/alerting/routes"}))}),{style:"page"}),Ne=e=>({break:r.css`
    width: 100%;
    height: 0;
    margin-bottom: ${e.spacing(2)};
  `})},"./public/app/features/alerting/unified/components/AlertingPageWrapper.tsx":(e,a,t)=>{t.d(a,{J:()=>s});t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js");var n=t("./public/app/core/components/Page/Page.tsx"),r=t("./public/app/core/selectors/navModel.ts"),l=t("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/0/cache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),i=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const s=e=>{let{children:a,pageId:t,isLoading:s}=e;const o=(0,r.h)((0,l.useSelector)((e=>e.navIndex)),t);return(0,i.jsx)(n.Z,{navModel:o,children:(0,i.jsx)(n.Z.Contents,{isLoading:s,children:a})})}},"./public/app/features/alerting/unified/components/DynamicTable.tsx":(e,a,t)=>{t.d(a,{t:()=>s});var n=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),r=t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),l=t("./packages/grafana-ui/src/index.ts"),i=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const s=e=>{let{cols:a,items:t,isExpandable:s=!1,onCollapse:c,onExpand:d,isExpanded:u,renderExpandedContent:p,testIdGenerator:m,renderPrefixCell:g,renderPrefixHeader:v}=e;if((c||d||u)&&!(c&&d&&u))throw new Error("either all of onCollapse, onExpand, isExpanded must be provided, or none");if((s||p)&&(!s||!p))throw new Error("either both isExpanded and renderExpandedContent must be provided, or neither");const h=(0,l.useStyles2)(o(a,s,!!v)),[x,f]=(0,n.useState)([]);return(0,i.jsxs)("div",{className:h.container,"data-testid":"dynamic-table",children:[(0,i.jsxs)("div",{className:h.row,"data-testid":"header",children:[v&&v(),s&&(0,i.jsx)("div",{className:h.cell}),a.map((e=>(0,i.jsx)("div",{className:h.cell,children:e.label},e.id)))]}),t.map(((e,n)=>{var o;const v=u?u(e):x.includes(e.id);return(0,i.jsxs)("div",{className:h.row,"data-testid":null!==(o=null==m?void 0:m(e,n))&&void 0!==o?o:"row",children:[g&&g(e,n,t),s&&(0,i.jsx)("div",{className:(0,r.cx)(h.cell,h.expandCell),children:(0,i.jsx)(l.IconButton,{"aria-label":(v?"Collapse":"Expand")+" row",size:"xl","data-testid":"collapse-toggle",className:h.expandButton,name:v?"angle-down":"angle-right",onClick:()=>(e=>{u&&c&&d?u(e)?c(e):d(e):f(x.includes(e.id)?x.filter((a=>a!==e.id)):[...x,e.id])})(e),type:"button"})}),a.map((a=>(0,i.jsx)("div",{className:(0,r.cx)(h.cell,h.bodyCell),"data-column":a.label,children:a.renderCell(e,n)},`${e.id}-${a.id}`))),v&&p&&(0,i.jsx)("div",{className:h.expandedContentRow,"data-testid":"expanded-content",children:p(e,n,t)})]},e.id)}))]})},o=(e,a,t)=>{const n=e.map((e=>e.size?"number"==typeof e.size?`${e.size}fr`:e.size:"auto"));return a&&n.unshift("calc(1em + 16px)"),t&&n.unshift("0"),e=>({container:r.css`
      border: 1px solid ${e.colors.border.strong};
      border-radius: 2px;
      color: ${e.colors.text.secondary};
    `,row:r.css`
      display: grid;
      grid-template-columns: ${n.join(" ")};
      grid-template-rows: 1fr auto;

      &:nth-child(2n + 1) {
        background-color: ${e.colors.background.secondary};
      }

      &:nth-child(2n) {
        background-color: ${e.colors.background.primary};
      }

      ${e.breakpoints.down("sm")} {
        grid-template-columns: auto 1fr;
        grid-template-areas: 'left right';
        padding: 0 ${e.spacing(.5)};

        &:first-child {
          display: none;
        }

        ${t?"\n            & > *:first-child {\n              display: none;\n            }\n          ":""}
      }
    `,cell:r.css`
      align-items: center;
      padding: ${e.spacing(1)};

      ${e.breakpoints.down("sm")} {
        padding: ${e.spacing(1)} 0;
        grid-template-columns: 1fr;
      }
    `,bodyCell:r.css`
      overflow: hidden;
      word-break: break-all;
      ${e.breakpoints.down("sm")} {
        grid-column-end: right;
        grid-column-start: right;

        &::before {
          content: attr(data-column);
          display: block;
          color: ${e.colors.text.primary};
        }
      }
    `,expandCell:r.css`
      justify-content: center;

      ${e.breakpoints.down("sm")} {
        align-items: start;
        grid-area: left;
      }
    `,expandedContentRow:r.css`
      grid-column-end: ${n.length+1};
      grid-column-start: ${t?3:2};
      grid-row: 2;
      padding: 0 ${e.spacing(3)} 0 ${e.spacing(1)};
      position: relative;

      ${e.breakpoints.down("sm")} {
        grid-column-start: 2;
        border-top: 1px solid ${e.colors.border.strong};
        grid-row: auto;
        padding: ${e.spacing(1)} 0 0 0;
      }
    `,expandButton:r.css`
      margin-right: 0;
      display: block;
    `})}},"./public/app/features/alerting/unified/components/silences/Matchers.tsx":(e,a,t)=>{t.d(a,{g:()=>c});var n=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),r=t("./packages/grafana-ui/src/index.ts"),l=t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),i=t("./public/app/features/alerting/unified/components/AlertLabel.tsx"),s=t("./public/app/features/alerting/unified/utils/alertmanager.ts"),o=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const c=e=>{let{matchers:a,onRemoveLabel:t}=e;const l=(0,r.useStyles)(d),c=(0,n.useCallback)((e=>{t&&t(e)}),[t]);return(0,o.jsx)("div",{className:l.wrapper,children:a.map(((e,a)=>{const{name:n,value:r}=e;return(0,o.jsx)(i.i,{labelKey:n,value:r,operator:(0,s.zy)(e),onRemoveLabel:t?()=>c(a):void 0},`${n}-${r}-${a}`)}))})},d=e=>({wrapper:l.css`
    & > * {
      margin-top: ${e.spacing.xs};
      margin-right: ${e.spacing.xs};
    }
    padding-bottom: ${e.spacing.xs};
  `})},"./public/app/features/alerting/unified/hooks/useAlertManagerSourceName.ts":(e,a,t)=>{t.d(a,{k:()=>c});var n=t("./public/app/core/hooks/useQueryParams.ts"),r=t("./public/app/core/store.ts"),l=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),i=t("./public/app/features/alerting/unified/utils/constants.ts"),s=t("./public/app/features/alerting/unified/utils/datasource.ts");function o(e){return e===s.GC||!!(0,s.aM)().find((a=>a.name===e))}function c(){const[e,a]=(0,n.K)(),t=(0,l.useCallback)((e=>{o(e)&&(e===s.GC?(r.Z.delete(i.de),a({[i.c4]:null})):(r.Z.set(i.de,e),a({[i.c4]:e})))}),[a]),c=e[i.c4];if(c&&"string"==typeof c)return o(c)?[c,t]:[void 0,t];const d=r.Z.get(i.de);return d&&"string"==typeof d&&o(d)?(t(d),[d,t]):[s.GC,t]}}}]);
//# sourceMappingURL=AlertAmRoutes.07a78e2e5dfa22b54847.js.map