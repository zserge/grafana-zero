"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5829],{"./public/app/features/dashboard/components/PanelEditor/utils.ts":(e,t,s)=>{s.d(t,{jF:()=>i,sY:()=>o,uJ:()=>l,hs:()=>d});var a=s("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),n=s("./public/app/features/dashboard/components/PanelEditor/types.ts"),r=s("./public/app/core/constants.ts");function i(e,t,s,a){if(e===n.d1.Fill)return{width:t,height:s};const i=(window.innerWidth-60-4*r.hD)/r.cz*a.gridPos.w,o=r.K3*a.gridPos.h+48,l=Math.min(t/i,s/o);return i<=t&&o<=s?{width:i,height:o}:{width:i*l,height:o*l}}function o(e){return!1===(null==e?void 0:e.meta.skipDataQuery)}const l=(e,t,s,n)=>{let r=Object.assign({},e.defaults);const i=null==s||""===s;return n?r.custom?r.custom=i?(0,a.omit)(r.custom,t):d(r.custom,t,s):i||(r.custom=d(r.custom,t,s)):r=i?(0,a.omit)(r,t):d(r,t,s),Object.assign({},e,{defaults:r})};function d(e,t,s){const a=Array.isArray(t)?t:t.split("."),n=a.shift();if(n.endsWith("]")){const t=n.lastIndexOf("["),r=+n.substring(t+1,n.length-1),i=n.substr(0,t);let o=e[i];const l=Array.isArray(o)?[...o]:[];return a.length&&(o=l[r],null!=o&&"object"==typeof o||(o={}),s=d(o,a,s)),l[r]=s,Object.assign({},e,{[i]:l})}if(!a.length)return Object.assign({},e,{[n]:s});let r=e[n];return null!=r&&"object"==typeof r||(r={}),Object.assign({},e,{[n]:d(r,a,s)})}},"./public/app/features/inspector/InspectDataTab.tsx":(e,t,s)=>{s.d(t,{E:()=>S});var a=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),n=s("./.yarn/__virtual__/react-virtualized-auto-sizer-virtual-ff1f971104/0/cache/react-virtualized-auto-sizer-npm-1.0.2-e1e8c3209e-e29dc664c3.zip/node_modules/react-virtualized-auto-sizer/dist/index.esm.js"),r=s("./packages/grafana-data/src/index.ts"),i=s("./packages/grafana-ui/src/index.ts"),o=s("./packages/grafana-e2e-selectors/src/index.ts"),l=s("./public/app/features/inspector/styles.ts"),d=s("./public/app/core/components/QueryOperationRow/QueryOperationRow.tsx"),c=s("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),p=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const u=e=>c.css`
  margin: 0;
  margin-left: ${e.spacing.md};
  font-size: ${e.typography.size.sm};
  color: ${e.colors.textWeak};
`,m=e=>{let{children:t}=e;const s=(0,i.useStyles)(u);return(0,p.jsx)("p",{className:s,children:t})},h=e=>{var t;let{options:s,onOptionsChange:a,panel:n,data:o,dataFrames:c,transformId:u,transformationOptions:h,selectedDataFrame:f,onDataFrameChange:g,downloadForExcel:v,toggleDownloadForExcel:x}=e;const y=(0,l.S)(),b=null==n?void 0:n.getTransformations(),j=Boolean(null==b?void 0:b.length)&&"join by time"!==u,w=n&&!(null!==(t=n.plugin)&&void 0!==t&&t.fieldConfigRegistry.isEmpty());let D=c;f===r.DataTransformerID.seriesToColumns&&(D=o);const S=[...h,...D.map(((e,t)=>({value:t,label:`${(0,r.getFrameDisplayName)(e)} (${t})`})))];return(0,p.jsx)("div",{className:y.dataDisplayOptions,children:(0,p.jsx)(d.t,{id:"Data options",index:0,title:"Data options",headerElement:(0,p.jsx)(m,{children:function(){if(!o)return"";const e=[];return f===r.DataTransformerID.seriesToColumns?e.push("Series joined by time"):o.length>1&&e.push((0,r.getFrameDisplayName)(o[f])),(s.withTransforms||s.withFieldConfig)&&(s.withTransforms&&e.push("Panel transforms"),s.withTransforms&&s.withFieldConfig,s.withFieldConfig&&e.push("Formatted data")),v&&e.push("Excel header"),e.join(", ")}()}),isOpen:!1,children:(0,p.jsx)("div",{className:y.options,"data-testid":"dataOptions",children:(0,p.jsxs)(i.VerticalGroup,{spacing:"none",children:[o.length>1&&(0,p.jsx)(i.Field,{label:"Show data frame",children:(0,p.jsx)(i.Select,{menuShouldPortal:!0,options:S,value:f,onChange:g,width:30,"aria-label":"Select dataframe"})}),(0,p.jsxs)(i.HorizontalGroup,{children:[j&&a&&(0,p.jsx)(i.Field,{label:"Apply panel transformations",description:"Table data is displayed with transformations defined in the panel Transform tab.",children:(0,p.jsx)(i.Switch,{value:!!s.withTransforms,onChange:()=>a(Object.assign({},s,{withTransforms:!s.withTransforms}))})}),w&&a&&(0,p.jsx)(i.Field,{label:"Formatted data",description:"Table data is formatted with options defined in the Field and Override tabs.",children:(0,p.jsx)(i.Switch,{id:"formatted-data-toggle",value:!!s.withFieldConfig,onChange:()=>a(Object.assign({},s,{withFieldConfig:!s.withFieldConfig}))})}),(0,p.jsx)(i.Field,{label:"Download for Excel",description:"Adds header to CSV for use with Excel",children:(0,p.jsx)(i.Switch,{id:"excel-toggle",value:v,onChange:x})})]})]})})})})};var f,g,v=s("./public/app/core/config.ts"),x=s("./.yarn/cache/file-saver-npm-2.0.2-9cc89b9cdb-c1d2aacc66.zip/node_modules/file-saver/dist/FileSaver.min.js"),y=s("./public/app/core/logs_model.ts"),b=s("./public/app/plugins/datasource/jaeger/responseTransform.ts"),j=s("./public/app/plugins/datasource/zipkin/utils/transforms.ts"),w=s("./public/app/plugins/datasource/tempo/resultTransformer.ts");function D(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class S extends a.PureComponent{constructor(e){var t,s;super(e),t=this,D(this,"exportCsv",(function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{panel:a}=t.props,{transformId:n}=t.state,i=(0,r.toCSV)([e],s),o=new Blob([String.fromCharCode(65279),i],{type:"text/csv;charset=utf-8"}),l=a?a.getDisplayTitle():"Explore",d=n!==r.DataTransformerID.noop?"-as-"+n.toLocaleLowerCase():"",c=`${l}-data${d}-${(0,r.dateTimeFormat)(new Date)}.csv`;(0,x.saveAs)(o,c)})),D(this,"exportLogsAsTxt",(()=>{var e;const{data:t,panel:s}=this.props,a=(0,y.aB)(t||[],void 0);let n="";null===(e=a.meta)||void 0===e||e.forEach((e=>{const t=`${e.label}: ${JSON.stringify(e.value)}\n`;n+=t})),n+="\n\n",a.rows.forEach((e=>{const t=(0,r.dateTimeFormatISO)(e.timeEpochMs)+"\t"+e.entry+"\n";n+=t}));const i=new Blob([n],{type:"text/plain;charset=utf-8"}),o=`${s?s.getDisplayTitle():"Explore"}-logs-${(0,r.dateTimeFormat)(new Date)}.txt`;(0,x.saveAs)(i,o)})),D(this,"exportTracesAsJson",(()=>{var e,t;const{data:s,panel:a}=this.props;if(s)for(const i of s){var n;if("trace"===(null===(n=i.meta)||void 0===n?void 0:n.preferredVisualisationType))switch(null===(e=i.meta)||void 0===e||null===(t=e.custom)||void 0===t?void 0:t.traceFormat){case"jaeger":{let e=(0,b.c6)(new r.MutableDataFrame(i));this.saveTraceJson(e,a);break}case"zipkin":{let e=(0,j.H)(new r.MutableDataFrame(i));this.saveTraceJson(e,a);break}default:{let e=(0,w.g9)(new r.MutableDataFrame(i));this.saveTraceJson(e,a);break}}}})),D(this,"saveTraceJson",((e,t)=>{const s=new Blob([JSON.stringify(e)],{type:"application/json"}),a=`${t?t.getDisplayTitle():"Explore"}-traces-${(0,r.dateTimeFormat)(new Date)}.json`;(0,x.saveAs)(s,a)})),D(this,"onDataFrameChange",(e=>{this.setState({transformId:e.value===r.DataTransformerID.seriesToColumns?r.DataTransformerID.seriesToColumns:r.DataTransformerID.noop,dataFrameIndex:"number"==typeof e.value?e.value:0,selectedDataFrame:e.value})})),D(this,"toggleDownloadForExcel",(()=>{this.setState((e=>({downloadForExcel:!e.downloadForExcel})))})),this.state={selectedDataFrame:0,dataFrameIndex:0,transformId:r.DataTransformerID.noop,transformationOptions:T(),transformedData:null!==(s=e.data)&&void 0!==s?s:[],downloadForExcel:!1}}componentDidUpdate(e,t){if(this.props.data)if(this.props.options.withTransforms)this.setState({transformedData:this.props.data});else if(e.data===this.props.data&&t.transformId===this.state.transformId);else{const e=this.state.transformationOptions.find((e=>e.value===this.state.transformId));if(e&&e.transformer.id!==r.DataTransformerID.noop){const t=this.state.selectedDataFrame,s=this.state.dataFrameIndex,a=(0,r.transformDataFrame)([e.transformer],this.props.data).subscribe((e=>{this.setState({transformedData:e,selectedDataFrame:t,dataFrameIndex:s},(()=>a.unsubscribe()))}));return}this.setState({transformedData:this.props.data})}else this.setState({transformedData:[]})}getProcessedData(){const{options:e,panel:t}=this.props,s=this.state.transformedData;return e.withFieldConfig&&t?(0,r.applyFieldOverrides)({data:s,theme:v.vc.theme2,fieldConfig:t.fieldConfig,replaceVariables:e=>e}):(0,r.applyRawFieldOverrides)(s)}render(){const{isLoading:e,options:t,data:s,panel:a,onOptionsChange:r}=this.props,{dataFrameIndex:d,transformId:u,transformationOptions:m,selectedDataFrame:v,downloadForExcel:x}=this.state,y=(0,l.S)();if(e)return f||(f=(0,p.jsxs)("div",{children:[(0,p.jsx)(i.Spinner,{inline:!0})," Loading"]}));const b=this.getProcessedData();if(!b||!b.length)return g||(g=(0,p.jsx)("div",{children:"No Data"}));const j=b[d]?d:0,w=b[j],D=b.some((e=>{var t;return"logs"===(null==e||null===(t=e.meta)||void 0===t?void 0:t.preferredVisualisationType)})),S=b.some((e=>{var t;return"trace"===(null==e||null===(t=e.meta)||void 0===t?void 0:t.preferredVisualisationType)}));return(0,p.jsxs)("div",{className:y.dataTabContent,"aria-label":o.wl.components.PanelInspector.Data.content,children:[(0,p.jsxs)("div",{className:y.actionsWrapper,children:[(0,p.jsx)(h,{data:s,panel:a,options:t,dataFrames:b,transformId:u,transformationOptions:m,selectedDataFrame:v,downloadForExcel:x,onOptionsChange:r,onDataFrameChange:this.onDataFrameChange,toggleDownloadForExcel:this.toggleDownloadForExcel}),(0,p.jsx)(i.Button,{variant:"primary",onClick:()=>this.exportCsv(b[d],{useExcelHeader:this.state.downloadForExcel}),className:c.css`
              margin-bottom: 10px;
            `,children:"Download CSV"}),D&&(0,p.jsx)(i.Button,{variant:"primary",onClick:this.exportLogsAsTxt,className:c.css`
                margin-bottom: 10px;
                margin-left: 10px;
              `,children:"Download logs"}),S&&(0,p.jsx)(i.Button,{variant:"primary",onClick:this.exportTracesAsJson,className:c.css`
                margin-bottom: 10px;
                margin-left: 10px;
              `,children:"Download traces"})]}),(0,p.jsx)(i.Container,{grow:1,children:(0,p.jsx)(n.Z,{children:e=>{let{width:t,height:s}=e;return 0===t?null:(0,p.jsx)("div",{style:{width:t,height:s},children:(0,p.jsx)(i.Table,{width:t,height:s,data:w,showTypeIcons:!0})})}})})]})}}function T(){return[{value:r.DataTransformerID.seriesToColumns,label:"Series joined by time",transformer:{id:r.DataTransformerID.seriesToColumns,options:{byField:"Time"}}}]}},"./public/app/features/inspector/InspectErrorTab.tsx":(e,t,s)=>{s.d(t,{l:()=>r});s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js");var a=s("./packages/grafana-ui/src/index.ts"),n=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const r=e=>{let{error:t}=e;return t?t.data?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h3",{children:t.data.message}),(0,n.jsx)(a.JSONFormatter,{json:t,open:2})]}):(0,n.jsx)("div",{children:t.message}):null}},"./public/app/features/inspector/InspectJSONTab.tsx":(e,t,s)=>{s.d(t,{W:()=>g});var a=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),n=s("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),r=s("./packages/grafana-data/src/index.ts"),i=s("./packages/grafana-ui/src/index.ts"),o=s("./.yarn/__virtual__/react-virtualized-auto-sizer-virtual-ff1f971104/0/cache/react-virtualized-auto-sizer-npm-1.0.2-e1e8c3209e-e29dc664c3.zip/node_modules/react-virtualized-auto-sizer/dist/index.esm.js"),l=s("./packages/grafana-e2e-selectors/src/index.ts"),d=s("./public/app/core/core.ts"),c=s("./public/app/features/inspector/styles.ts"),p=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const u=["table","fields"];function m(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var h;!function(e){e.PanelJSON="panel",e.DataJSON="data",e.DataStructure="structure"}(h||(h={}));const f=[{label:"Panel JSON",description:"The model saved in the dashboard JSON that configures how everything works.",value:h.PanelJSON},{label:"Data",description:"The raw model passed to the panel visualization",value:h.DataJSON},{label:"DataFrame structure",description:"Response info without any values",value:h.DataStructure}];class g extends a.PureComponent{constructor(e){super(e),m(this,"hasPanelJSON",void 0),m(this,"onSelectChanged",(e=>{const t=v(this.getJSONObject(e.value));this.setState({text:t,show:e.value})})),m(this,"onTextChanged",(e=>{this.setState({text:e})})),m(this,"onApplyPanelModel",(()=>{const{panel:e,dashboard:t,onClose:s}=this.props;if(this.hasPanelJSON){try{if(t.meta.canEdit){const s=JSON.parse(this.state.text);t.shouldUpdateDashboardPanelFromJSON(s,e),e.restoreModel(s),e.refresh(),d.h$.emit(r.AppEvents.alertSuccess,["Panel model updated"])}else d.h$.emit(r.AppEvents.alertError,["Unable to apply"])}catch(e){console.error("Error applying updates",e),d.h$.emit(r.AppEvents.alertError,["Invalid JSON text"])}s()}})),this.hasPanelJSON=!(!e.panel||!e.dashboard),this.state={show:this.hasPanelJSON?h.PanelJSON:h.DataJSON,text:this.hasPanelJSON?v(e.panel.getSaveModel()):v(e.data)}}getJSONObject(e){const{data:t,panel:s}=this.props;if(e===h.DataJSON)return t;if(e===h.DataStructure){return(null==t?void 0:t.series)?t.series.map((e=>{const t=function(e,t){if(null==e)return{};var s,a,n={},r=Object.keys(e);for(a=0;a<r.length;a++)s=r[a],t.indexOf(s)>=0||(n[s]=e[s]);return n}(e,u);return Object.assign({},t,{fields:e.fields.map((e=>(0,n.chain)(e).omit("values").omit("state").omit("display").value()))})})):{note:"Missing Response Data"}}return this.hasPanelJSON&&e===h.PanelJSON?s.getSaveModel():{note:`Unknown Object: ${e}`}}render(){const{dashboard:e}=this.props,{show:t,text:s}=this.state,a=this.hasPanelJSON?f:f.slice(1,f.length),n=f.find((e=>e.value===t)),r=t===h.PanelJSON,d=e&&e.meta.canEdit,u=(0,c.S)();return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:u.toolbar,"aria-label":l.wl.components.PanelInspector.Json.content,children:[(0,p.jsx)(i.Field,{label:"Select source",className:"flex-grow-1",children:(0,p.jsx)(i.Select,{inputId:"select-source-dropdown",options:a,value:n,onChange:this.onSelectChanged,menuShouldPortal:!0})}),this.hasPanelJSON&&r&&d&&(0,p.jsx)(i.Button,{className:u.toolbarItem,onClick:this.onApplyPanelModel,children:"Apply"})]}),(0,p.jsx)("div",{className:u.content,children:(0,p.jsx)(o.Z,{disableWidth:!0,children:e=>{let{height:t}=e;return(0,p.jsx)(i.CodeEditor,{width:"100%",height:t,language:"json",showLineNumbers:!0,showMiniMap:(s&&s.length)>100,value:s||"",readOnly:!r,onBlur:this.onTextChanged})}})})]})}}function v(e){return JSON.stringify(e,null,2)}},"./public/app/features/inspector/InspectStatsTab.tsx":(e,t,s)=>{s.d(t,{f:()=>p});var a=s("./packages/grafana-e2e-selectors/src/index.ts"),n=(s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),s("./packages/grafana-data/src/index.ts")),r=s("./packages/grafana-ui/src/index.ts"),i=s("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),o=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const l=e=>{let{timeZone:t,name:s,stats:a}=e;const n=(0,r.useTheme2)(),i=c(n);return a&&a.length?(0,o.jsxs)("div",{className:i.wrapper,children:[(0,o.jsx)("div",{className:"section-heading",children:s}),(0,o.jsx)("table",{className:"filter-table width-30",children:(0,o.jsx)("tbody",{children:a.map(((e,s)=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:e.displayName}),(0,o.jsx)("td",{className:i.cell,children:d(e,t,n)})]},`${e.displayName}-${s}`)))})})]}):null};function d(e,t,s){const a=(0,n.getDisplayProcessor)({field:{type:n.FieldType.number,config:e},theme:s,timeZone:t});return(0,n.formattedValueToString)(a(e.value))}const c=(0,r.stylesFactory)((e=>({wrapper:i.css`
      padding-bottom: ${e.spacing(2)};
    `,cell:i.css`
      text-align: right;
    `}))),p=e=>{var t;let{data:s,timeZone:n}=e;if(!s.request)return null;let r=[];const i=s.request.endTime?s.request.endTime-s.request.startTime:-1,d=(null===(t=s.timings)||void 0===t?void 0:t.dataProcessingTime)||-1;let c=0;for(const e of s.series)c+=e.length;i>0&&r.push({displayName:"Total request time",value:i,unit:"ms"}),d>0&&r.push({displayName:"Data processing time",value:d,unit:"ms"}),r.push({displayName:"Number of queries",value:s.request.targets.length}),r.push({displayName:"Total number rows",value:c});let p=[];for(const e of s.series)e.meta&&e.meta.stats&&(p=p.concat(e.meta.stats));return(0,o.jsxs)("div",{"aria-label":a.wl.components.PanelInspector.Stats.content,children:[(0,o.jsx)(l,{timeZone:n,name:"Stats",stats:r}),(0,o.jsx)(l,{timeZone:n,name:"Data source stats",stats:p})]})}},"./public/app/features/inspector/QueryInspector.tsx":(e,t,s)=>{s.d(t,{D:()=>D});var a,n,r,i,o,l,d=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),c=s("./packages/grafana-ui/src/index.ts"),p=s("./packages/grafana-e2e-selectors/src/index.ts"),u=s("./packages/grafana-data/src/index.ts"),m=s("./public/app/core/app_events.ts"),h=s("./public/app/core/components/CopyToClipboard/CopyToClipboard.tsx"),f=s("./public/app/features/inspector/styles.ts"),g=s("./public/app/features/dashboard/components/PanelEditor/utils.ts"),v=s("./packages/grafana-runtime/src/index.ts"),x=s("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),y=s("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/Subscription.js"),b=s("./public/app/core/services/backend_srv.ts"),j=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");function w(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class D extends d.PureComponent{constructor(e){super(e),w(this,"formattedJson",void 0),w(this,"subs",new y.w0),w(this,"onPanelRefresh",(()=>{this.setState((e=>Object.assign({},e,{dsQuery:{isLoading:!0,response:{}}})))})),w(this,"setFormattedJson",(e=>{this.formattedJson=e})),w(this,"getTextForClipboard",(()=>JSON.stringify(this.formattedJson,null,2))),w(this,"onClipboardSuccess",(()=>{m.Z.emit(u.AppEvents.alertSuccess,["Content copied to clipboard"])})),w(this,"onToggleExpand",(()=>{this.setState((e=>Object.assign({},e,{allNodesExpanded:!this.state.allNodesExpanded})))})),w(this,"onToggleMocking",(()=>{this.setState((e=>Object.assign({},e,{isMocking:!this.state.isMocking})))})),w(this,"getNrOfOpenNodes",(()=>null===this.state.allNodesExpanded?3:this.state.allNodesExpanded?20:1)),w(this,"setMockedResponse",(e=>{const t=e.target.value;this.setState((e=>Object.assign({},e,{mockedResponse:t})))})),this.state={executedQueries:[],allNodesExpanded:null,isMocking:!1,mockedResponse:"",dsQuery:{isLoading:!1,response:{}}}}componentDidMount(){const{panel:e}=this.props;this.subs.add(b.ae.getInspectorStream().subscribe({next:e=>this.onDataSourceResponse(e)})),e&&(this.subs.add(e.events.subscribe(v.RefreshEvent,this.onPanelRefresh)),this.updateQueryList())}componentDidUpdate(e){this.props.data!==e.data&&this.updateQueryList()}updateQueryList(){const{data:e}=this.props,t=[];if(null!=e&&e.length){let s;e.forEach(((e,a)=>{var n;const r=null===(n=e.meta)||void 0===n?void 0:n.executedQueryString;if(r){var i;const a=e.refId||"?";(null===(i=s)||void 0===i?void 0:i.refId)===a?(s.frames++,s.rows+=e.length):(s={refId:a,frames:0,rows:e.length,query:r},t.push(s))}}))}this.setState({executedQueries:t})}componentWillUnmount(){this.subs.unsubscribe()}onDataSourceResponse(e){var t;null!==(t=e.config)&&void 0!==t&&t.hideFromInspector||((e=Object.assign({},e)).headers&&delete e.headers,e.config&&(e.request=e.config,delete e.config,delete e.request.transformRequest,delete e.request.transformResponse,delete e.request.paramSerializer,delete e.request.jsonpCallbackParam,delete e.request.headers,delete e.request.requestId,delete e.request.inspect,delete e.request.retry,delete e.request.timeout),e.data&&(e.response=e.data,delete e.config,delete e.data,delete e.status,delete e.statusText,delete e.ok,delete e.url,delete e.redirected,delete e.type,delete e.$$config),this.setState((t=>Object.assign({},t,{dsQuery:{isLoading:!1,response:e}}))))}renderExecutedQueries(e){if(!e.length)return null;const t={refId:x.css`
        font-weight: ${v.config.theme.typography.weight.semibold};
        color: ${v.config.theme.colors.textBlue};
        margin-right: 8px;
      `};return(0,j.jsx)("div",{children:e.map((e=>(0,j.jsxs)("div",{children:[(0,j.jsxs)("div",{children:[(0,j.jsxs)("span",{className:t.refId,children:[e.refId,":"]}),e.frames>1&&(0,j.jsxs)("span",{children:[e.frames," frames, "]}),(0,j.jsxs)("span",{children:[e.rows," rows"]})]}),(0,j.jsx)("pre",{children:e.query})]},e.refId)))})}render(){const{allNodesExpanded:e,executedQueries:t}=this.state,{panel:s,onRefreshQuery:d}=this.props,{response:u,isLoading:m}=this.state.dsQuery,v=this.getNrOfOpenNodes(),x=(0,f.S)(),y=Object.keys(u).length>0;return s&&!(0,g.sY)(s.plugin)?null:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{"aria-label":p.wl.components.PanelInspector.Query.content,children:[a||(a=(0,j.jsx)("h3",{className:"section-heading",children:"Query inspector"})),n||(n=(0,j.jsx)("p",{className:"small muted",children:"Query inspector allows you to view raw request and response. To collect this data Grafana needs to issue a new query. Click refresh button below to trigger a new query."}))]}),this.renderExecutedQueries(t),(0,j.jsxs)("div",{className:x.toolbar,children:[(0,j.jsx)(c.Button,{icon:"sync",onClick:d,"aria-label":p.wl.components.PanelInspector.Query.refreshButton,children:"Refresh"}),y&&e&&(0,j.jsx)(c.Button,{icon:"minus",variant:"secondary",className:x.toolbarItem,onClick:this.onToggleExpand,children:"Collapse all"}),y&&!e&&(0,j.jsx)(c.Button,{icon:"plus",variant:"secondary",className:x.toolbarItem,onClick:this.onToggleExpand,children:"Expand all"}),y&&(0,j.jsx)(h.h,{text:this.getTextForClipboard,onSuccess:this.onClipboardSuccess,elType:"div",className:x.toolbarItem,children:r||(r=(0,j.jsx)(c.Button,{icon:"copy",variant:"secondary",children:"Copy to clipboard"}))}),i||(i=(0,j.jsx)("div",{className:"flex-grow-1"}))]}),(0,j.jsxs)("div",{className:x.contentQueryInspector,children:[m&&(o||(o=(0,j.jsx)(c.LoadingPlaceholder,{text:"Loading query inspector..."}))),!m&&y&&(0,j.jsx)(c.JSONFormatter,{json:u,open:v,onDidRender:this.setFormattedJson}),!m&&!y&&(l||(l=(0,j.jsx)("p",{className:"muted",children:"No request and response collected yet. Hit refresh button"})))]})]})}}},"./public/app/features/inspector/styles.ts":(e,t,s)=>{s.d(t,{S:()=>r});var a=s("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),n=s("./public/app/core/config.ts");const r=(0,s("./packages/grafana-ui/src/index.ts").stylesFactory)((()=>({wrap:a.css`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      flex: 1 1 0;
    `,toolbar:a.css`
      display: flex;
      width: 100%;
      flex-grow: 0;
      align-items: center;
      justify-content: flex-end;
      margin-bottom: ${n.vc.theme.spacing.sm};
    `,toolbarItem:a.css`
      margin-left: ${n.vc.theme.spacing.md};
    `,content:a.css`
      flex-grow: 1;
      height: 100%;
      padding-bottom: 16px;
    `,contentQueryInspector:a.css`
      flex-grow: 1;
      padding: ${n.vc.theme.spacing.md} 0;
    `,editor:a.css`
      font-family: monospace;
      height: 100%;
      flex-grow: 1;
    `,viewer:a.css`
      overflow: scroll;
    `,dataFrameSelect:a.css`
      flex-grow: 2;
    `,tabContent:a.css`
      height: 100%;
      display: flex;
      flex-direction: column;
    `,dataTabContent:a.css`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
    `,actionsWrapper:a.css`
      display: flex;
    `,leftActions:a.css`
      display: flex;
      flex-grow: 1;

      max-width: 85%;
      @media (max-width: 1345px) {
        max-width: 75%;
      }
    `,options:a.css`
      padding-top: ${n.vc.theme.spacing.sm};
    `,dataDisplayOptions:a.css`
      flex-grow: 1;
      min-width: 300px;
      margin-right: ${n.vc.theme.spacing.sm};
    `,selects:a.css`
      display: flex;
      > * {
        margin-right: ${n.vc.theme.spacing.sm};
      }
    `})))},"./public/app/features/query/components/QueryEditorRows.tsx":(e,t,s)=>{s.d(t,{l:()=>d});var a=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),n=s("./public/app/features/query/components/QueryEditorRow.tsx"),r=s("./.yarn/__virtual__/react-beautiful-dnd-virtual-459d405f6d/0/cache/react-beautiful-dnd-npm-13.1.0-fcf5568b1c-12b7e9fbe8.zip/node_modules/react-beautiful-dnd/dist/react-beautiful-dnd.esm.js"),i=s("./packages/grafana-runtime/src/index.ts"),o=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");function l(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class d extends a.PureComponent{constructor(){super(...arguments),l(this,"onRemoveQuery",(e=>{this.props.onQueriesChange(this.props.queries.filter((t=>t!==e)))})),l(this,"onDragEnd",(e=>{const{queries:t,onQueriesChange:s}=this.props;if(!e||!e.destination)return;const a=e.source.index,n=e.destination.index;if(a===n)return;const r=Array.from(t),[i]=r.splice(a,1);r.splice(n,0,i),s(r)}))}onChangeQuery(e,t){const{queries:s,onQueriesChange:a}=this.props;a(s.map(((s,a)=>a===t?e:s)))}onDataSourceChange(e,t){const{queries:s,onQueriesChange:a}=this.props;a(s.map(((s,a)=>{if(a!==t)return s;if(s.datasource){const t=(0,i.getDataSourceSrv)().getInstanceSettings(s.datasource);if((null==t?void 0:t.type)===e.type)return Object.assign({},s,{datasource:{uid:e.uid}})}return{refId:s.refId,hide:s.hide,datasource:{uid:e.uid}}})))}render(){const{dsSettings:e,data:t,queries:s,app:a,history:i,eventBus:l}=this.props;return(0,o.jsx)(r.Z5,{onDragEnd:this.onDragEnd,children:(0,o.jsx)(r.bK,{droppableId:"transformations-list",direction:"vertical",children:r=>(0,o.jsxs)("div",Object.assign({ref:r.innerRef},r.droppableProps,{children:[s.map(((r,d)=>{const p=c(r,e),u=e.meta.mixed?e=>this.onDataSourceChange(e,d):void 0;return(0,o.jsx)(n.x,{id:r.refId,index:d,data:t,query:r,dataSource:p,onChangeDataSource:u,onChange:e=>this.onChangeQuery(e,d),onRemoveQuery:this.onRemoveQuery,onAddQuery:this.props.onAddQuery,onRunQuery:this.props.onRunQueries,queries:s,app:a,history:i,eventBus:l},r.refId)})),r.placeholder]}))})})}}const c=(e,t)=>{if(!e.datasource)return t;return(0,i.getDataSourceSrv)().getInstanceSettings(e.datasource)||t}},"./public/app/plugins/datasource/zipkin/utils/transforms.ts":(e,t,s)=>{s.d(t,{m:()=>r,H:()=>c});var a=s("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),n=s("./packages/grafana-data/src/index.ts");function r(e){const t=e.map(i),s=new n.MutableDataFrame({fields:[{name:"traceID",type:n.FieldType.string},{name:"spanID",type:n.FieldType.string},{name:"parentSpanID",type:n.FieldType.string},{name:"operationName",type:n.FieldType.string},{name:"serviceName",type:n.FieldType.string},{name:"serviceTags",type:n.FieldType.other},{name:"startTime",type:n.FieldType.number},{name:"duration",type:n.FieldType.number},{name:"logs",type:n.FieldType.other},{name:"tags",type:n.FieldType.other}],meta:{preferredVisualisationType:"trace",custom:{traceFormat:"zipkin"}}});for(const e of t)s.add(e);return s}function i(e){var t,s,a,n;const r={traceID:e.traceId,spanID:e.id,parentSpanID:e.parentId,operationName:e.name,serviceName:(null===(t=e.localEndpoint)||void 0===t?void 0:t.serviceName)||(null===(s=e.remoteEndpoint)||void 0===s?void 0:s.serviceName)||"unknown",serviceTags:l(e),startTime:e.timestamp/1e3,duration:e.duration/1e3,logs:null!==(a=null===(n=e.annotations)||void 0===n?void 0:n.map(o))&&void 0!==a?a:[],tags:Object.keys(e.tags||{}).reduce(((t,s)=>"error"===s?(t.push({key:"error",value:!0}),t.push({key:"errorValue",value:e.tags.error}),t):(t.push({key:s,value:e.tags[s]}),t)),[])};var i,d;e.kind&&(r.tags=[{key:"kind",value:e.kind},...null!==(i=r.tags)&&void 0!==i?i:[]]);e.shared&&(r.tags=[{key:"shared",value:e.shared},...null!==(d=r.tags)&&void 0!==d?d:[]]);return r}function o(e){return{timestamp:e.timestamp,fields:[{key:"annotation",value:e.value}]}}function l(e){const t=e.localEndpoint||e.remoteEndpoint;return t?[d("ipv4",t.ipv4),d("ipv6",t.ipv6),d("port",t.port),d("endpointType",e.localEndpoint?"local":"remote")].filter(a.identity):[]}function d(e,t){if(t)return{key:e,value:t}}const c=e=>{let t=[];for(let n=0;n<e.length;n++){var s,a;const r=e.get(n);t.push(Object.assign({traceId:r.traceID,parentId:r.parentSpanID,name:r.operationName,id:r.spanID,timestamp:1e3*r.startTime,duration:1e3*r.duration},p(r),{annotations:r.logs.length?r.logs.map((e=>({timestamp:e.timestamp,value:e.fields[0].value}))):void 0,tags:r.tags.length?r.tags.filter((e=>"kind"!==e.key&&"endpointType"!==e.key&&"shared"!==e.key)).reduce(((e,t)=>"error"===t.key?Object.assign({},e,{[t.key]:r.tags.find((e=>"errorValue"===e.key)).value||""}):Object.assign({},e,{[t.key]:t.value})),{}):void 0,kind:null===(s=r.tags.find((e=>"kind"===e.key)))||void 0===s?void 0:s.value,shared:null===(a=r.tags.find((e=>"shared"===e.key)))||void 0===a?void 0:a.value}))}return t},p=e=>{var t,s,a,n;const r="local"===(null===(t=e.serviceTags.find((e=>"endpointType"===e.key)))||void 0===t?void 0:t.value)?"localEndpoint":"remoteEndpoint";return"unknown"!==e.serviceName?{[r]:{serviceName:e.serviceName,ipv4:null===(s=e.serviceTags.find((e=>"ipv4"===e.key)))||void 0===s?void 0:s.value,ipv6:null===(a=e.serviceTags.find((e=>"ipv6"===e.key)))||void 0===a?void 0:a.value,port:null===(n=e.serviceTags.find((e=>"port"===e.key)))||void 0===n?void 0:n.value}}:void 0}},"./.yarn/__virtual__/react-use-virtual-ca2705900f/0/cache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/useToggle.js":(e,t,s)=>{s.d(t,{Z:()=>r});var a=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),n=function(e,t){return"boolean"==typeof t?t:!e};const r=function(e){return(0,a.useReducer)(n,e)}}}]);
//# sourceMappingURL=5829.07a78e2e5dfa22b54847.js.map