"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2001],{"./public/app/plugins/datasource/mixed/module.ts":(e,a,r)=>{r.r(a),r.d(a,{Datasource:()=>h,MixedDatasource:()=>h});var s=r("./packages/grafana-data/src/index.ts"),t=r("./packages/grafana-runtime/src/index.ts"),n=r("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),d=r("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/observable/of.js"),o=r("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/observable/from.js"),i=r("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/observable/forkJoin.js"),c=r("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js"),p=r("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/operators/map.js"),u=r("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/operators/toArray.js"),l=r("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),m=r("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/operators/mergeAll.js"),g=r("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/operators/reduce.js");class h extends s.DataSourceApi{constructor(e){super(e)}query(e){const a=e.targets.filter((e=>{var a;return"-- Mixed --"!==(null===(a=e.datasource)||void 0===a?void 0:a.type)}));if(!a.length)return(0,d.of)({data:[]});const r=(0,n.groupBy)(a,"datasource.uid"),s=[];for(const a in r){const n=r[a];s.push({datasource:(0,t.getDataSourceSrv)().get(n[0].datasource,e.scopedVars),targets:n})}return s.length?this.batchQueries(s,e):(0,d.of)({data:[]})}batchQueries(e,a){const r=e.filter(this.isQueryable).map(((e,r)=>(0,o.Dp)(e.datasource).pipe((0,c.z)((i=>{const c=(0,n.cloneDeep)(a);return c.requestId=`mixed-${r}-${c.requestId||""}`,c.targets=e.targets,(0,o.Dp)(i.query(c)).pipe((0,p.U)((e=>Object.assign({},e,{data:e.data||[],state:s.LoadingState.Loading,key:`mixed-${r}-${e.key||""}`}))),(0,u.q)(),(0,l.K)((e=>((e=(0,t.toDataQueryError)(e)).message=`${i.name}: ${e.message}`,(0,d.of)([{data:[],state:s.LoadingState.Error,error:e,key:`mixed-${r}-${c.requestId||""}`}])))))})))));return(0,i.D)(r).pipe((0,g.u)(((e,a)=>a.reduce(((e,a)=>(e.push.apply(e,a),e)),e)),[]),(0,p.U)(this.finalizeResponses),(0,m.J)())}testDatasource(){return Promise.resolve({})}isQueryable(e){return e&&Array.isArray(e.targets)&&e.targets.length>0}finalizeResponses(e){const{length:a}=e;if(0===a)return e;const r=e.find((e=>e.state===s.LoadingState.Error));return r?e.push(r):e[a-1].state=s.LoadingState.Done,e}}}}]);
//# sourceMappingURL=mixedPlugin.07a78e2e5dfa22b54847.js.map