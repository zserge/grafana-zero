"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[476],{"./public/app/features/alerting/NewNotificationChannelPage.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var r,s=n("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),a=n("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/0/cache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),i=n("./packages/grafana-runtime/src/index.ts"),l=n("./packages/grafana-ui/src/index.ts"),o=n("./public/app/core/components/Page/Page.tsx"),c=n("./public/app/features/alerting/components/NotificationChannelForm.tsx"),d=n("./public/app/features/alerting/utils/notificationChannels.ts"),u=n("./public/app/core/selectors/navModel.ts"),p=n("./public/app/features/alerting/state/actions.ts"),g=n("./public/app/features/alerting/state/reducers.ts"),f=n("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class h extends s.PureComponent{constructor(){super(...arguments),m(this,"onSubmit",(e=>{this.props.createNotificationChannel((0,d.YV)(Object.assign({},d.Pg,e)))})),m(this,"onTestChannel",(e=>{this.props.testNotificationChannel((0,d.dv)(Object.assign({},d.Pg,e)))}))}componentDidMount(){this.props.loadNotificationTypes()}render(){const{navModel:e,notificationChannelTypes:t}=this.props;return(0,f.jsx)(o.Z,{navModel:e,children:(0,f.jsxs)(o.Z.Contents,{children:[r||(r=(0,f.jsx)("h2",{className:"page-sub-heading",children:"New notification channel"})),(0,f.jsx)(l.Form,{onSubmit:this.onSubmit,validateOn:"onChange",defaultValues:d.Pg,maxWidth:600,children:e=>{let{register:n,errors:r,control:s,getValues:a,watch:l}=e;const o=t.find((e=>e.value===a().type.value));return(0,f.jsx)(c.w,{selectableChannels:(0,d.t7)(t,!0),selectedChannel:o,onTestChannel:this.onTestChannel,register:n,errors:r,getValues:a,control:s,watch:l,imageRendererAvailable:i.config.rendererAvailable,resetSecureField:this.props.resetSecureField,secureFields:{}})}})]})})}}const b={createNotificationChannel:p.C2,loadNotificationTypes:p.fA,testNotificationChannel:p.c1,resetSecureField:g.J0},v=(0,a.connect)((e=>({navModel:(0,u.h)(e.navIndex,"channels"),notificationChannelTypes:e.notificationChannel.notificationChannelTypes})),b)(h)},"./public/app/features/alerting/components/NotificationChannelForm.tsx":(e,t,n)=>{n.d(t,{w:()=>j});var r,s=n("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),a=n("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),i=n("./packages/grafana-ui/src/index.ts"),l=n("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const o=e=>{let{currentFormValues:t,imageRendererAvailable:n,register:s}=e;return(0,l.jsxs)(i.CollapsableSection,{label:"Notification settings",isOpen:!1,children:[(0,l.jsx)(i.Field,{children:(0,l.jsx)(i.Checkbox,Object.assign({},s("isDefault"),{label:"Default",description:"Use this notification for all alerts"}))}),(0,l.jsx)(i.Field,{children:(0,l.jsx)(i.Checkbox,Object.assign({},s("settings.uploadImage"),{label:"Include image",description:"Captures an image and include it in the notification"}))}),t.uploadImage&&!n&&(r||(r=(0,l.jsx)(i.InfoBox,{title:"No image renderer available/installed",children:"Grafana cannot find an image renderer to capture an image for the notification. Please make sure the Grafana Image Renderer plugin is installed. Please contact your Grafana administrator to install the plugin."}))),(0,l.jsx)(i.Field,{children:(0,l.jsx)(i.Checkbox,Object.assign({},s("disableResolveMessage"),{label:"Disable Resolve Message",description:"Disable the resolve message [OK] that is sent when alerting state returns to false"}))}),(0,l.jsx)(i.Field,{children:(0,l.jsx)(i.Checkbox,Object.assign({},s("sendReminder"),{label:"Send reminders",description:"Send additional notifications for triggered alerts"}))}),t.sendReminder&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(i.Field,{label:"Send reminder every",description:"Specify how often reminders should be sent, e.g. every 30s, 1m, 10m, 30m', or 1h etc. Alert reminders are sent after rules are evaluated. A reminder can never be sent more frequently than a configured alert rule evaluation interval.",children:(0,l.jsx)(i.Input,Object.assign({},s("frequency"),{width:8}))})})]})},c=["ref"];const d=e=>{let{control:t,option:n,register:r,invalid:s}=e;const a=n.secure?`secureSettings.${n.propertyName}`:`settings.${n.propertyName}`;switch(n.element){case"input":return(0,l.jsx)(i.Input,Object.assign({},r(`${a}`,{required:!!n.required&&"Required",validate:e=>""===n.validationRule||u(e,n.validationRule)}),{invalid:s,type:n.inputType,placeholder:n.placeholder}));case"select":return(0,l.jsx)(i.InputControl,{control:t,name:`${a}`,render:e=>{var t;let{}=e,r=function(e,t){if(null==e)return{};var n,r,s={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e.field,c);return(0,l.jsx)(i.Select,Object.assign({menuShouldPortal:!0},r,{options:null!==(t=n.selectOptions)&&void 0!==t?t:void 0,invalid:s}))}});case"textarea":return(0,l.jsx)(i.TextArea,Object.assign({invalid:s},r(`${a}`,{required:!!n.required&&"Required",validate:e=>""===n.validationRule||u(e,n.validationRule)})));default:return console.error("Element not supported",n.element),null}},u=(e,t)=>!!RegExp(t).test(e)||"Invalid format",p=e=>{let{control:t,currentFormValues:n,errors:r,selectedChannelOptions:s,register:a,onResetSecureField:o,secureFields:c}=e;return(0,l.jsx)(l.Fragment,{children:s.map(((e,s)=>{var u;const p=`${e.label}-${s}`,g=n[`settings.${e.showWhen.field}`]&&n[`settings.${e.showWhen.field}`].value;return e.showWhen.field&&g!==e.showWhen.is?null:"checkbox"===e.element?(0,l.jsx)(i.Field,{children:(0,l.jsx)(i.Checkbox,Object.assign({},a(e.secure?`secureSettings.${e.propertyName}`:`settings.${e.propertyName}`),{label:e.label,description:e.description}))},p):(0,l.jsx)(i.Field,{label:e.label,description:e.description,invalid:r.settings&&!!r.settings[e.propertyName],error:r.settings&&(null===(u=r.settings[e.propertyName])||void 0===u?void 0:u.message),children:c&&c[e.propertyName]?(0,l.jsx)(i.Input,{readOnly:!0,value:"Configured",suffix:(0,l.jsx)(i.Button,{onClick:()=>o(e.propertyName),fill:"text",type:"button",size:"sm",children:"Clear"})}):(0,l.jsx)(d,{option:e,register:a,control:t})},p)}))})},g=["ref"];const f=e=>{let{control:t,currentFormValues:n,errors:r,secureFields:s,selectedChannel:a,channels:o,register:c,resetSecureField:d}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.Field,{label:"Name",invalid:!!r.name,error:r.name&&r.name.message,children:(0,l.jsx)(i.Input,Object.assign({},c("name",{required:"Name is required"})))}),(0,l.jsx)(i.Field,{label:"Type",children:(0,l.jsx)(i.InputControl,{name:"type",render:e=>{let{}=e,t=function(e,t){if(null==e)return{};var n,r,s={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e.field,g);return(0,l.jsx)(i.Select,Object.assign({menuShouldPortal:!0},t,{options:o}))},control:t,rules:{required:!0}})}),(0,l.jsx)(p,{selectedChannelOptions:a.options.filter((e=>e.required)),currentFormValues:n,secureFields:s,onResetSecureField:d,register:c,errors:r,control:t})]})},m=e=>{var t;let{control:n,currentFormValues:r,errors:s,selectedChannel:a,secureFields:o,register:c,resetSecureField:d}=e;return(0,l.jsxs)(i.CollapsableSection,{label:`Optional ${a.heading}`,isOpen:!1,children:[""!==a.info&&(0,l.jsx)(i.Alert,{severity:"info",title:null!==(t=a.info)&&void 0!==t?t:""}),(0,l.jsx)(p,{selectedChannelOptions:a.options.filter((e=>!e.required)),currentFormValues:r,register:c,errors:s,control:n,onResetSecureField:d,secureFields:o})]})};var h,b,v,x=n("./public/app/core/config.ts");const j=e=>{let{control:t,errors:n,selectedChannel:r,selectableChannels:a,register:c,watch:d,getValues:u,imageRendererAvailable:p,onTestChannel:g,resetSecureField:j,secureFields:C}=e;const S=y((0,i.useTheme)());(0,s.useEffect)((()=>{const e=new Set(null==r?void 0:r.options.filter((e=>e.showWhen.field)).map((e=>`settings.${e.showWhen.field}`)))||[];d(["type","sendReminder","uploadImage",...e])}),[null==r?void 0:r.options,d]);const F=u();return r?(0,l.jsxs)("div",{className:S.formContainer,children:[(0,l.jsx)("div",{className:S.formItem,children:(0,l.jsx)(f,{selectedChannel:r,channels:a,secureFields:C,resetSecureField:j,currentFormValues:F,register:c,errors:n,control:t})}),r.options.filter((e=>!e.required)).length>0&&(0,l.jsx)("div",{className:S.formItem,children:(0,l.jsx)(m,{selectedChannel:r,secureFields:C,resetSecureField:j,currentFormValues:F,register:c,errors:n,control:t})}),(0,l.jsx)("div",{className:S.formItem,children:(0,l.jsx)(o,{imageRendererAvailable:p,currentFormValues:F,register:c,errors:n,control:t})}),(0,l.jsx)("div",{className:S.formButtons,children:(0,l.jsxs)(i.HorizontalGroup,{children:[b||(b=(0,l.jsx)(i.Button,{type:"submit",children:"Save"})),(0,l.jsx)(i.Button,{type:"button",variant:"secondary",onClick:()=>g(u()),children:"Test"}),(0,l.jsx)("a",{href:`${x.ZP.appSubUrl}/alerting/notifications`,children:v||(v=(0,l.jsx)(i.Button,{type:"button",variant:"secondary",children:"Back"}))})]})})]}):h||(h=(0,l.jsx)(i.Spinner,{}))},y=(0,i.stylesFactory)((e=>({formContainer:a.css``,formItem:a.css`
      flex-grow: 1;
      padding-top: ${e.spacing.md};
    `,formButtons:a.css`
      padding-top: ${e.spacing.xl};
    `})))},"./public/app/features/alerting/state/actions.ts":(e,t,n)=>{n.d(t,{Au:()=>l,en:()=>o,C2:()=>c,fg:()=>d,c1:()=>u,fA:()=>p,tk:()=>g});var r=n("./packages/grafana-data/src/index.ts"),s=n("./packages/grafana-runtime/src/index.ts"),a=n("./public/app/core/core.ts"),i=n("./public/app/features/alerting/state/reducers.ts");function l(e){return async t=>{t((0,i.gz)());const n=await(0,s.getBackendSrv)().get("/api/alerts",e);t((0,i.Oc)(n))}}function o(e,t){return async n=>{await(0,s.getBackendSrv)().post(`/api/alerts/${e}/pause`,t);n(l({state:(s.locationService.getSearchObject().state||"all").toString()}))}}function c(e){return async t=>{try{await(0,s.getBackendSrv)().post("/api/alert-notifications",e),a.h$.emit(r.AppEvents.alertSuccess,["Notification created"]),s.locationService.push("/alerting/notifications")}catch(e){a.h$.emit(r.AppEvents.alertError,[e.data.error])}}}function d(e){return async t=>{try{await(0,s.getBackendSrv)().put(`/api/alert-notifications/${e.id}`,e),a.h$.emit(r.AppEvents.alertSuccess,["Notification updated"])}catch(e){a.h$.emit(r.AppEvents.alertError,[e.data.error])}}}function u(e){return async(t,n)=>{const r=n().notificationChannel.notificationChannel;await(0,s.getBackendSrv)().post("/api/alert-notifications/test",Object.assign({id:r.id},e))}}function p(){return async e=>{const t=(await(0,s.getBackendSrv)().get("/api/alert-notifiers")).sort(((e,t)=>e.name>t.name?1:-1));e((0,i.T2)(t))}}function g(e){return async t=>{await t(p());const n=await(0,s.getBackendSrv)().get(`/api/alert-notifications/${e}`);t((0,i.K)(n))}}},"./public/app/features/alerting/utils/notificationChannels.ts":(e,t,n)=>{n.d(t,{Pg:()=>s,t7:()=>a,YV:()=>i,dv:()=>l});var r=n("./.yarn/cache/memoize-one-npm-6.0.0-8b2a2cd020-f185ea69f7.zip/node_modules/memoize-one/dist/memoize-one.esm.js");const s={id:-1,name:"",type:{value:"email",label:"Email"},sendReminder:!1,disableResolveMessage:!1,frequency:"15m",settings:{uploadImage:n("./packages/grafana-runtime/src/index.ts").config.rendererAvailable,autoResolve:!0,httpMethod:"POST",severity:"critical"},secureSettings:{},secureFields:{},isDefault:!1},a=(0,r.Z)(((e,t)=>e.map((e=>t?{value:e.value,label:e.label,description:e.description}:{value:e.value,label:e.label})))),i=e=>{const t=Object.fromEntries(Object.entries(e.settings).map((e=>{let[t,n]=e;return[t,n&&n.hasOwnProperty("value")?n.value:n]})));return Object.assign({},s,e,{frequency:""===e.frequency?s.frequency:e.frequency,type:e.type.value,settings:Object.assign({},s.settings,t),secureSettings:Object.assign({},e.secureSettings)})},l=e=>{var t;return{name:e.name,type:e.type.value,frequency:null!==(t=e.frequency)&&void 0!==t?t:s.frequency,settings:Object.assign({},Object.assign(s.settings,e.settings)),secureSettings:Object.assign({},e.secureSettings)}}}}]);
//# sourceMappingURL=NewNotificationChannel.07a78e2e5dfa22b54847.js.map