(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9897],{"./public/app/plugins/datasource/elasticsearch/module.ts":(e,t,s)=>{"use strict";s.r(t),s.d(t,{plugin:()=>Cs});var n=s("./packages/grafana-data/src/index.ts"),a=s("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),r=s("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/lastValueFrom.js"),i=s("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/observable/throwError.js"),l=s("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/observable/generate.js"),o=s("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/observable/of.js"),c=s("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/operators/map.js"),d=s("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),u=s("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js"),m=s("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/operators/skipWhile.js"),p=s("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/operators/throwIfEmpty.js"),h=s("./.yarn/cache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/operators/first.js"),v=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/index.js"),g=s("./packages/grafana-runtime/src/index.ts"),f=s("./.yarn/cache/prismjs-npm-1.25.0-8d60169ac0-04d8eae9d1.zip/node_modules/prismjs/prism.js"),b=s.n(f),y=s("./public/app/plugins/datasource/prometheus/promql.ts");class _ extends n.LanguageProvider{constructor(e,t){var s,n,a;super(),a=void 0,(n="datasource")in(s=this)?Object.defineProperty(s,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[n]=a,this.datasource=e,Object.assign(this,t)}importQueries(e,t){return"prometheus"===t||"loki"===t?e.map((e=>({metrics:[{id:"1",type:"logs"}],query:function(e){let t=[];for(let s of e)switch(s[1]){case"=":t.push(s[0]+":"+s[2]);break;case"!=":t.push("NOT "+s[0]+":"+s[2]);break;case"=~":t.push(s[0]+":/"+s[2].substring(1,s[2].length-1)+"/");break;case"!~":t.push("NOT "+s[0]+":/"+s[2].substring(1,s[2].length-1)+"/")}return t.join(" AND ")}(function(e){const t=[];if(!e||0===e.length)return t;const s=b().tokenize(e,y.ZP),n=function(e,t){let s="";for(let e in t)if("string"==typeof t[e]){s=t[e];break}return s}(0,s);n&&n.length>0&&t.push(["__name__","=",'"'+n+'"']);for(let e in s)if(s[e]instanceof f.Token){let n=s[e];if("context-labels"===n.type){let e="",s="",a="",r=n.content;for(let n in r)if("string"==typeof r[n]){let e;e=r[n],"="!==e&&"!="!==e&&"=~"!==e&&"!~"!==e||(a=e)}else if(r[n]instanceof f.Token)switch(r[n].type){case"label-key":e=r[n].content;break;case"label-value":s=r[n].content,t.push([e,a,s])}}}return t}(e.expr)),refId:e.refId}))):e.map((e=>({refId:e.refId})))}}var x=s("./public/app/core/utils/flatten.ts");const j=e=>{var t;return"ewma"===(null===(t=e.settings)||void 0===t?void 0:t.model)},w=e=>{var t;return"holt"===(null===(t=e.settings)||void 0===t?void 0:t.model)},E=e=>{var t;return"holt_winters"===(null===(t=e.settings)||void 0===t?void 0:t.model)},I=e=>{var t;return["holt","ewma","holt_winters"].includes((null===(t=e.settings)||void 0===t?void 0:t.model)||"")},S=e=>z[e.type].requiresField,N=e=>z[e.type].isPipelineAgg,O=e=>z[e.type].supportsMultipleBucketPaths,T=e=>z[e.type].supportsMissing,$=e=>z[e.type].hasSettings,k=e=>z[e.type].supportsInlineScript,R=["count","avg","sum","min","max","extended_stats","percentiles","cardinality","raw_document","raw_data","logs","moving_avg","moving_fn","derivative","serial_diff","cumulative_sum","bucket_script","rate","top_metrics"],A=e=>({name:e,pipelineAgg:""}),F=e=>`var${Math.max(0,...e.map((e=>{var t;return parseInt((null===(t=e.name.match("^var(\\d+)$"))||void 0===t?void 0:t[1])||"0",10)})))+1}`,z={count:{label:"Count",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!1,hasMeta:!1,supportsInlineScript:!1,defaults:{}},avg:{label:"Average",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},sum:{label:"Sum",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},max:{label:"Max",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},min:{label:"Min",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},extended_stats:{label:"Extended Stats",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!0,defaults:{meta:{std_deviation_bounds_lower:!0,std_deviation_bounds_upper:!0}}},percentiles:{label:"Percentiles",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{settings:{percents:["25","50","75","95","99"]}}},cardinality:{label:"Unique Count",requiresField:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},moving_avg:{label:"Moving Average",requiresField:!0,isPipelineAgg:!0,versionRange:">=2.0.0 <8.0.0",supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{model:"simple",window:"5"}}},moving_fn:{label:"Moving Function",requiresField:!0,isPipelineAgg:!0,supportsMultipleBucketPaths:!1,supportsInlineScript:!1,supportsMissing:!1,hasMeta:!1,hasSettings:!0,versionRange:">=7.0.0",defaults:{}},derivative:{label:"Derivative",requiresField:!0,isPipelineAgg:!0,versionRange:">=2.0.0",supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},serial_diff:{label:"Serial Difference",requiresField:!0,isPipelineAgg:!0,versionRange:">=2.0.0",supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{lag:"1"}}},cumulative_sum:{label:"Cumulative Sum",requiresField:!0,isPipelineAgg:!0,versionRange:">=2.0.0",supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},bucket_script:{label:"Bucket Script",requiresField:!1,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!0,versionRange:">=2.0.0",hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{pipelineVariables:[A(F([]))]}},raw_document:{label:"Raw Document (legacy)",requiresField:!1,isSingleMetric:!0,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{size:"500"}}},raw_data:{label:"Raw Data",requiresField:!1,isSingleMetric:!0,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{size:"500"}}},logs:{label:"Logs",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,isSingleMetric:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{limit:"500"}}},top_metrics:{label:"Top Metrics",xpack:!0,requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,versionRange:">=7.7.0",hasMeta:!1,defaults:{settings:{order:"desc"}}},rate:{label:"Rate",xpack:!0,versionRange:">=7.10.0",requiresField:!0,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!0,hasMeta:!1,defaults:{}}},C={moving_avg:[{label:"window",default:5},{label:"model",default:"simple"},{label:"predict"},{label:"minimize",default:!1}],moving_fn:[{label:"window",default:5},{label:"script"}],derivative:[{label:"unit"}],serial_diff:[{label:"lag"}],cumulative_sum:[{label:"format"}],bucket_script:[]},L=(e,t)=>{const s=t.filter((t=>{var s;return O(t)?null===(s=t.pipelineVariables)||void 0===s?void 0:s.some((t=>t.pipelineAgg===e.id)):S(t)&&e.id===t.field}));return[...s,...s.flatMap((e=>L(e,t)))]},M=[{label:"Avg",value:"avg"},{label:"Min",value:"min"},{label:"Max",value:"max"},{label:"Sum",value:"sum"},{label:"Count",value:"count"},{label:"Std Dev",value:"std_deviation"},{label:"Std Dev Upper",value:"std_deviation_bounds_upper"},{label:"Std Dev Lower",value:"std_deviation_bounds_lower"}],P=[{label:"Simple",value:"simple"},{label:"Linear",value:"linear"},{label:"Exponentially Weighted",value:"ewma"},{label:"Holt Linear",value:"holt"},{label:"Holt Winters",value:"holt_winters"}],q="@HIGHLIGHT@",D="@/HIGHLIGHT@";function V(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";return{type:"count",id:e}}function B(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";return{type:"date_histogram",id:e,settings:{interval:"auto"}}}const U=(e,t)=>e.find((e=>e.id===t));function G(e,t){var s;return!(null==e||null===(s=e.metrics)||void 0===s||!s.some((e=>e.type===t)))}var H=s("./public/app/core/table_model.ts");const W=e=>S(e)?`${z[e.type].label} ${e.field}`:z[e.type].label,Q=e=>Object.entries(e).reduce(((e,t)=>{let[s,n]=t;if(null==n)return Object.assign({},e);if(Array.isArray(n)&&0===n.length)return Object.assign({},e);if(0===(null==n?void 0:n.length))return Object.assign({},e);if(!Array.isArray(n)&&"object"==typeof n){const t=Q(n);return 0===Object.keys(t).length?Object.assign({},e):Object.assign({},e,{[s]:t})}return Object.assign({},e,{[s]:n})}),{}),X=e=>{const t=e.match(/^(\d+)/);return t?t[1]:void 0},Y=e=>{var t,s,n,a;return("object"==typeof(null===(t=e.settings)||void 0===t?void 0:t.script)?null===(s=e.settings)||void 0===s||null===(n=s.script)||void 0===n?void 0:n.inline:null===(a=e.settings)||void 0===a?void 0:a.script)||""},Z=e=>{if("string"==typeof e)return(0,v.valid)(e)||"5.0.0";switch(e){case 2:return"2.0.0";case 56:return"5.6.0";case 60:return"6.0.0";case 70:return"7.0.0";default:return"5.0.0"}};const J=`${q}([^@]+)${D}`;class K{constructor(e,t){var s,n,a;a=()=>{const e=[];for(let t=0;t<this.response.responses.length;t++){const s=this.response.responses[t],n=this.targets[t];if(s.error)throw this.getErrorFromElasticResponse(this.response,s.error);if(s.hits&&s.hits.hits.length>0&&this.processHits(s.hits,e,n),s.aggregations){const n=s.aggregations,a=this.targets[t],r=[],i=new H.Z;i.refId=a.refId,this.processBuckets(n,a,r,i,{},0),this.trimDatapoints(r,a),this.nameSeries(r,a);for(let t=0;t<r.length;t++)e.push(r[t]);i.rows.length>0&&e.push(i)}}return{data:e}},(n="processResponseToSeries")in(s=this)?Object.defineProperty(s,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[n]=a,this.targets=e,this.response=t,this.targets=e,this.response=t}processMetrics(e,t,s,n){let a;for(let o=0;o<t.metrics.length;o++){const c=t.metrics[o];if(!c.hide)switch(c.type){case"count":a={datapoints:[],metric:"count",props:n,refId:t.refId};for(let t=0;t<e.buckets.length;t++){const s=e.buckets[t],n=s.doc_count;a.datapoints.push([n,s.key])}s.push(a);break;case"percentiles":{if(0===e.buckets.length)break;const r=e.buckets[0][c.id].values;for(const i in r){a={datapoints:[],metric:"p"+i,props:n,field:c.field,refId:t.refId};for(let t=0;t<e.buckets.length;t++){const s=e.buckets[t],n=s[c.id].values;a.datapoints.push([n[i],s.key])}s.push(a)}break}case"extended_stats":for(const r in c.meta)if(c.meta[r]){a={datapoints:[],metric:r,props:n,field:c.field,refId:t.refId};for(let t=0;t<e.buckets.length;t++){const s=e.buckets[t],n=s[c.id];n.std_deviation_bounds_upper=n.std_deviation_bounds.upper,n.std_deviation_bounds_lower=n.std_deviation_bounds.lower,a.datapoints.push([n[r],s.key])}s.push(a)}break;case"top_metrics":var r,i;if(null!==(r=c.settings)&&void 0!==r&&null!==(i=r.metrics)&&void 0!==i&&i.length)for(const r of null===(l=c.settings)||void 0===l?void 0:l.metrics){var l;a={datapoints:[],metric:c.type,props:n,refId:t.refId,field:r};for(let t=0;t<e.buckets.length;t++){const s=e.buckets[t],n=s[c.id].top.map((e=>e.metrics[r]?e.metrics[r]:null)),i=[n[n.length-1],s.key];a.datapoints.push(i)}s.push(a)}break;default:a={datapoints:[],metric:c.type,metricId:c.id,props:n,refId:t.refId},S(c)&&(a.field=c.field);for(let t=0;t<e.buckets.length;t++){const s=e.buckets[t],n=s[c.id];void 0!==n&&(n.normalized_value?a.datapoints.push([n.normalized_value,s.key]):a.datapoints.push([n.value,s.key]))}s.push(a)}}}processAggregationDocs(e,t,s,n,r){if(0===n.columns.length){for(const e of(0,a.keys)(r))n.addColumn({text:e,filterable:!0});n.addColumn({text:t.field,filterable:!0})}const i=(e,t,s)=>{n.addColumn({text:t}),e.push(s)},l=(0,a.isArray)(e.buckets)?e.buckets:[e.buckets];for(const e of l){const t=[];for(const e of(0,a.values)(r))t.push(e);t.push(e.key);for(const n of s.metrics||[])switch(n.type){case"count":i(t,this.getMetricName(n.type),e.doc_count);break;case"extended_stats":for(const s in n.meta){if(!n.meta[s])continue;const a=e[n.id];a.std_deviation_bounds_upper=a.std_deviation_bounds.upper,a.std_deviation_bounds_lower=a.std_deviation_bounds.lower,i(t,this.getMetricName(s),a[s])}break;case"percentiles":{const s=e[n.id].values;for(const e in s)i(t,`p${e} ${n.field}`,s[e]);break}case"top_metrics":{var o;const s=this.getMetricName(n.type);if(null!==(o=n.settings)&&void 0!==o&&o.metrics)for(const a of n.settings.metrics){i(t,n.settings.metrics.length>1?`${s} ${a}`:s,e[n.id].top[0].metrics[a])}break}default:{let r=this.getMetricName(n.type);(0,a.filter)(s.metrics,{type:n.type}).length>1&&(S(n)&&(r+=" "+n.field),"bucket_script"===n.type&&(r=Y(n))),i(t,r,e[n.id].value);break}}n.rows.push(t)}}processBuckets(e,t,s,n,r,i){let l,o,c,d;const u=t.bucketAggs.length-1;for(d in e)if(o=(0,a.find)(t.bucketAggs,{id:d}),c=e[d],o)if(i===u)"date_histogram"===o.type?this.processMetrics(c,t,s,r):this.processAggregationDocs(c,o,t,n,r);else for(const e in c.buckets)l=c.buckets[e],r=(0,a.clone)(r),void 0!==l.key?r[o.field]=l.key:r.filter=e,l.key_as_string&&(r[o.field]=l.key_as_string),this.processBuckets(l,t,s,n,r,i+1)}getMetricName(e){const t=Object.entries(z).filter((t=>{let[s]=t;return s===e})).map((e=>{let[t,s]=e;return s}))[0];if(t)return t.label;const s=M.find((t=>t.value===e));return s?s.label:e}getSeriesName(e,t,s){let n=this.getMetricName(e.metric);if(t.alias){const s=/\{\{([\s\S]+?)\}\}/g;return t.alias.replace(s,((t,s,a)=>{const r=s||a;return 0===r.indexOf("term ")?e.props[r.substring(5)]:void 0!==e.props[r]?e.props[r]:"metric"===r?n:"field"===r?e.field||"":t}))}if(e.metric in C)if(e.metric&&function(e){return!!z[e].supportsMultipleBucketPaths}(e.metric)){const s=(0,a.find)(t.metrics,{id:e.metricId});if(s&&s.settings.script){n=Y(s);for(const e of s.pipelineVariables){const s=(0,a.find)(t.metrics,{id:e.pipelineAgg});s&&(n=n.replace("params."+e.name,W(s)))}}else n="Unset"}else{const s=(0,a.find)(t.metrics,{id:e.field});s?n+=" "+W(s):n="Unset"}else e.field&&(n+=" "+e.field);if(0===(0,a.keys)(e.props).length)return n;let r="";for(const t in e.props)r+=e.props[t]+" ";return s?r.trim()+" "+n:r.trim()}nameSeries(e,t){var s;const n=(0,a.uniq)((0,a.map)(e,"metric")).length,r=(null===(s=t.metrics)||void 0===s?void 0:s.filter((e=>"top_metrics"===e.type))).some((e=>{var t,s;return((null==e||null===(t=e.settings)||void 0===t||null===(s=t.metrics)||void 0===s?void 0:s.length)||0)>1}));for(let s=0;s<e.length;s++){const a=e[s];a.target=this.getSeriesName(a,t,n>1||r)}}processHits(e,t,s){const n="number"==typeof e.total?e.total:e.total.value,a={target:s.refId,type:"docs",refId:s.refId,datapoints:[],total:n,filterable:!0};let r,i,l,o;for(o=0;o<e.hits.length;o++){if(i=e.hits[o],l={_id:i._id,_type:i._type,_index:i._index,sort:i.sort,highlight:i.highlight},i._source)for(r in i._source)l[r]=i._source[r];for(r in i.fields)l[r]=i.fields[r];a.datapoints.push(l)}t.push(a)}trimDatapoints(e,t){const s=(0,a.find)(t.bucketAggs,{type:"date_histogram"});if(s&&s.settings&&s.settings.trimEdges){const t=s.settings.trimEdges;for(const s in e){const n=e[s];n.datapoints.length>2*t&&(n.datapoints=n.datapoints.slice(t,n.datapoints.length-t))}}}getErrorFromElasticResponse(e,t){const s={};return s.data=JSON.stringify(t,null,4),t.root_cause&&t.root_cause.length>0&&t.root_cause[0].reason?s.message=t.root_cause[0].reason:s.message=t.reason||"Unknown elastic error response",e.$$config&&(s.config=e.$$config),s}getTimeSeries(){return this.targets.some((e=>G(e,"raw_data")))?this.processResponseToDataFrames(!1):this.processResponseToSeries()}getLogs(e,t){return this.processResponseToDataFrames(!0,e,t)}processResponseToDataFrames(e,t,s){const r=[];for(let l=0;l<this.response.responses.length;l++){const o=this.response.responses[l];if(o.error)throw this.getErrorFromElasticResponse(this.response,o.error);if(o.hits){const{propNames:n,docs:c}=ee(o.hits.hits),d=c.length?te(n.map(ne(c)),e,this.targets[0].timeField,t,s):te([],e);e&&se(d,"logs");for(const e of c){if(s&&(e.level=e[s]),e.highlight){var i;const t=new RegExp(J,"g"),s=new RegExp(J),n=Object.keys(e.highlight).flatMap((n=>e.highlight[n].flatMap((e=>{const n=e.match(t);return n?n.map((e=>{const t=e.match(s);return t&&t[1]||null})):[]})))).filter(a.identity),r=null!==(i=d.meta)&&void 0!==i&&i.searchWords?(0,a.uniq)([...d.meta.searchWords,...n]):[...n];d.meta=d.meta?Object.assign({},d.meta,{searchWords:r}):{searchWords:r}}d.add(e)}const u=this.targets[l];d.refId=u.refId,r.push(d)}if(o.aggregations){const t=o.aggregations,s=this.targets[l],a=[],i=new H.Z;if(this.processBuckets(t,s,a,i,{},0),this.trimDatapoints(a,s),this.nameSeries(a,s),i.rows.length>0){const e=(0,n.toDataFrame)(i);e.refId=s.refId,r.push(e)}for(let t=0;t<a.length;t++){let i=(0,n.toDataFrame)(a[t]);e&&se(i,"graph"),i.refId=s.refId,r.push(i)}}}return{data:r}}}const ee=e=>{const t=[];let s=[];for(const n of e){const e=n._source?(0,x.default)(n._source):{},a=Object.assign({_id:n._id,_type:n._type,_index:n._index,sort:n.sort,highlight:n.highlight,_source:Object.assign({},e)},e);for(const e of Object.keys(a))-1===s.indexOf(e)&&s.push(e);t.push(a)}return s.sort(),{docs:t,propNames:s}},te=(e,t,s,a,r)=>{const i=new n.MutableDataFrame({fields:[]});s&&i.addField({config:{filterable:!0},name:s,type:n.FieldType.time}),a&&(i.addField({name:a,type:n.FieldType.string}).parse=e=>e||""),r&&(i.addField({name:"level",type:n.FieldType.string}).parse=e=>e||"");const l=i.fields.map((e=>e.name));for(const[s,n]of e)l.includes(s)||(t||"_source"!==s)&&(i.addField({config:{filterable:!0},name:s,type:n}).parse=e=>e||"");return i},se=(e,t)=>{let s=e;s.meta?s.meta.preferredVisualisationType=t:s.meta={preferredVisualisationType:t}},ne=e=>t=>{var s;return[t,ae(null===(s=e.find((e=>void 0!==e[t])))||void 0===s?void 0:s[t])]},ae=e=>{switch(typeof e){case"number":return n.FieldType.number;case"string":return n.FieldType.string;default:return n.FieldType.other}};const re={Hourly:{startOf:"hour",amount:"hours"},Daily:{startOf:"day",amount:"days"},Weekly:{startOf:"isoWeek",amount:"weeks"},Monthly:{startOf:"month",amount:"months"},Yearly:{startOf:"year",amount:"years"}};class ie{constructor(e,t){var s,n,a;a="en",(n="dateLocale")in(s=this)?Object.defineProperty(s,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[n]=a,this.pattern=e,this.interval=t}getIndexForToday(){return this.interval?(0,n.toUtc)().locale(this.dateLocale).format(this.pattern):this.pattern}getIndexList(e,t){if(!this.interval)return this.pattern;const s=re[this.interval],a=(0,n.dateTime)(e||(0,n.dateTime)(t).add(-7,s.amount)).utc().startOf(s.startOf),r=(0,n.dateTime)(t||(0,n.dateTime)(e).add(7,s.amount)).utc().startOf(s.startOf).valueOf(),i=[];for(;a.valueOf()<=r;)i.push(a.locale(this.dateLocale).format(this.pattern)),a.add(1,s.amount);return i}}function le(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class oe{constructor(e){le(this,"timeField",void 0),le(this,"esVersion",void 0),this.timeField=e.timeField,this.esVersion=e.esVersion}getRangeFilter(){const e={};return e[this.timeField]={gte:"$timeFrom",lte:"$timeTo",format:"epoch_millis"},e}buildTermsAgg(e,t,s){var n;if(t.terms={field:e.field},!e.settings)return t;const a=null!==(n=e.settings)&&void 0!==n&&n.size?parseInt(e.settings.size,10):500;if(t.terms.size=0===a?500:a,void 0!==e.settings.orderBy){t.terms.order={},"_term"===e.settings.orderBy&&(0,v.gte)(this.esVersion,"6.0.0")?t.terms.order._key=e.settings.order:t.terms.order[e.settings.orderBy]=e.settings.order;const n=X(e.settings.orderBy);if(n)for(let a of s.metrics||[])if(a.id===n){"count"===a.type?t.terms.order={_count:e.settings.order}:S(a)&&(t.aggs={},t.aggs[a.id]={[a.type]:{field:a.field}});break}}return void 0!==e.settings.min_doc_count&&(t.terms.min_doc_count=parseInt(e.settings.min_doc_count,10),isNaN(t.terms.min_doc_count)&&(t.terms.min_doc_count=e.settings.min_doc_count)),e.settings.missing&&(t.terms.missing=e.settings.missing),t}getDateHistogramAgg(e){const t={},s=e.settings||{};t.field=e.field||this.timeField,t.min_doc_count=s.min_doc_count||0,t.extended_bounds={min:"$timeFrom",max:"$timeTo"},t.format="epoch_millis",s.timeZone&&s.timeZone!==n.InternalTimeZones.utc&&(t.time_zone=s.timeZone),""!==s.offset&&(t.offset=s.offset);const a="auto"===s.interval?"$__interval":s.interval;return(0,v.gte)(this.esVersion,"8.0.0")?t.fixed_interval=a:t.interval=a,t}getHistogramAgg(e){const t={},s=e.settings||{};return t.interval=s.interval,t.field=e.field,t.min_doc_count=s.min_doc_count||0,t}getFiltersAgg(e){const t={};for(let{query:n,label:a}of(null===(s=e.settings)||void 0===s?void 0:s.filters)||[]){var s;t[a||n]={query_string:{query:n,analyze_wildcard:!0}}}return t}documentQuery(e,t){return e.size=t,e.sort=[{[this.timeField]:{order:"desc",unmapped_type:"boolean"}},{_doc:{order:"desc"}}],(0,v.lt)(this.esVersion,"5.0.0")&&(e.fields=["*","_source"]),e.script_fields={},e}addAdhocFilters(e,t){if(!t)return;let s,n,a,r;for(s=0;s<t.length;s++)switch(n=t[s],a={},a[n.key]=n.value,r={},r[n.key]={query:n.value},n.operator){case"=":e.query.bool.must||(e.query.bool.must=[]),e.query.bool.must.push({match_phrase:r});break;case"!=":e.query.bool.must_not||(e.query.bool.must_not=[]),e.query.bool.must_not.push({match_phrase:r});break;case"<":a[n.key]={lt:n.value},e.query.bool.filter.push({range:a});break;case">":a[n.key]={gt:n.value},e.query.bool.filter.push({range:a});break;case"=~":e.query.bool.filter.push({regexp:a});break;case"!~":e.query.bool.filter.push({bool:{must_not:{regexp:a}}})}}build(e,t){var s,n,a,r,i,l,o,c,d;let u,m,p,h,v;e.metrics=e.metrics||[V()],e.bucketAggs=e.bucketAggs||[B()],e.timeField=this.timeField;const g={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};if(e.query&&""!==e.query&&(g.query.bool.filter=[...g.query.bool.filter,{query_string:{analyze_wildcard:!0,query:e.query}}]),this.addAdhocFilters(g,t),0===e.bucketAggs.length&&(u=e.metrics[0],!u||"raw_document"!==u.type&&"raw_data"!==u.type))throw{message:"Invalid query"};if("raw_document"===(null===(s=e.metrics)||void 0===s||null===(n=s[0])||void 0===n?void 0:n.type)||"raw_data"===(null===(a=e.metrics)||void 0===a||null===(r=a[0])||void 0===r?void 0:r.type)){var f;u=e.metrics[0];const t=null!==(f=u.settings)&&void 0!==f&&f.size?parseInt(u.settings.size,10):500;return this.documentQuery(g,t||500)}for(v=g,m=0;m<e.bucketAggs.length;m++){const t=e.bucketAggs[m],s={};switch(t.type){case"date_histogram":s.date_histogram=this.getDateHistogramAgg(t);break;case"histogram":s.histogram=this.getHistogramAgg(t);break;case"filters":s.filters={filters:this.getFiltersAgg(t)};break;case"terms":this.buildTermsAgg(t,s,e);break;case"geohash_grid":var b;s.geohash_grid={field:t.field,precision:null===(b=t.settings)||void 0===b?void 0:b.precision}}v.aggs=v.aggs||{},v.aggs[t.id]=s,v=s}for(v.aggs={},m=0;m<e.metrics.length;m++){if(u=e.metrics[m],"count"===u.type)continue;const t={};let s={};if(N(u))if(O(u)){if(!u.pipelineVariables)continue;for(s={buckets_path:{}},p=0;p<u.pipelineVariables.length;p++)if(h=u.pipelineVariables[p],h.name&&h.pipelineAgg&&/^\d*$/.test(h.pipelineAgg)){const t=U(e.metrics,h.pipelineAgg);t&&("count"===t.type?s.buckets_path[h.name]="_count":s.buckets_path[h.name]=h.pipelineAgg)}}else{if(!u.field||!/^\d*$/.test(u.field))continue;{const t=U(e.metrics,u.field);t&&(s="count"===t.type?{buckets_path:"_count"}:{buckets_path:u.field})}}else S(u)&&(s={field:u.field});if($(u))switch(Object.entries(u.settings||{}).filter((e=>{let[t,s]=e;return null!==s})).forEach((e=>{let[t,n]=e;s[t]="script"===t?this.buildScript(Y(u)):n})),u.type){case"moving_avg":s=Object.assign({},s,void 0!==(null===(i=s)||void 0===i?void 0:i.window)&&{window:this.toNumber(s.window)},void 0!==(null===(l=s)||void 0===l?void 0:l.predict)&&{predict:this.toNumber(s.predict)},I(u)&&{settings:Object.assign({},s.settings,Object.fromEntries(Object.entries(s.settings||{}).filter((e=>{let[t]=e;return["alpha","beta","gamma","period"].includes(t)})).filter((e=>{let[t,s]=e;return void 0!==s})).map((e=>{let[t,s]=e;return[t,this.toNumber(s)]}))))});break;case"serial_diff":s=Object.assign({},s,void 0!==s.lag&&{lag:this.toNumber(s.lag)});break;case"top_metrics":var y,_;if(s={metrics:null===(o=u.settings)||void 0===o||null===(c=o.metrics)||void 0===c?void 0:c.map((e=>({field:e}))),size:1},null!==(d=u.settings)&&void 0!==d&&d.orderBy)s.sort=[{[null===(y=u.settings)||void 0===y?void 0:y.orderBy]:null===(_=u.settings)||void 0===_?void 0:_.order}]}t[u.type]=s,v.aggs[u.id]=t}return g}buildScript(e){return(0,v.gte)(this.esVersion,"5.6.0")?e:{inline:e}}toNumber(e){const t=parseFloat(`${e}`);return isNaN(t)?e:t}getTermsQuery(e){const t={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};e.query&&t.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:e.query}});let s=500;e.size&&(s=e.size),t.aggs={1:{terms:{field:e.field,size:s,order:{}}}};const{orderBy:n="key",order:a=("doc_count"===n?"desc":"asc")}=e;if(["asc","desc"].indexOf(a)<0)throw{message:`Invalid query sort order ${a}`};switch(n){case"key":case"term":const e=(0,v.gte)(this.esVersion,"6.0.0")?"_key":"_term";t.aggs[1].terms.order[e]=a;break;case"doc_count":t.aggs[1].terms.order._count=a;break;default:throw{message:`Invalid query sort type ${n}`}}return t}getLogsQuery(e,t,s){let n={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};return this.addAdhocFilters(n,s),e.query&&n.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:e.query}}),n=this.documentQuery(n,t),Object.assign({},n,{aggs:this.build(e,null).aggs,highlight:{fields:{"*":{}},pre_tags:[q],post_tags:[D],fragment_size:2147483647}})}}var ce=s("./public/app/features/templating/template_srv.ts");const de={terms:{label:"Terms",requiresField:!0,defaultSettings:{min_doc_count:"1",size:"10",order:"desc",orderBy:"_term"}},filters:{label:"Filters",requiresField:!1,defaultSettings:{filters:[{label:"",query:"*"}]}},geohash_grid:{label:"Geo Hash Grid",requiresField:!0,defaultSettings:{precision:"3"}},date_histogram:{label:"Date Histogram",requiresField:!0,defaultSettings:{interval:"auto",min_doc_count:"0",trimEdges:"0",timeZone:n.InternalTimeZones.utc}},histogram:{label:"Histogram",requiresField:!0,defaultSettings:{interval:"1000",min_doc_count:"0"}}},ue=[{label:"Term value",value:"_term"},{label:"Doc Count",value:"_count"}],me=[{label:"Top",value:"desc"},{label:"Bottom",value:"asc"}],pe=[{label:"No limit",value:"0"},{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"5",value:"5"},{label:"10",value:"10"},{label:"15",value:"15"},{label:"20",value:"20"}],he=e=>de[e.type].requiresField,ve=["date_histogram","histogram","terms","filters","geohash_grid"];var ge=s("./public/app/core/logs_model.ts");function fe(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const be=["_index","_type","_id","_source","_size","_field_names","_ignored","_routing","_meta"];class ye extends n.DataSourceApi{constructor(e){var t,s;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,ce.J)();super(e),fe(this,"basicAuth",void 0),fe(this,"withCredentials",void 0),fe(this,"url",void 0),fe(this,"name",void 0),fe(this,"index",void 0),fe(this,"timeField",void 0),fe(this,"esVersion",void 0),fe(this,"xpack",void 0),fe(this,"interval",void 0),fe(this,"maxConcurrentShardRequests",void 0),fe(this,"queryBuilder",void 0),fe(this,"indexPattern",void 0),fe(this,"logMessageField",void 0),fe(this,"logLevelField",void 0),fe(this,"dataLinks",void 0),fe(this,"languageProvider",void 0),fe(this,"includeFrozen",void 0),fe(this,"getLogRowContext",(async(e,t)=>{var s;const i=e.dataFrame.fields.find((e=>"sort"===e.name)),l=(null==i?void 0:i.values.get(e.rowIndex))||[e.timeEpochMs],o="FORWARD"===(null==t?void 0:t.direction)?"asc":"desc",c="FORWARD"===(null==t?void 0:t.direction)?this.getQueryHeader("query_then_fetch",(0,n.dateTime)(e.timeEpochMs)):this.getQueryHeader("query_then_fetch",void 0,(0,n.dateTime)(e.timeEpochMs)),d=null!==(s=null==t?void 0:t.limit)&&void 0!==s?s:10,u=[c,JSON.stringify({size:d,query:{bool:{filter:[{range:{[this.timeField]:{["FORWARD"===(null==t?void 0:t.direction)?"gte":"lte"]:e.timeEpochMs,format:"epoch_millis"}}}]}},sort:[{[this.timeField]:o},{_doc:o}],search_after:l})].join("\n")+"\n",m=this.getMultiSearchUrl(),p=await(0,r.n)(this.post(m,u)),h=[{refId:`${e.dataFrame.refId}`,metrics:[{type:"logs",id:"1"}]}],v=new K(h,function(e,t){if("desc"===t)return e;const s=e.responses[0];return Object.assign({},e,{responses:[Object.assign({},s,{hits:Object.assign({},s.hits,{hits:s.hits.hits.reverse()})})]})}(p,o)),g=v.getLogs(this.logMessageField,this.logLevelField),f=(0,a.first)(g.data);if(!f)return{data:[]};const b=f.fields.find((e=>e.name===this.timeField)),y=f.fields.find((e=>e.name===this.logMessageField));return b&&y?{data:[Object.assign({},f,{fields:[...f.fields,Object.assign({},b,{name:"ts"}),Object.assign({},y,{name:"line"})]})]}:g})),this.templateSrv=i,this.basicAuth=e.basicAuth,this.withCredentials=e.withCredentials,this.url=e.url,this.name=e.name,this.index=null!==(t=e.database)&&void 0!==t?t:"";const l=e.jsonData||{};this.timeField=l.timeField,this.esVersion=Z(l.esVersion),this.xpack=Boolean(l.xpack),this.indexPattern=new ie(this.index,l.interval),this.interval=l.timeInterval,this.maxConcurrentShardRequests=l.maxConcurrentShardRequests,this.queryBuilder=new oe({timeField:this.timeField,esVersion:this.esVersion}),this.logMessageField=l.logMessageField||"",this.logLevelField=l.logLevelField||"",this.dataLinks=l.dataLinks||[],this.includeFrozen=null!==(s=l.includeFrozen)&&void 0!==s&&s,""===this.logMessageField&&(this.logMessageField=void 0),""===this.logLevelField&&(this.logLevelField=void 0),this.languageProvider=new _(this)}request(e,t,s,n){const a={url:this.url+"/"+t,method:e,data:s,headers:n};return(this.basicAuth||this.withCredentials)&&(a.withCredentials=!0),this.basicAuth&&(a.headers={Authorization:this.basicAuth}),(0,g.getBackendSrv)().fetch(a).pipe((0,c.U)((e=>(e.data.$$config=e.config,e.data))),(0,d.K)((e=>{if(e.data){var t,s,n;const a=null!==(t=null!==(s=null===(n=e.data.error)||void 0===n?void 0:n.reason)&&void 0!==s?s:e.data.message)&&void 0!==t?t:"Unknown error";return(0,i._)({message:"Elasticsearch error: "+a,error:e.data.error})}return(0,i._)(e)})))}async importQueries(e,t){return this.languageProvider.importQueries(e,t.meta.id)}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,n.getDefaultTimeRange)(),s=this.indexPattern.getIndexList(t.from,t.to);Array.isArray(s)||(s=[this.indexPattern.getIndexForToday()]);const a=s.map((t=>t+e));return this.requestAllIndices(a)}requestAllIndices(e){const t=e.length;return(0,l.R)({initialState:0,condition:e=>e<Math.min(t,7),iterate:e=>e+1}).pipe((0,u.z)((s=>this.request("GET",e[t-s-1]).pipe((0,d.K)((e=>(0,o.of)({err:e})))))),(0,m.n)((e=>{var t;return 404===(null==e||null===(t=e.err)||void 0===t?void 0:t.status)})),(0,p.T)((()=>"Could not find an available index for this time range.")),(0,h.P)(),(0,c.U)((e=>{if(e.err)throw e.err;return e})))}post(e,t){return this.request("POST",e,t,{"Content-Type":"application/x-ndjson"})}annotationQuery(e){const t=e.annotation,s=t.timeField||"@timestamp",i=t.timeEndField||null,l=t.query,o=t.tagsField||"tags",d=t.textField||null,u=[],m={};if(m[s]={from:e.range.from.valueOf(),to:e.range.to.valueOf(),format:"epoch_millis"},u.push({range:m}),i){const t={};t[i]={from:e.range.from.valueOf(),to:e.range.to.valueOf(),format:"epoch_millis"},u.push({range:t})}const p=this.interpolateLuceneQuery(l),h={bool:{filter:[{bool:{should:u,minimum_should_match:1}}]}};p&&h.bool.filter.push({query_string:{query:p}});const g={query:h,size:1e4};(0,v.lt)(this.esVersion,"5.0.0")&&(g.fields=[s,"_source"]);const f={search_type:"query_then_fetch",ignore_unavailable:!0};t.index?f.index=t.index:f.index=this.indexPattern.getIndexList(e.range.from,e.range.to);const b=JSON.stringify(f)+"\n"+JSON.stringify(g)+"\n";return(0,r.n)(this.post("_msearch",b).pipe((0,c.U)((e=>{const r=[],l=e.responses[0].hits.hits,c=(e,t)=>{if(!t)return;const s=t.split(".");let n=e;for(let e=0;e<s.length;e++)if(n=n[s[e]],!n)return console.log("could not find field in annotation: ",t),"";return n};for(let e=0;e<l.length;e++){const u=l[e]._source;let m=c(u,s);if(void 0!==l[e].fields){const t=l[e].fields;((0,a.isString)(t[s])||(0,a.isNumber)(t[s]))&&(m=t[s])}const p={annotation:t,time:(0,n.toUtc)(m).valueOf(),text:c(u,d),tags:c(u,o)};if(i){const e=c(u,i);e&&(p.timeEnd=(0,n.toUtc)(e).valueOf())}if(t.titleField){const e=c(u,t.titleField);e&&(p.text=e+"\n"+p.text)}"string"==typeof p.tags&&(p.tags=p.tags.split(",")),r.push(p)}return r}))))}interpolateLuceneQuery(e,t){return this.templateSrv.replace(e,t,"lucene")}interpolateVariablesInQueries(e,t){const s=e=>{var s,n;return"filters"===e.type?Object.assign({},e,{settings:Object.assign({},e.settings,{filters:null===(s=e.settings)||void 0===s||null===(n=s.filters)||void 0===n?void 0:n.map((e=>Object.assign({},e,{query:this.interpolateLuceneQuery(e.query,t)||"*"})))})}):e},n=e.map((e=>{var n;return Object.assign({},e,{datasource:this.getRef(),query:this.interpolateLuceneQuery(e.query||"",t),bucketAggs:null===(n=e.bucketAggs)||void 0===n?void 0:n.map(s)})}));return JSON.parse(this.templateSrv.replace(JSON.stringify(n),t))}testDatasource(){return(0,r.n)(this.getFields(["date"]).pipe((0,u.z)((e=>(0,a.find)(e,{text:this.timeField})?(0,o.of)({status:"success",message:"Index OK. Time field name OK."}):(0,o.of)({status:"error",message:"No date field named "+this.timeField+" found"}))),(0,d.K)((e=>(console.error(e),e.message?(0,o.of)({status:"error",message:e.message}):(0,o.of)({status:"error",message:e.status}))))))}getQueryHeader(e,t,s){const n={search_type:e,ignore_unavailable:!0,index:this.indexPattern.getIndexList(t,s)};return(0,v.satisfies)(this.esVersion,">=5.6.0 <7.0.0")&&(n.max_concurrent_shard_requests=this.maxConcurrentShardRequests),JSON.stringify(n)}getQueryDisplayText(e){const t=e.metrics,s=e.bucketAggs;let n="";return e.query&&(n+="Query: "+e.query+", "),n+="Metrics: ",n+=null==t?void 0:t.reduce(((e,t)=>{let s=z[t.type].label+"(";return S(t)&&(s+=t.field),O(t)&&(s+=Y(t).replace(new RegExp("params.","g"),"")),s+="), ",`${e} ${s}`}),""),n+=null==s?void 0:s.reduce(((e,t,s)=>{let n="";return 0===s&&(n+=" Group by: "),n+=de[t.type].label+"(",he(t)&&(n+=t.field),`${e} ${n}), `}),""),e.alias&&(n+="Alias: "+e.alias),n}showContextToggle(){return(0,v.gte)(this.esVersion,"5.0.0")}getLogsVolumeDataProvider(e){if(!e.targets.some((e=>{var t;return 1===(null===(t=e.metrics)||void 0===t?void 0:t.length)&&"logs"===e.metrics[0].type})))return;const t=(0,a.cloneDeep)(e);return t.targets=t.targets.map((e=>{var t;const s=[],a=null!==(t=this.timeField)&&void 0!==t?t:"@timestamp";this.logLevelField&&s.push({id:"2",type:"terms",settings:{min_doc_count:"0",size:"0",order:"desc",orderBy:"_count",missing:n.LogLevel.unknown},field:this.logLevelField}),s.push({id:"3",type:"date_histogram",settings:{interval:"auto",min_doc_count:"0",trimEdges:"0"},field:a});return{refId:e.refId,query:e.query,metrics:[{type:"count",id:"1"}],timeField:a,bucketAggs:s}})),(0,ge.Bz)(this,t,{range:e.range,targets:e.targets,extractLevel:e=>(0,n.getLogLevelFromKey)(e.name||"")})}query(e){let t="";const s=this.interpolateVariablesInQueries((0,a.cloneDeep)(e.targets),e.scopedVars),n=[];let r=s.some((e=>G(e,"logs")));const i=this.templateSrv.getAdhocFilters(this.name),l=[];for(const a of s){if(a.hide)continue;let s;if(G(a,"logs")){var d,u,m;a.bucketAggs=[B()];const e=null===(d=a.metrics)||void 0===d?void 0:d.find((e=>"logs"===e.type)),t=null!==(u=e.settings)&&void 0!==u&&u.limit?parseInt(null===(m=e.settings)||void 0===m?void 0:m.limit,10):500;l.push(t),a.metrics=[],s=this.queryBuilder.getLogsQuery(a,t,i)}else l.push(),a.alias&&(a.alias=this.interpolateLuceneQuery(a.alias,e.scopedVars)),s=this.queryBuilder.build(a,i);const r=JSON.stringify(s),o=0===s.size&&(0,v.lt)(this.esVersion,"5.0.0")?"count":"query_then_fetch";t+=this.getQueryHeader(o,e.range.from,e.range.to)+"\n",t+=r+"\n",n.push(a)}if(0===n.length)return(0,o.of)({data:[]});t=t.replace(/"\$timeFrom"/g,e.range.from.valueOf().toString()),t=t.replace(/"\$timeTo"/g,e.range.to.valueOf().toString()),t=this.templateSrv.replace(t,e.scopedVars);const p=this.getMultiSearchUrl();return this.post(p,t).pipe((0,c.U)((e=>{const t=new K(n,e);if(r){const e=t.getLogs(this.logMessageField,this.logLevelField);return e.data.forEach(((e,t)=>{!function(e,t,s){const n=(0,g.getDataSourceSrv)();s&&(e.meta=Object.assign({},e.meta,{limit:s}));if(!t.length)return;for(const s of e.fields){const e=t.find((e=>s.name&&s.name.match(e.field)));if(!e)continue;let r;if(e.datasourceUid){var a;const t=n.getInstanceSettings(e.datasourceUid);r={title:e.urlDisplayLabel||"",url:"",internal:{query:{query:e.url},datasourceUid:e.datasourceUid,datasourceName:null!==(a=null==t?void 0:t.name)&&void 0!==a?a:"Data source not found"}}}else r={title:e.urlDisplayLabel||"",url:e.url};s.config=s.config||{},s.config.links=[...s.config.links||[],r]}}(e,this.dataLinks,l[t])})),e}return t.getTimeSeries()})))}isMetadataField(e){return be.includes(e)}getFields(e,t){const s={float:"number",double:"number",integer:"number",long:"number",date:"date",date_nanos:"date",string:"string",text:"string",scaled_float:"number",nested:"nested",histogram:"number"};return this.get("/_mapping",t).pipe((0,c.U)((t=>{const n=(t,n)=>!this.isMetadataField(n)&&(!e||0===e.length||(e.includes(t.type)||e.includes(s[t.type]))),r=[],i={};function l(e){for(const t in e){const s=e[t];if((0,a.isObject)(s.properties)&&(r.push(t),l(s.properties)),(0,a.isObject)(s.fields)&&(r.push(t),l(s.fields)),(0,a.isString)(s.type)){const e=r.concat(t).join(".");n(s,t)&&(i[e]={text:e,type:s.type})}}r.pop()}for(const e in t){const s=t[e];if(s&&s.mappings){const e=s.mappings;if((0,v.lt)(this.esVersion,"7.0.0"))for(const t in e){l(e[t].properties)}else{l(e.properties)}}}return(0,a.map)(i,(e=>e))})))}getTerms(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,n.getDefaultTimeRange)();const s=(0,v.gte)(this.esVersion,"5.0.0")?"query_then_fetch":"count",r=this.getQueryHeader(s,t.from,t.to);let i=JSON.stringify(this.queryBuilder.getTermsQuery(e));i=i.replace(/\$timeFrom/g,t.from.valueOf().toString()),i=i.replace(/\$timeTo/g,t.to.valueOf().toString()),i=r+"\n"+i+"\n";const l=this.getMultiSearchUrl();return this.post(l,i).pipe((0,c.U)((e=>{if(!e.responses[0].aggregations)return[];const t=e.responses[0].aggregations[1].buckets;return(0,a.map)(t,(e=>({text:e.key_as_string||e.key,value:e.key})))})))}getMultiSearchUrl(){const e=new URLSearchParams;return(0,v.gte)(this.esVersion,"7.0.0")&&this.maxConcurrentShardRequests&&e.append("max_concurrent_shard_requests",`${this.maxConcurrentShardRequests}`),(0,v.gte)(this.esVersion,"6.6.0")&&this.xpack&&this.includeFrozen&&e.append("ignore_throttled","false"),("_msearch?"+e.toString()).replace(/\?$/,"")}metricFindQuery(e,t){const s=null==t?void 0:t.range,n=JSON.parse(e);if(e){if("fields"===n.find)return n.type=this.interpolateLuceneQuery(n.type),(0,r.n)(this.getFields(n.type,s));if("terms"===n.find)return n.field=this.interpolateLuceneQuery(n.field),n.query=this.interpolateLuceneQuery(n.query),(0,r.n)(this.getTerms(n,s))}return Promise.resolve([])}getTagKeys(){return(0,r.n)(this.getFields())}getTagValues(e){return(0,r.n)(this.getTerms({field:e.key}))}targetContainsTemplate(e){if(this.templateSrv.variableExists(e.query)||this.templateSrv.variableExists(e.alias))return!0;for(const t of e.bucketAggs)if(this.templateSrv.variableExists(t.field)||this.objectContainsTemplate(t.settings))return!0;for(const t of e.metrics)if(this.templateSrv.variableExists(t.field)||this.objectContainsTemplate(t.settings)||this.objectContainsTemplate(t.meta))return!0;return!1}isPrimitive(e){return null==e||!!["string","number","boolean"].some((e=>"boolean"===e))}objectContainsTemplate(e){if(!e)return!1;for(const t of Object.keys(e))if(this.isPrimitive(e[t])){if(this.templateSrv.variableExists(e[t]))return!0}else if(Array.isArray(e[t])){for(const s of e[t])if(this.objectContainsTemplate(s))return!0}else if(this.objectContainsTemplate(e[t]))return!0;return!1}}var _e=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),xe=s("./packages/grafana-ui/src/index.ts");const je=e=>{var t;const s=Z(e.jsonData.esVersion);return Object.assign({},e,{jsonData:Object.assign({},e.jsonData,{timeField:e.jsonData.timeField||"@timestamp",esVersion:s,maxConcurrentShardRequests:e.jsonData.maxConcurrentShardRequests||Me(s),logMessageField:e.jsonData.logMessageField||"",logLevelField:e.jsonData.logLevelField||"",includeFrozen:null!==(t=e.jsonData.includeFrozen)&&void 0!==t&&t})})},we=e=>Boolean(e);var Ee,Ie,Se=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const{Switch:Ne,Select:Oe,Input:Te,FormField:$e}=xe.LegacyForms,ke=[{label:"No pattern",value:"none"},{label:"Hourly",value:"Hourly",example:"[logstash-]YYYY.MM.DD.HH"},{label:"Daily",value:"Daily",example:"[logstash-]YYYY.MM.DD"},{label:"Weekly",value:"Weekly",example:"[logstash-]GGGG.WW"},{label:"Monthly",value:"Monthly",example:"[logstash-]YYYY.MM"},{label:"Yearly",value:"Yearly",example:"[logstash-]YYYY"}],Re=[{label:"2.x",value:"2.0.0"},{label:"5.x",value:"5.0.0"},{label:"5.6+",value:"5.6.0"},{label:"6.0+",value:"6.0.0"},{label:"7.0+",value:"7.0.0"},{label:"7.7+",value:"7.7.0"},{label:"7.10+",value:"7.10.0"},{label:"8.0+",value:"8.0.0",description:"support for Elasticsearch 8 is currently experimental"}],Ae=e=>{var t;let{value:s,onChange:n}=e;const a=Re.find((e=>e.value===s.jsonData.esVersion)),r=!a&&(0,v.valid)(s.jsonData.esVersion)?{label:s.jsonData.esVersion,value:s.jsonData.esVersion}:void 0;return(0,Se.jsxs)(Se.Fragment,{children:[Ee||(Ee=(0,Se.jsx)("h3",{className:"page-heading",children:"Elasticsearch details"})),(0,Se.jsxs)("div",{className:"gf-form-group",children:[(0,Se.jsxs)("div",{className:"gf-form-inline",children:[(0,Se.jsx)("div",{className:"gf-form",children:(0,Se.jsx)($e,{labelWidth:10,inputWidth:15,label:"Index name",value:s.database||"",onChange:Fe("database",s,n),placeholder:"es-index-name",required:!0})}),(0,Se.jsx)("div",{className:"gf-form",children:(0,Se.jsx)($e,{labelWidth:10,label:"Pattern",inputEl:(0,Se.jsx)(Oe,{menuShouldPortal:!0,options:ke,onChange:Le(s,n),value:ke.find((e=>e.value===(void 0===s.jsonData.interval?"none":s.jsonData.interval)))})})})]}),(0,Se.jsx)("div",{className:"gf-form max-width-25",children:(0,Se.jsx)($e,{labelWidth:10,inputWidth:15,label:"Time field name",value:s.jsonData.timeField||"",onChange:ze("timeField",s,n),required:!0})}),(0,Se.jsx)("div",{className:"gf-form",children:(0,Se.jsx)($e,{labelWidth:10,label:"Version",inputEl:(0,Se.jsx)(Oe,{menuShouldPortal:!0,options:[r,...Re].filter(we),onChange:e=>{const t=function(e,t){if(5===e&&(0,v.lt)(t,"7.0.0"))return 256;if(256===e&&(0,v.gte)(t,"7.0.0"))return 5;return e||Me(t)}(s.jsonData.maxConcurrentShardRequests,e.value);n(Object.assign({},s,{jsonData:Object.assign({},s.jsonData,{esVersion:e.value,maxConcurrentShardRequests:t})}))},value:a||r})})}),(0,v.gte)(s.jsonData.esVersion,"5.6.0")&&(0,Se.jsx)("div",{className:"gf-form max-width-30",children:(0,Se.jsx)($e,{"aria-label":"Max concurrent Shard Requests input",labelWidth:15,label:"Max concurrent Shard Requests",value:s.jsonData.maxConcurrentShardRequests||"",onChange:ze("maxConcurrentShardRequests",s,n)})}),(0,Se.jsx)("div",{className:"gf-form-inline",children:(0,Se.jsx)("div",{className:"gf-form",children:(0,Se.jsx)($e,{labelWidth:10,label:"Min time interval",inputEl:(0,Se.jsx)(Te,{className:"width-6",value:s.jsonData.timeInterval||"",onChange:ze("timeInterval",s,n),placeholder:"10s",validationEvents:{[xe.EventsWithValidation.onBlur]:[(0,xe.regexValidation)(/^\d+(ms|[Mwdhmsy])$/,"Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s")]}}),tooltip:(0,Se.jsxs)(Se.Fragment,{children:["A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example ",Ie||(Ie=(0,Se.jsx)("code",{children:"1m"}))," if your data is written every minute."]})})})}),(0,Se.jsx)("div",{className:"gf-form-inline",children:(0,Se.jsx)(Ne,{label:"X-Pack enabled",labelClass:"width-10",checked:s.jsonData.xpack||!1,onChange:Ce("xpack",s,n)})}),(0,v.gte)(s.jsonData.esVersion,"6.6.0")&&s.jsonData.xpack&&(0,Se.jsx)("div",{className:"gf-form-inline",children:(0,Se.jsx)(Ne,{label:"Include frozen indices",labelClass:"width-10",checked:null!==(t=s.jsonData.includeFrozen)&&void 0!==t&&t,onChange:Ce("includeFrozen",s,n)})})]})]})},Fe=(e,t,s)=>n=>{s(Object.assign({},t,{[e]:n.currentTarget.value}))},ze=(e,t,s)=>n=>{s(Object.assign({},t,{jsonData:Object.assign({},t.jsonData,{[e]:n.currentTarget.value})}))},Ce=(e,t,s)=>n=>{s(Object.assign({},t,{jsonData:Object.assign({},t.jsonData,{[e]:n.currentTarget.checked})}))},Le=(e,t)=>s=>{const{database:n}=e,a="none"===s.value?void 0:s.value;if(!n||0===n.length||n.startsWith("[logstash-]")){let s="";if(void 0!==a){const e=ke.find((e=>e.value===a));var r;if(e)s=null!==(r=e.example)&&void 0!==r?r:""}t(Object.assign({},e,{database:s,jsonData:Object.assign({},e.jsonData,{interval:a})}))}else t(Object.assign({},e,{jsonData:Object.assign({},e.jsonData,{interval:a})}))};function Me(e){return(0,v.gte)(e,"7.0.0")?5:256}var Pe;const{FormField:qe}=xe.LegacyForms,De=e=>{const{value:t,onChange:s}=e,n=e=>n=>{s(Object.assign({},t,{[e]:n.currentTarget.value}))};return(0,Se.jsxs)(Se.Fragment,{children:[Pe||(Pe=(0,Se.jsx)("h3",{className:"page-heading",children:"Logs"})),(0,Se.jsxs)("div",{className:"gf-form-group",children:[(0,Se.jsx)("div",{className:"gf-form max-width-30",children:(0,Se.jsx)(qe,{labelWidth:11,label:"Message field name",value:t.logMessageField,onChange:n("logMessageField"),placeholder:"_source"})}),(0,Se.jsx)("div",{className:"gf-form max-width-30",children:(0,Se.jsx)(qe,{labelWidth:11,label:"Level field name",value:t.logLevelField,onChange:n("logLevelField")})})]})]})};var Ve=s("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),Be=s("./.yarn/__virtual__/react-use-virtual-ca2705900f/0/cache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/usePrevious.js");const{FormField:Ue,Switch:Ge}=xe.LegacyForms,He=(0,xe.stylesFactory)((()=>({firstRow:Ve.css`
    display: flex;
  `,nameField:Ve.css`
    flex: 2;
  `,regexField:Ve.css`
    flex: 3;
  `,row:Ve.css`
    display: flex;
    align-items: baseline;
  `,urlField:Ve.css`
    flex: 1;
  `,urlDisplayLabelField:Ve.css`
    flex: 1;
  `}))),We=e=>{const{value:t,onChange:s,onDelete:n,suggestions:a,className:r}=e,i=He(),[l,o]=function(e){const[t,s]=(0,_e.useState)(!!e),n=(0,Be.Z)(e);return(0,_e.useEffect)((()=>{n||!e||t||s(!0),n&&!e&&t&&s(!1)}),[n,e,t]),[t,s]}(t.datasourceUid),c=e=>n=>{s(Object.assign({},t,{[e]:n.currentTarget.value}))};return(0,Se.jsxs)("div",{className:r,children:[(0,Se.jsxs)("div",{className:i.firstRow+" gf-form",children:[(0,Se.jsx)(Ue,{className:i.nameField,labelWidth:6,inputWidth:null,label:"Field",type:"text",value:t.field,tooltip:"Can be exact field name or a regex pattern that will match on the field name.",onChange:c("field")}),(0,Se.jsx)(xe.Button,{variant:"destructive",title:"Remove field",icon:"times",onClick:e=>{e.preventDefault(),n()}})]}),(0,Se.jsxs)("div",{className:"gf-form",children:[(0,Se.jsx)(Ue,{label:l?"Query":"URL",labelWidth:6,inputEl:(0,Se.jsx)(xe.DataLinkInput,{placeholder:l?"${__value.raw}":"http://example.com/${__value.raw}",value:t.url||"",onChange:e=>s(Object.assign({},t,{url:e})),suggestions:a}),className:i.urlField}),(0,Se.jsx)(Ue,{className:i.urlDisplayLabelField,inputWidth:null,label:"URL Label",type:"text",value:t.urlDisplayLabel,onChange:c("urlDisplayLabel"),tooltip:"Use to override the button label."})]}),(0,Se.jsxs)("div",{className:i.row,children:[(0,Se.jsx)(Ge,{labelClass:"width-6",label:"Internal link",checked:l,onChange:()=>{l&&s(Object.assign({},t,{datasourceUid:void 0})),o(!l)}}),l&&(0,Se.jsx)(g.DataSourcePicker,{tracing:!0,onChange:e=>{s(Object.assign({},t,{datasourceUid:e.uid}))},current:t.datasourceUid})]})]})};var Qe;const Xe=e=>({infoText:Ve.css`
      padding-bottom: ${e.spacing(2)};
      color: ${e.colors.text.secondary};
    `,dataLink:Ve.css`
      margin-bottom: ${e.spacing(1)};
    `}),Ye=e=>{const{value:t,onChange:s}=e,a=(0,xe.useStyles2)(Xe);return(0,Se.jsxs)(Se.Fragment,{children:[Qe||(Qe=(0,Se.jsx)("h3",{className:"page-heading",children:"Data links"})),(0,Se.jsx)("div",{className:a.infoText,children:"Add links to existing fields. Links will be shown in log row details next to the field value."}),t&&t.length>0&&(0,Se.jsx)("div",{className:"gf-form-group",children:t.map(((e,r)=>(0,Se.jsx)(We,{className:a.dataLink,value:e,onChange:e=>{const n=[...t];n.splice(r,1,e),s(n)},onDelete:()=>{const e=[...t];e.splice(r,1),s(e)},suggestions:[{value:n.DataLinkBuiltInVars.valueRaw,label:"Raw value",documentation:"Raw value of the field",origin:n.VariableOrigin.Value}]},r)))}),(0,Se.jsx)(xe.Button,{variant:"secondary",className:Ve.css`
          margin-right: 10px;
        `,icon:"plus",onClick:e=>{e.preventDefault();const n=[...t||[],{field:"",url:""}];s(n)},children:"Add"})]})};var Ze,Je=s("./public/app/core/config.ts");const Ke=(e,t,s)=>(0,_e.useCallback)((n=>{e(s(t,n))}),[e,t,s]),et=(0,_e.createContext)(void 0),tt=()=>{const e=(0,_e.useContext)(et);if(!e)throw new Error("Use DispatchContext first.");return e};var st=s("./.yarn/__virtual__/@reduxjs-toolkit-virtual-5e60bdbc91/0/cache/@reduxjs-toolkit-npm-1.6.1-a0999c8262-487e340036.zip/node_modules/@reduxjs/toolkit/dist/redux-toolkit.esm.js");const nt=(0,st.PH)("init"),at=(0,st.PH)("change_query"),rt=(0,st.PH)("change_alias_pattern"),it=(e,t)=>at.match(t)?t.payload:nt.match(t)?e||"":e,lt=(e,t)=>rt.match(t)?t.payload:nt.match(t)?e||"":e,ot=(0,st.PH)("@metrics/add"),ct=(0,st.PH)("@metrics/remove"),dt=(0,st.PH)("@metrics/toggle_visibility"),ut=(0,st.PH)("@metrics/change_field"),mt=(0,st.PH)("@metrics/change_type"),pt=(0,st.PH)("@metrics/change_attr"),ht=(0,st.PH)("@metrics/change_setting"),vt=(0,st.PH)("@metrics/change_meta"),gt=(e,t)=>{if(ot.match(t))return[...e,V(t.payload)];if(ct.match(t)){const s=e.find((e=>e.id===t.payload)),n=[s,...L(s,e)],a=e.filter((e=>!n.some((t=>t.id===e.id))));return 0===a.length?[V("1")]:a}return mt.match(t)?e.filter((e=>!z[t.payload.type].isSingleMetric||e.id===t.payload.id)).map((e=>e.id!==t.payload.id?e:Object.assign({id:e.id,type:t.payload.type},z[t.payload.type].defaults))):ut.match(t)?e.map((e=>{if(e.id!==t.payload.id)return e;const s=Object.assign({},e,{field:t.payload.field});return N(e)?Object.assign({},s,{pipelineAgg:t.payload.field}):s})):dt.match(t)?e.map((e=>e.id!==t.payload?e:Object.assign({},e,{hide:!e.hide}))):ht.match(t)?e.map((e=>{if(e.id!==t.payload.metric.id)return e;if($(e)){const s=Q(Object.assign({},e.settings,{[t.payload.settingName]:t.payload.newValue}));return Object.assign({},e,{settings:Object.assign({},s)})}return e})):vt.match(t)?e.map((e=>e.id!==t.payload.metric.id?e:(e=>z[e.type].hasMeta)(e)?Object.assign({},e,{meta:Object.assign({},e.meta,{[t.payload.meta]:t.payload.newValue})}):e)):pt.match(t)?e.map((e=>e.id!==t.payload.metric.id?e:Object.assign({},e,{[t.payload.attribute]:t.payload.newValue}))):nt.match(t)?null!=e&&e.length?e:[V("1")]:e},ft=(0,st.PH)("@bucketAggs/add"),bt=(0,st.PH)("@bucketAggs/remove"),yt=(0,st.PH)("@bucketAggs/change_type"),_t=(0,st.PH)("@bucketAggs/change_field"),xt=(0,st.PH)("@bucketAggs/change_setting"),jt=(0,_e.createContext)(void 0),wt=(0,_e.createContext)(void 0),Et=(0,_e.createContext)(void 0),It=e=>{let{children:t,onChange:s,onRunQuery:n,query:a,datasource:r,range:i}=e;const l=(0,_e.useCallback)((e=>{s(e),n()}),[s,n]),o=(c={query:it,alias:lt,metrics:gt,bucketAggs:(d=r.timeField,(e,t)=>{if(ft.match(t)){const s={id:t.payload,type:"terms",settings:de.terms.defaultSettings},n=e[e.length-1];return"date_histogram"===(null==n?void 0:n.type)?[...e.slice(0,e.length-1),s,n]:[...e,s]}return bt.match(t)?e.filter((e=>e.id!==t.payload)):yt.match(t)?e.map((e=>e.id!==t.payload.id?e:{id:e.id,type:t.payload.newType,settings:de[t.payload.newType].defaultSettings})):_t.match(t)?e.map((e=>e.id!==t.payload.id?e:Object.assign({},e,{field:t.payload.newField}))):mt.match(t)?z[t.payload.type].isSingleMetric?[]:0===e.length?[Object.assign({},B("2"),{field:d})]:e:xt.match(t)?e.map((e=>{if(e.id!==t.payload.bucketAgg.id)return e;const s=Q(Object.assign({},e.settings,{[t.payload.settingName]:t.payload.newValue}));return Object.assign({},e,{settings:Object.assign({},s)})})):nt.match(t)?null!=e&&e.length?e:[Object.assign({},B("2"),{field:d})]:e})},(e,t)=>{const s={};for(const n in c)s[n]=c[n](e[n],t);return s});var c,d;const u=Ke((e=>l(Object.assign({},a,e,{timeField:r.timeField}))),a,o);return a.metrics&&a.bucketAggs&&void 0!==a.query?(0,Se.jsx)(jt.Provider,{value:r,children:(0,Se.jsx)(wt.Provider,{value:a,children:(0,Se.jsx)(Et.Provider,{value:i,children:(0,Se.jsx)(et.Provider,{value:u,children:t})})})}):(u(nt()),null)},St=e=>()=>{const t=(0,_e.useContext)(e);if(!t)throw new Error("use ElasticsearchProvider first.");return t},Nt=St(wt),Ot=St(jt),Tt=St(Et),$t=["iconName","onClick","className","label"];const kt=Ve.css`
  clip: rect(0 0 0 0);
  clip-path: inset(50%);
  height: 1px;
  overflow: hidden;
  position: absolute;
  white-space: nowrap;
  width: 1px;
`,Rt=e=>{let{iconName:t,onClick:s,className:n,label:a}=e,r=function(e,t){if(null==e)return{};var s,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)s=r[n],t.indexOf(s)>=0||(a[s]=e[s]);return a}(e,$t);return(0,Se.jsxs)("button",Object.assign({className:(0,Ve.cx)("gf-form-label gf-form-label--btn query-part",n),onClick:s},r,{children:[(0,Se.jsx)("span",{className:kt,children:a}),(0,Se.jsx)(xe.Icon,{name:t,"aria-hidden":"true"})]}))},At=e=>{let{index:t,onAdd:s,onRemove:n,elements:a}=e;return(0,Se.jsxs)("div",{className:Ve.css`
        display: flex;
      `,children:[0===t&&(0,Se.jsx)(Rt,{iconName:"plus",onClick:s,label:"add"}),a.length>=2&&(0,Se.jsx)(Rt,{iconName:"minus",onClick:n,label:"remove"})]})},Ft=Ve.css`
  white-space: nowrap;
`,zt=e=>({label:W(e),value:e}),Ct=e=>{let{options:t,onChange:s,className:n,value:a}=e;const r=t.find((e=>e.id===a));return(0,Se.jsx)(xe.Segment,{className:(0,Ve.cx)(n,Ft),options:(i=t,i.map(zt)),onChange:s,placeholder:"Select Metric",value:r?zt(r):void 0});var i},Lt=(0,st.PH)("@pipelineVariables/add"),Mt=(0,st.PH)("@pipelineVariables/remove"),Pt=(0,st.PH)("@pipelineVariables/rename"),qt=(0,st.PH)("@pipelineVariables/change_metric"),Dt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return Lt.match(t)?[...e,A(F(e))]:Mt.match(t)?e.slice(0,t.payload).concat(e.slice(t.payload+1)):Pt.match(t)?e.map(((e,s)=>s!==t.payload.index?e:Object.assign({},e,{name:t.payload.newName}))):qt.match(t)?e.map(((e,s)=>s!==t.payload.index?e:Object.assign({},e,{pipelineAgg:t.payload.newMetric}))):e};function Vt(e){let{label:t,settingName:s,metric:n,placeholder:r,tooltip:i}=e;const l=tt(),[o]=(0,_e.useState)((0,a.uniqueId)("es-field-id-")),c=n.settings;let d=(null==c?void 0:c[s])||"";return"script"===s&&(d=Y(n)),(0,Se.jsx)(xe.InlineField,{label:t,labelWidth:16,tooltip:i,children:(0,Se.jsx)(xe.Input,{id:o,placeholder:r,onBlur:e=>l(ht({metric:n,settingName:s,newValue:e.target.value})),defaultValue:d})})}var Bt;const Ut=e=>{var t;let{value:s,previousMetrics:n}=e;const r=tt(),i=Ke((e=>r(pt({metric:s,attribute:"pipelineVariables",newValue:e}))),s.pipelineVariables,Dt);return(0,_e.useEffect)((()=>{var e;null!==(e=s.pipelineVariables)&&void 0!==e&&e.length||i(Lt())}),[i,null===(t=s.pipelineVariables)||void 0===t?void 0:t.length]),(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsxs)("div",{className:Ve.css`
          display: flex;
        `,children:[Bt||(Bt=(0,Se.jsx)(xe.InlineLabel,{width:16,children:"Variables"})),(0,Se.jsx)("div",{className:Ve.css`
            display: grid;
            grid-template-columns: 1fr auto;
            row-gap: 4px;
            margin-bottom: 4px;
          `,children:s.pipelineVariables.map(((e,t)=>(0,Se.jsxs)(_e.Fragment,{children:[(0,Se.jsxs)("div",{className:Ve.css`
                  display: grid;
                  column-gap: 4px;
                  grid-template-columns: auto auto;
                `,children:[(0,Se.jsx)(xe.Input,{defaultValue:e.name,placeholder:"Variable Name",onBlur:e=>i(Pt({newName:e.target.value,index:t}))}),(0,Se.jsx)(Ct,{onChange:e=>i(qt({newMetric:e.value.id,index:t})),options:n,value:e.pipelineAgg})]}),(0,Se.jsx)(At,{index:t,elements:s.pipelineVariables||[],onAdd:()=>i(Lt()),onRemove:()=>i(Mt(t))})]},(0,a.uniqueId)("es-bs-"))))})]}),(0,Se.jsx)(Vt,{label:"Script",metric:s,settingName:"script",tooltip:"Elasticsearch v5.0 and above: Scripting language is Painless. Use params.<var> to reference a variable. Elasticsearch pre-v5.0: Scripting language is per default Groovy if not changed. For Groovy use <var> to reference a variable.",placeholder:"params.var1 / params.var2"})]})},Gt=Ve.css`
  min-width: 150px;
`,Ht=e=>{let{label:t,children:s,hidden:n=!1}=e;const[a,r]=(0,_e.useState)(!1),i=((e,t)=>({wrapper:Ve.css`
      max-width: 500px;
      display: flex;
      flex-direction: column;
    `,settingsWrapper:Ve.css`
      padding-top: ${e.spacing(.5)};
    `,icon:Ve.css`
      margin-right: ${e.spacing(.5)};
    `,button:Ve.css`
      justify-content: start;
      ${t&&Ve.css`
        color: ${e.colors.text.disabled};
      `}
    `}))((0,xe.useTheme2)(),n);return(0,Se.jsx)(xe.InlineSegmentGroup,{children:(0,Se.jsxs)("div",{className:(0,Ve.cx)(i.wrapper),children:[(0,Se.jsxs)("button",{className:(0,Ve.cx)("gf-form-label query-part",i.button,Gt),onClick:()=>r(!a),"aria-expanded":a,children:[(0,Se.jsx)(xe.Icon,{name:a?"angle-down":"angle-right","aria-hidden":"true",className:i.icon}),t]}),a&&(0,Se.jsx)("div",{className:i.settingsWrapper,children:s})]})})},Wt=e=>{var t,s,n,a,r,i,l,o,c,d,u,m;let{metric:p}=e;const h=tt();return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(xe.InlineField,{label:"Model",labelWidth:16,children:(0,Se.jsx)(xe.Select,{menuShouldPortal:!0,onChange:e=>h(ht({metric:p,settingName:"model",newValue:e.value})),options:P,value:null===(t=p.settings)||void 0===t?void 0:t.model})}),(0,Se.jsx)(Vt,{label:"Window",settingName:"window",metric:p,placeholder:"5"}),(0,Se.jsx)(Vt,{label:"Predict",settingName:"predict",metric:p}),(j(p)||w(p)||E(p))&&(0,Se.jsx)(xe.InlineField,{label:"Alpha",labelWidth:16,children:(0,Se.jsx)(xe.Input,{onBlur:e=>{var t;return h(ht({metric:p,settingName:"settings",newValue:Object.assign({},null===(t=p.settings)||void 0===t?void 0:t.settings,{alpha:e.target.value})}))},defaultValue:null===(s=p.settings)||void 0===s||null===(n=s.settings)||void 0===n?void 0:n.alpha})}),(w(p)||E(p))&&(0,Se.jsx)(xe.InlineField,{label:"Beta",labelWidth:16,children:(0,Se.jsx)(xe.Input,{onBlur:e=>{var t;return h(ht({metric:p,settingName:"settings",newValue:Object.assign({},null===(t=p.settings)||void 0===t?void 0:t.settings,{beta:e.target.value})}))},defaultValue:null===(a=p.settings)||void 0===a||null===(r=a.settings)||void 0===r?void 0:r.beta})}),E(p)&&(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(xe.InlineField,{label:"Gamma",labelWidth:16,children:(0,Se.jsx)(xe.Input,{onBlur:e=>{var t;return h(ht({metric:p,settingName:"settings",newValue:Object.assign({},null===(t=p.settings)||void 0===t?void 0:t.settings,{gamma:e.target.value})}))},defaultValue:null===(i=p.settings)||void 0===i||null===(l=i.settings)||void 0===l?void 0:l.gamma})}),(0,Se.jsx)(xe.InlineField,{label:"Period",labelWidth:16,children:(0,Se.jsx)(xe.Input,{onBlur:e=>{var t;return h(ht({metric:p,settingName:"settings",newValue:Object.assign({},null===(t=p.settings)||void 0===t?void 0:t.settings,{period:e.target.value})}))},defaultValue:null===(o=p.settings)||void 0===o||null===(c=o.settings)||void 0===c?void 0:c.period})}),(0,Se.jsx)(xe.InlineField,{label:"Pad",labelWidth:16,children:(0,Se.jsx)(xe.InlineSwitch,{onChange:e=>{var t;return h(ht({metric:p,settingName:"settings",newValue:Object.assign({},null===(t=p.settings)||void 0===t?void 0:t.settings,{pad:e.target.checked})}))},checked:!(null===(d=p.settings)||void 0===d||null===(u=d.settings)||void 0===u||!u.pad)})})]}),(j(p)||w(p)||E(p))&&(0,Se.jsx)(xe.InlineField,{label:"Minimize",labelWidth:16,children:(0,Se.jsx)(xe.InlineSwitch,{onChange:e=>h(ht({metric:p,settingName:"minimize",newValue:e.target.checked})),checked:!(null===(m=p.settings)||void 0===m||!m.minimize)})})]})},Qt=e=>{if(t=e,R.includes(t))return"cardinality"===e?[]:["number"];var t;if((e=>ve.includes(e))(e))switch(e){case"date_histogram":return["date"];case"geohash_grid":return["geo_point"];case"histogram":return["number"];default:return[]}return[]},Xt=e=>{let{text:t}=e;return{label:t,value:t}},Yt=e=>{const t=Ot(),s=Tt(),n=Array.isArray(e)?e:Qt(e);let a;return async e=>(a||(a=await(0,r.n)(t.getFields(n,s))),a.filter((t=>{let{text:s}=t;return void 0===e||s.includes(e)})).map(Xt))},Zt=e=>({value:e,label:e}),Jt=e=>{var t,s,n,a;let{metric:r}=e;const i=tt(),l=Yt(["number","date"]),o=Yt(r.type);return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(xe.InlineField,{label:"Metrics",labelWidth:16,children:(0,Se.jsx)(xe.AsyncMultiSelect,{menuShouldPortal:!0,onChange:e=>i(ht({metric:r,settingName:"metrics",newValue:e.map((e=>e.value))})),loadOptions:o,value:null===(t=r.settings)||void 0===t||null===(s=t.metrics)||void 0===s?void 0:s.map(Zt),closeMenuOnSelect:!1,defaultOptions:!0})}),(0,Se.jsx)(xe.InlineField,{label:"Order",labelWidth:16,children:(0,Se.jsx)(xe.Select,{menuShouldPortal:!0,onChange:e=>i(ht({metric:r,settingName:"order",newValue:e.value})),options:me,value:null===(n=r.settings)||void 0===n?void 0:n.order})}),(0,Se.jsx)(xe.InlineField,{label:"Order By",labelWidth:16,className:Ve.css`
          & > div {
            width: 100%;
          }
        `,children:(0,Se.jsx)(xe.SegmentAsync,{className:Ve.css`
            margin-right: 0;
          `,loadOptions:l,onChange:e=>i(ht({metric:r,settingName:"orderBy",newValue:e.value})),placeholder:"Select Field",value:null===(a=r.settings)||void 0===a?void 0:a.orderBy})})]})},Kt={labelWidth:16},es=e=>{var t,s,n,a,r,i,l;let{metric:o,previousMetrics:c}=e;const d=tt(),u=(e=>{var t,s,n;switch(e.type){case"cardinality":var a;return`Precision threshold: ${(null===(a=e.settings)||void 0===a?void 0:a.precision_threshold)||""}`;case"percentiles":var r;return null!==(t=e.settings)&&void 0!==t&&t.percents&&(null===(s=e.settings)||void 0===s||null===(n=s.percents)||void 0===n?void 0:n.length)>=1?`Values: ${null===(r=e.settings)||void 0===r?void 0:r.percents}`:"Percents: Default";case"extended_stats":{const t=Object.entries(e.meta||{}).map((e=>{var t;let[s,n]=e;return n&&(null===(t=M.find((e=>t=>t.value===e)(s)))||void 0===t?void 0:t.label)})).filter(Boolean);return`Stats: ${t.length>0?t.join(", "):"None selected"}`}case"raw_document":case"raw_data":var i;return`Size: ${(null===(i=e.settings)||void 0===i?void 0:i.size)||500}`;default:return"Options"}})(o),m=Nt();return(0,Se.jsxs)(Ht,{label:u,hidden:o.hide,children:["derivative"===o.type&&(0,Se.jsx)(Vt,{label:"Unit",metric:o,settingName:"unit"}),"serial_diff"===o.type&&(0,Se.jsx)(Vt,{label:"Lag",metric:o,settingName:"lag",placeholder:"1"}),"cumulative_sum"===o.type&&(0,Se.jsx)(Vt,{label:"Format",metric:o,settingName:"format"}),"moving_avg"===o.type&&(0,Se.jsx)(Wt,{metric:o}),"moving_fn"===o.type&&(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(Vt,{label:"Window",metric:o,settingName:"window"}),(0,Se.jsx)(Vt,{label:"Script",metric:o,settingName:"script"}),(0,Se.jsx)(Vt,{label:"Shift",metric:o,settingName:"shift"})]}),"top_metrics"===o.type&&(0,Se.jsx)(Jt,{metric:o}),"bucket_script"===o.type&&(0,Se.jsx)(Ut,{value:o,previousMetrics:c}),("raw_data"===o.type||"raw_document"===o.type)&&(0,Se.jsx)(xe.InlineField,Object.assign({label:"Size"},Kt,{children:(0,Se.jsx)(xe.Input,{id:`ES-query-${m.refId}_metric-${o.id}-size`,onBlur:e=>d(ht({metric:o,settingName:"size",newValue:e.target.value})),defaultValue:null!==(t=null===(s=o.settings)||void 0===s?void 0:s.size)&&void 0!==t?t:null===(n=z.raw_data.defaults.settings)||void 0===n?void 0:n.size})})),"logs"===o.type&&(0,Se.jsx)(Vt,{label:"Limit",metric:o,settingName:"limit",placeholder:"500"}),"cardinality"===o.type&&(0,Se.jsx)(Vt,{label:"Precision Threshold",metric:o,settingName:"precision_threshold"}),"extended_stats"===o.type&&(0,Se.jsxs)(Se.Fragment,{children:[M.map((e=>{var t,s,n;return(0,Se.jsx)(ts,{stat:e,onChange:t=>d(vt({metric:o,meta:e.value,newValue:t})),value:void 0!==(null===(t=o.meta)||void 0===t?void 0:t[e.value])?!(null===(s=o.meta)||void 0===s||!s[e.value]):!(null===(n=z.extended_stats.defaults.meta)||void 0===n||!n[e.value])},e.value)})),(0,Se.jsx)(Vt,{label:"Sigma",metric:o,settingName:"sigma",placeholder:"3"})]}),"percentiles"===o.type&&(0,Se.jsx)(xe.InlineField,Object.assign({label:"Percentiles"},Kt,{children:(0,Se.jsx)(xe.Input,{onBlur:e=>d(ht({metric:o,settingName:"percents",newValue:e.target.value.split(",").filter(Boolean)})),defaultValue:(null===(a=o.settings)||void 0===a?void 0:a.percents)||(null===(r=z.percentiles.defaults.settings)||void 0===r?void 0:r.percents),placeholder:"1,5,25,50,75,95,99"})})),"rate"===o.type&&(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(xe.InlineField,Object.assign({label:"Unit"},Kt,{"data-testid":"unit-select",children:(0,Se.jsx)(xe.Select,{menuShouldPortal:!0,id:`ES-query-${m.refId}_metric-${o.id}-unit`,onChange:e=>d(ht({metric:o,settingName:"unit",newValue:e.value})),options:[{value:"second",label:"Second"},{value:"minute",label:"Minute"},{value:"hour",label:"Hour"},{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"},{value:"quarter",label:"Quarter"},{value:"Year",label:"Year"}],value:null===(i=o.settings)||void 0===i?void 0:i.unit})})),(0,Se.jsx)(xe.InlineField,Object.assign({label:"Mode"},Kt,{"data-testid":"mode-select",children:(0,Se.jsx)(xe.Select,{menuShouldPortal:!0,id:`ES-query-${m.refId}_metric-${o.id}-mode`,onChange:e=>d(ht({metric:o,settingName:"mode",newValue:e.value})),options:[{value:"sum",label:"Sum"},{value:"value_count",label:"Value count"}],value:null===(l=o.settings)||void 0===l?void 0:l.unit})}))]}),k(o)&&(0,Se.jsx)(Vt,{label:"Script",metric:o,settingName:"script",placeholder:"_value * 1"}),T(o)&&(0,Se.jsx)(Vt,{label:"Missing",metric:o,settingName:"missing",tooltip:"The missing parameter defines how documents that are missing a value should be treated. By default they will be ignored but it is also possible to treat them as if they had a value"})]})},ts=e=>{let{stat:t,onChange:s,value:n}=e;const[r]=(0,_e.useState)((0,a.uniqueId)("es-field-id-"));return(0,_e.createElement)(xe.InlineField,Object.assign({label:t.label},Kt,{key:t.value}),(0,Se.jsx)(xe.InlineSwitch,{id:r,onChange:e=>s(e.target.checked),value:n}))},ss=e=>!z[e.type].isPipelineAgg,ns=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=e.some(ss);return Object.entries(z).filter((e=>{let[s,{versionRange:n="*"}]=e;return(0,v.satisfies)(t,n)})).filter((e=>{let[t,s]=e;return n||!s.isPipelineAgg})).filter((e=>{let[t,n]=e;return!n.xpack||s})).map((e=>{let[t,{label:s}]=e;return{label:s,value:t}}))},as=e=>{let{value:t}=e;const s=(n=(0,xe.useTheme2)(),{color:(a=!!t.hide)&&Ve.css`
        &,
        &:hover,
        label,
        a {
          color: ${a?n.colors.text.disabled:n.colors.text.primary};
        }
      `});var n,a;const r=Ot(),i=Nt(),l=tt(),o=Yt(t.type),c=(0,_e.useCallback)((async()=>{const e=await o();return k(t)?[{label:"None"},...e]:e}),[o,t]),d=i.metrics.slice(0,i.metrics.findIndex((e=>e.id===t.id)));return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsxs)(xe.InlineSegmentGroup,{children:[(0,Se.jsx)(xe.Segment,{className:(0,Ve.cx)(s.color,Gt),options:ns(d,r.esVersion,r.xpack),onChange:e=>l(mt({id:t.id,type:e.value})),value:(u=t,{label:z[u.type].label,value:u.type})}),S(t)&&!N(t)&&(0,Se.jsx)(xe.SegmentAsync,{className:(0,Ve.cx)(s.color,Gt),loadOptions:c,onChange:e=>l(ut({id:t.id,field:e.value})),placeholder:"Select Field",value:t.field}),N(t)&&!O(t)&&(0,Se.jsx)(Ct,{className:(0,Ve.cx)(s.color,Gt),onChange:e=>{var s;return l(ut({id:t.id,field:null===(s=e.value)||void 0===s?void 0:s.id}))},options:d,value:t.field})]}),$(t)&&(0,Se.jsx)(es,{metric:t,previousMetrics:d})]});var u},rs=e=>{let{children:t,label:s,onRemoveClick:n,onHideClick:r,hidden:i=!1}=e;const l=(0,xe.useStyles2)(is);return(0,Se.jsxs)(xe.InlineFieldRow,{children:[(0,Se.jsx)(xe.InlineSegmentGroup,{children:(0,Se.jsxs)(xe.InlineLabel,{width:17,as:"div",children:[(0,Se.jsx)("span",{children:s}),(0,Se.jsxs)("span",{className:l.iconWrapper,children:[r&&(0,Se.jsx)(xe.IconButton,{name:i?"eye-slash":"eye",onClick:r,surface:"header",size:"sm","aria-pressed":i,"aria-label":"hide metric",className:l.icon}),(0,Se.jsx)(xe.IconButton,{name:"trash-alt",surface:"header",size:"sm",className:l.icon,onClick:n||a.noop,disabled:!n,"aria-label":"remove metric"})]})]})}),t]})},is=e=>({iconWrapper:Ve.css`
      display: flex;
    `,icon:Ve.css`
      color: ${e.colors.text.secondary};
      margin-left: ${e.spacing(.25)};
    `}),ls=e=>{let{nextId:t}=e;const s=tt(),{metrics:n}=Nt(),a=(null==n?void 0:n.length)||0;return(0,Se.jsx)(Se.Fragment,{children:null==n?void 0:n.map(((e,n)=>(0,Se.jsxs)(rs,{label:`Metric (${e.id})`,hidden:e.hide,onHideClick:()=>s(dt(e.id)),onRemoveClick:a>1&&(()=>s(ct(e.id))),children:[(0,Se.jsx)(as,{value:e}),!z[e.type].isSingleMetric&&0===n&&(0,Se.jsx)(Rt,{iconName:"plus",onClick:()=>s(ot(t)),label:"add"})]},`${e.type}-${e.id}`)))})},os=(0,st.PH)("@bucketAggregations/filter/add"),cs=(0,st.PH)("@bucketAggregations/filter/remove"),ds=(0,st.PH)("@bucketAggregations/filter/change"),us=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return os.match(t)?[...e,{label:"",query:"*"}]:cs.match(t)?e.slice(0,t.payload).concat(e.slice(t.payload+1)):ds.match(t)?e.map(((e,s)=>s!==t.payload.index?e:t.payload.filter)):e},ms=e=>{var t,s,n,a;let{bucketAgg:r}=e;const i=tt(),l=Ke((e=>i(xt({bucketAgg:r,settingName:"filters",newValue:e}))),null===(t=r.settings)||void 0===t?void 0:t.filters,us);return(0,_e.useEffect)((()=>{var e,t;null!==(e=r.settings)&&void 0!==e&&null!==(t=e.filters)&&void 0!==t&&t.length||l(os())}),[l,null===(s=r.settings)||void 0===s||null===(n=s.filters)||void 0===n?void 0:n.length]),(0,Se.jsx)(Se.Fragment,{children:(0,Se.jsx)("div",{className:Ve.css`
          display: flex;
          flex-direction: column;
        `,children:null===(a=r.settings)||void 0===a?void 0:a.filters.map(((e,t)=>{var s;return(0,Se.jsxs)("div",{className:Ve.css`
              display: flex;
            `,children:[(0,Se.jsx)("div",{className:Ve.css`
                width: 250px;
              `,children:(0,Se.jsx)(xe.InlineField,{label:"Query",labelWidth:10,children:(0,Se.jsx)(xe.QueryField,{placeholder:"Lucene Query",portalOrigin:"elasticsearch",onBlur:()=>{},onChange:s=>l(ds({index:t,filter:Object.assign({},e,{query:s})})),query:e.query})})}),(0,Se.jsx)(xe.InlineField,{label:"Label",labelWidth:10,children:(0,Se.jsx)(xe.Input,{placeholder:"Label",onBlur:s=>l(ds({index:t,filter:Object.assign({},e,{label:s.target.value})})),defaultValue:e.label})}),(0,Se.jsx)(At,{index:t,elements:(null===(s=r.settings)||void 0===s?void 0:s.filters)||[],onAdd:()=>l(os()),onRemove:()=>l(cs(t))})]},t)}))})})},ps=e=>t=>t.value===e,hs=e=>{let{options:t,value:s,onChange:n}=e;const[a,r]=(0,_e.useState)(((e,t)=>{return void 0===t||e.some((s=t,e=>{let{value:t}=e;return t===s}))?e:[...e,{value:t,label:t}];var s})(t,s));return{onCreateOption:e=>{var t;t=e,r([...a,{value:t,label:t}]),n({value:e})},onChange:n,allowCustomValue:!0,options:a,value:s}},vs=[{label:"auto",value:"auto"},{label:"10s",value:"10s"},{label:"1m",value:"1m"},{label:"5m",value:"5m"},{label:"10m",value:"10m"},{label:"20m",value:"20m"},{label:"1h",value:"1h"},{label:"1d",value:"1d"}],gs=(e,t,s)=>{var n;return!s.some((n=e,e=>{let{value:t}=e;return t===n}))&&e.trim().length>0},fs=(e,t)=>{var s;return(null===(s=e.value)||void 0===s?void 0:s.startsWith(t))||!1},bs=e=>{var t,s,r,i,l,o,c,d,u,m;let{bucketAgg:p}=e;const h=tt();return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(xe.InlineField,Object.assign({label:"Interval"},Es,{children:(0,Se.jsx)(xe.Select,Object.assign({menuShouldPortal:!0,inputId:(0,a.uniqueId)("es-date_histogram-interval"),isValidNewOption:gs,filterOption:fs},hs({options:vs,value:(null===(t=p.settings)||void 0===t?void 0:t.interval)||(null===(s=de.date_histogram.defaultSettings)||void 0===s?void 0:s.interval),onChange:e=>{let{value:t}=e;return h(xt({bucketAgg:p,settingName:"interval",newValue:t}))}})))})),(0,Se.jsx)(xe.InlineField,Object.assign({label:"Min Doc Count"},Es,{children:(0,Se.jsx)(xe.Input,{onBlur:e=>h(xt({bucketAgg:p,settingName:"min_doc_count",newValue:e.target.value})),defaultValue:(null===(r=p.settings)||void 0===r?void 0:r.min_doc_count)||(null===(i=de.date_histogram.defaultSettings)||void 0===i?void 0:i.min_doc_count)})})),(0,Se.jsx)(xe.InlineField,Object.assign({label:"Trim Edges"},Es,{tooltip:"Trim the edges on the timeseries datapoints",children:(0,Se.jsx)(xe.Input,{onBlur:e=>h(xt({bucketAgg:p,settingName:"trimEdges",newValue:e.target.value})),defaultValue:(null===(l=p.settings)||void 0===l?void 0:l.trimEdges)||(null===(o=de.date_histogram.defaultSettings)||void 0===o?void 0:o.trimEdges)})})),(0,Se.jsx)(xe.InlineField,Object.assign({label:"Offset"},Es,{tooltip:"Change the start value of each bucket by the specified positive (+) or negative offset (-) duration, such as 1h for an hour, or 1d for a day",children:(0,Se.jsx)(xe.Input,{onBlur:e=>h(xt({bucketAgg:p,settingName:"offset",newValue:e.target.value})),defaultValue:(null===(c=p.settings)||void 0===c?void 0:c.offset)||(null===(d=de.date_histogram.defaultSettings)||void 0===d?void 0:d.offset)})})),(0,Se.jsx)(xe.InlineField,Object.assign({label:"Timezone"},Es,{children:(0,Se.jsx)(xe.TimeZonePicker,{value:(null===(u=p.settings)||void 0===u?void 0:u.timeZone)||(null===(m=de.date_histogram.defaultSettings)||void 0===m?void 0:m.timeZone),includeInternal:[n.InternalTimeZones.utc],onChange:e=>{h(xt({bucketAgg:p,settingName:"timeZone",newValue:e}))}})}))]})},ys=e=>{var t,s,n,r,i,l,o,c,d,u;let{bucketAgg:m}=e;const{metrics:p}=Nt(),h=ws(p),v=tt();return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(xe.InlineField,Object.assign({label:"Order"},Es,{children:(0,Se.jsx)(xe.Select,{menuShouldPortal:!0,onChange:e=>v(xt({bucketAgg:m,settingName:"order",newValue:e.value})),options:me,value:(null===(t=m.settings)||void 0===t?void 0:t.order)||(null===(s=de.terms.defaultSettings)||void 0===s?void 0:s.order)})})),(0,Se.jsx)(xe.InlineField,Object.assign({label:"Size"},Es,{children:(0,Se.jsx)(xe.Select,Object.assign({menuShouldPortal:!0},hs({options:pe,value:(null===(n=m.settings)||void 0===n?void 0:n.size)||(null===(r=de.terms.defaultSettings)||void 0===r?void 0:r.size),onChange(e){let{value:t}=e;v(xt({bucketAgg:m,settingName:"size",newValue:t}))}})))})),(0,Se.jsx)(xe.InlineField,Object.assign({label:"Min Doc Count"},Es,{children:(0,Se.jsx)(xe.Input,{onBlur:e=>v(xt({bucketAgg:m,settingName:"min_doc_count",newValue:e.target.value})),defaultValue:(null===(i=m.settings)||void 0===i?void 0:i.min_doc_count)||(null===(l=de.terms.defaultSettings)||void 0===l?void 0:l.min_doc_count)})})),(0,Se.jsx)(xe.InlineField,Object.assign({label:"Order By"},Es,{children:(0,Se.jsx)(xe.Select,{inputId:(0,a.uniqueId)("es-terms-"),menuShouldPortal:!0,onChange:e=>v(xt({bucketAgg:m,settingName:"orderBy",newValue:e.value})),options:h,value:(null===(o=m.settings)||void 0===o?void 0:o.orderBy)||(null===(c=de.terms.defaultSettings)||void 0===c?void 0:c.orderBy)})})),(0,Se.jsx)(xe.InlineField,Object.assign({label:"Missing"},Es,{children:(0,Se.jsx)(xe.Input,{onBlur:e=>v(xt({bucketAgg:m,settingName:"missing",newValue:e.target.value})),defaultValue:(null===(d=m.settings)||void 0===d?void 0:d.missing)||(null===(u=de.terms.defaultSettings)||void 0===u?void 0:u.missing)})}))]})};function _s(e){if(!e.meta)return[];return Object.keys(e.meta).filter((t=>{var s;return null===(s=e.meta)||void 0===s?void 0:s[t]})).map((t=>{let s=t;return"std_deviation_bounds_lower"===t&&(s="std_lower"),"std_deviation_bounds_upper"===t&&(s="std_upper"),{label:`${W(e)} (${s})`,value:`${e.id}[${s}]`}}))}function xs(e){var t;return null!==(t=e.settings)&&void 0!==t&&t.percents?e.settings.percents.map((t=>{const s=/^\d+\.\d+/.test(`${t}`)?t:`${t}.0`;return{label:`${W(e)} (${t})`,value:`${e.id}[${s}]`}})):[]}function js(e){return"top_metrics"!==e.type&&!N(e)}const ws=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=e.filter(js).flatMap((e=>"extended_stats"===e.type?_s(e):"percentiles"===e.type?xs(e):{label:W(e),value:e.id}));return[...ue,...t]},Es={labelWidth:16},Is=e=>{var t,s,n,a,r,i;let{bucketAgg:l}=e;const o=tt(),c=(e=>{const{metrics:t}=Nt();switch(e.type){case"terms":{var s,n,a,r;const l=(null===(s=e.settings)||void 0===s?void 0:s.order)||"desc",o=(null===(n=e.settings)||void 0===n?void 0:n.size)||"10",c=parseInt((null===(a=e.settings)||void 0===a?void 0:a.min_doc_count)||"0",10),d=(null===(r=e.settings)||void 0===r?void 0:r.orderBy)||"_term";let u="";var i;if("0"!==o)u=`${null===(i=me.find(ps(l)))||void 0===i?void 0:i.label} ${o}, `;c>0&&(u+=`Min Doc Count: ${c}, `),u+="Order by: ";const m=ue.find(ps(d));if(m)u+=m.label;else{const e=null==t?void 0:t.find((e=>e.id===X(d)));u+=e?W(e):"metric not found"}return"0"===o&&(u+=` (${l})`),u}case"histogram":{var l,o;const t=(null===(l=e.settings)||void 0===l?void 0:l.interval)||1e3,s=(null===(o=e.settings)||void 0===o?void 0:o.min_doc_count)||1;return`Interval: ${t}${s>0?`, Min Doc Count: ${s}`:""}`}case"filters":var c,d;return`Filter Queries (${((null===(c=e.settings)||void 0===c?void 0:c.filters)||(null===(d=de.filters.defaultSettings)||void 0===d?void 0:d.filters)).length})`;case"geohash_grid":var u;return`Precision: ${Math.max(Math.min(parseInt((null===(u=e.settings)||void 0===u?void 0:u.precision)||"5",10),12),1)}`;case"date_histogram":{var m,p,h;const t=(null===(m=e.settings)||void 0===m?void 0:m.interval)||"auto",s=(null===(p=e.settings)||void 0===p?void 0:p.min_doc_count)||0,n=(null===(h=e.settings)||void 0===h?void 0:h.trimEdges)||0;let a=`Interval: ${t}`;return s>0&&(a+=`, Min Doc Count: ${s}`),n>0&&(a+=`, Trim edges: ${n}`),a}default:return"Settings"}})(l);return(0,Se.jsxs)(Ht,{label:c,children:["terms"===l.type&&(0,Se.jsx)(ys,{bucketAgg:l}),"date_histogram"===l.type&&(0,Se.jsx)(bs,{bucketAgg:l}),"filters"===l.type&&(0,Se.jsx)(ms,{bucketAgg:l}),"geohash_grid"===l.type&&(0,Se.jsx)(xe.InlineField,Object.assign({label:"Precision"},Es,{children:(0,Se.jsx)(xe.Input,{onBlur:e=>o(xt({bucketAgg:l,settingName:"precision",newValue:e.target.value})),defaultValue:(null===(t=l.settings)||void 0===t?void 0:t.precision)||(null===(s=de[l.type].defaultSettings)||void 0===s?void 0:s.precision)})})),"histogram"===l.type&&(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(xe.InlineField,Object.assign({label:"Interval"},Es,{children:(0,Se.jsx)(xe.Input,{onBlur:e=>o(xt({bucketAgg:l,settingName:"interval",newValue:e.target.value})),defaultValue:(null===(n=l.settings)||void 0===n?void 0:n.interval)||(null===(a=de[l.type].defaultSettings)||void 0===a?void 0:a.interval)})})),(0,Se.jsx)(xe.InlineField,Object.assign({label:"Min Doc Count"},Es,{children:(0,Se.jsx)(xe.Input,{onBlur:e=>o(xt({bucketAgg:l,settingName:"min_doc_count",newValue:e.target.value})),defaultValue:(null===(r=l.settings)||void 0===r?void 0:r.min_doc_count)||(null===(i=de[l.type].defaultSettings)||void 0===i?void 0:i.min_doc_count)})}))]})]})},Ss=Object.entries(de).map((e=>{let[t,{label:s}]=e;return{label:s,value:t}})),Ns=e=>{let{value:t}=e;const s=tt(),n=Yt(t.type);return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsxs)(xe.InlineSegmentGroup,{children:[(0,Se.jsx)(xe.Segment,{className:Gt,options:Ss,onChange:e=>s(yt({id:t.id,newType:e.value})),value:(a=t,{label:de[a.type].label,value:a.type})}),he(t)&&(0,Se.jsx)(xe.SegmentAsync,{className:Gt,loadOptions:n,onChange:e=>s(_t({id:t.id,newField:e.value})),placeholder:"Select Field",value:t.field})]}),(0,Se.jsx)(Is,{bucketAgg:t})]});var a},Os=e=>{let{nextId:t}=e;const s=tt(),{bucketAggs:n}=Nt(),a=(null==n?void 0:n.length)||0;return(0,Se.jsx)(Se.Fragment,{children:n.map(((e,n)=>(0,Se.jsxs)(rs,{label:0===n?"Group By":"Then By",onRemoveClick:a>1&&(()=>s(bt(e.id))),children:[(0,Se.jsx)(Ns,{value:e}),0===n&&(0,Se.jsx)(Rt,{iconName:"plus",onClick:()=>s(ft(t)),label:"add"})]},`${e.type}-${e.id}`)))})},Ts=e=>e.id,$s=e=>parseInt(e,10),ks=e=>{var t,s,n;let{value:a}=e;const r=tt(),i=(()=>{const{metrics:e,bucketAggs:t}=Nt();return(0,_e.useMemo)((()=>(Math.max(...[...(null==e?void 0:e.map(Ts))||["0"],...(null==t?void 0:t.map(Ts))||["0"]].map($s))+1).toString()),[e,t])})(),l="date_histogram"===(null===(t=a.bucketAggs)||void 0===t||null===(s=t.slice(-1)[0])||void 0===s?void 0:s.type),o=null===(n=a.metrics)||void 0===n?void 0:n.every((e=>!z[e.type].isSingleMetric));return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsxs)(xe.InlineFieldRow,{children:[(0,Se.jsx)(xe.InlineField,{label:"Query",labelWidth:17,grow:!0,children:(0,Se.jsx)(xe.QueryField,{query:a.query,onBlur:()=>{},onChange:e=>r(at(e)),placeholder:"Lucene Query",portalOrigin:"elasticsearch"})}),(0,Se.jsx)(xe.InlineField,{label:"Alias",labelWidth:15,disabled:!l,tooltip:"Aliasing only works for timeseries queries (when the last group is 'Date Histogram'). For all other query types this field is ignored.",children:(0,Se.jsx)(xe.Input,{id:`ES-query-${a.refId}_alias`,placeholder:"Alias Pattern",onBlur:e=>r(rt(e.currentTarget.value)),defaultValue:a.alias})})]}),(0,Se.jsx)(ls,{nextId:i}),o&&(0,Se.jsx)(Os,{nextId:i})]})};class Rs{}var As,Fs,zs;zs="partials/annotations.editor.html",(Fs="templateUrl")in(As=Rs)?Object.defineProperty(As,Fs,{value:zs,enumerable:!0,configurable:!0,writable:!0}):As[Fs]=zs;const Cs=new n.DataSourcePlugin(ye).setQueryEditor((e=>{let{query:t,onChange:s,onRunQuery:a,datasource:r,range:i}=e;return(0,Se.jsx)(It,{datasource:r,onChange:s,onRunQuery:a,query:t,range:i||(0,n.getDefaultTimeRange)(),children:(0,Se.jsx)(ks,{value:t})})})).setConfigEditor((e=>{const{options:t,onOptionsChange:s}=e,n=je(t);return(0,_e.useEffect)((()=>{(e=>!!(0,v.valid)(e.jsonData.esVersion)&&!!e.jsonData.timeField&&!!e.jsonData.maxConcurrentShardRequests&&void 0!==e.jsonData.logMessageField&&void 0!==e.jsonData.logLevelField)(t)||s(je(t))}),[]),(0,Se.jsxs)(Se.Fragment,{children:["direct"===n.access&&(Ze||(Ze=(0,Se.jsx)(xe.Alert,{title:"Deprecation Notice",severity:"warning",children:"Browser access mode in the Elasticsearch datasource is deprecated and will be removed in a future release."}))),(0,Se.jsx)(xe.DataSourceHttpSettings,{defaultUrl:"http://localhost:9200",dataSourceConfig:n,showAccessOptions:!0,onChange:s,sigV4AuthToggleEnabled:Je.vc.sigV4AuthEnabled}),(0,Se.jsx)(Ae,{value:n,onChange:s}),(0,Se.jsx)(De,{value:n.jsonData,onChange:e=>s(Object.assign({},n,{jsonData:e}))}),(0,Se.jsx)(Ye,{value:n.jsonData.dataLinks,onChange:e=>{s(Object.assign({},n,{jsonData:Object.assign({},n.jsonData,{dataLinks:e})}))}})]})})).setAnnotationQueryCtrl(Rs)},"./public/app/plugins/datasource/prometheus/promql.ts":(e,t,s)=>{"use strict";s.d(t,{Ty:()=>n,r8:()=>a,ZP:()=>r});const n=[{label:"$__interval",sortValue:"$__interval"},{label:"$__rate_interval",sortValue:"$__rate_interval"},{label:"$__range",sortValue:"$__range"},{label:"1m",sortValue:"00:01:00"},{label:"5m",sortValue:"00:05:00"},{label:"10m",sortValue:"00:10:00"},{label:"30m",sortValue:"00:30:00"},{label:"1h",sortValue:"01:00:00"},{label:"1d",sortValue:"24:00:00"}],a=[{label:"sum",insertText:"sum",documentation:"Calculate sum over dimensions"},{label:"min",insertText:"min",documentation:"Select minimum over dimensions"},{label:"max",insertText:"max",documentation:"Select maximum over dimensions"},{label:"avg",insertText:"avg",documentation:"Calculate the average over dimensions"},{label:"group",insertText:"group",documentation:"All values in the resulting vector are 1"},{label:"stddev",insertText:"stddev",documentation:"Calculate population standard deviation over dimensions"},{label:"stdvar",insertText:"stdvar",documentation:"Calculate population standard variance over dimensions"},{label:"count",insertText:"count",documentation:"Count number of elements in the vector"},{label:"count_values",insertText:"count_values",documentation:"Count number of elements with the same value"},{label:"bottomk",insertText:"bottomk",documentation:"Smallest k elements by sample value"},{label:"topk",insertText:"topk",documentation:"Largest k elements by sample value"},{label:"quantile",insertText:"quantile",documentation:"Calculate φ-quantile (0 ≤ φ ≤ 1) over dimensions"},{insertText:"abs",label:"abs",detail:"abs(v instant-vector)",documentation:"Returns the input vector with all sample values converted to their absolute value."},{insertText:"absent",label:"absent",detail:"absent(v instant-vector)",documentation:"Returns an empty vector if the vector passed to it has any elements and a 1-element vector with the value 1 if the vector passed to it has no elements. This is useful for alerting on when no time series exist for a given metric name and label combination."},{insertText:"absent_over_time",label:"absent_over_time",detail:"absent(v range-vector)",documentation:"Returns an empty vector if the range vector passed to it has any elements and a 1-element vector with the value 1 if the range vector passed to it has no elements."},{insertText:"ceil",label:"ceil",detail:"ceil(v instant-vector)",documentation:"Rounds the sample values of all elements in `v` up to the nearest integer."},{insertText:"changes",label:"changes",detail:"changes(v range-vector)",documentation:"For each input time series, `changes(v range-vector)` returns the number of times its value has changed within the provided time range as an instant vector."},{insertText:"clamp",label:"clamp",detail:"clamp(v instant-vector, min scalar, max scalar)",documentation:"Clamps the sample values of all elements in `v` to have a lower limit of `min` and an upper limit of `max`."},{insertText:"clamp_max",label:"clamp_max",detail:"clamp_max(v instant-vector, max scalar)",documentation:"Clamps the sample values of all elements in `v` to have an upper limit of `max`."},{insertText:"clamp_min",label:"clamp_min",detail:"clamp_min(v instant-vector, min scalar)",documentation:"Clamps the sample values of all elements in `v` to have a lower limit of `min`."},{insertText:"count_scalar",label:"count_scalar",detail:"count_scalar(v instant-vector)",documentation:"Returns the number of elements in a time series vector as a scalar. This is in contrast to the `count()` aggregation operator, which always returns a vector (an empty one if the input vector is empty) and allows grouping by labels via a `by` clause."},{insertText:"day_of_month",label:"day_of_month",detail:"day_of_month(v=vector(time()) instant-vector)",documentation:"Returns the day of the month for each of the given times in UTC. Returned values are from 1 to 31."},{insertText:"day_of_week",label:"day_of_week",detail:"day_of_week(v=vector(time()) instant-vector)",documentation:"Returns the day of the week for each of the given times in UTC. Returned values are from 0 to 6, where 0 means Sunday etc."},{insertText:"days_in_month",label:"days_in_month",detail:"days_in_month(v=vector(time()) instant-vector)",documentation:"Returns number of days in the month for each of the given times in UTC. Returned values are from 28 to 31."},{insertText:"delta",label:"delta",detail:"delta(v range-vector)",documentation:"Calculates the difference between the first and last value of each time series element in a range vector `v`, returning an instant vector with the given deltas and equivalent labels. The delta is extrapolated to cover the full time range as specified in the range vector selector, so that it is possible to get a non-integer result even if the sample values are all integers."},{insertText:"deriv",label:"deriv",detail:"deriv(v range-vector)",documentation:"Calculates the per-second derivative of the time series in a range vector `v`, using simple linear regression."},{insertText:"drop_common_labels",label:"drop_common_labels",detail:"drop_common_labels(instant-vector)",documentation:"Drops all labels that have the same name and value across all series in the input vector."},{insertText:"exp",label:"exp",detail:"exp(v instant-vector)",documentation:"Calculates the exponential function for all elements in `v`.\nSpecial cases are:\n* `Exp(+Inf) = +Inf` \n* `Exp(NaN) = NaN`"},{insertText:"floor",label:"floor",detail:"floor(v instant-vector)",documentation:"Rounds the sample values of all elements in `v` down to the nearest integer."},{insertText:"histogram_quantile",label:"histogram_quantile",detail:"histogram_quantile(φ float, b instant-vector)",documentation:"Calculates the φ-quantile (0 ≤ φ ≤ 1) from the buckets `b` of a histogram. The samples in `b` are the counts of observations in each bucket. Each sample must have a label `le` where the label value denotes the inclusive upper bound of the bucket. (Samples without such a label are silently ignored.) The histogram metric type automatically provides time series with the `_bucket` suffix and the appropriate labels."},{insertText:"holt_winters",label:"holt_winters",detail:"holt_winters(v range-vector, sf scalar, tf scalar)",documentation:"Produces a smoothed value for time series based on the range in `v`. The lower the smoothing factor `sf`, the more importance is given to old data. The higher the trend factor `tf`, the more trends in the data is considered. Both `sf` and `tf` must be between 0 and 1."},{insertText:"hour",label:"hour",detail:"hour(v=vector(time()) instant-vector)",documentation:"Returns the hour of the day for each of the given times in UTC. Returned values are from 0 to 23."},{insertText:"idelta",label:"idelta",detail:"idelta(v range-vector)",documentation:"Calculates the difference between the last two samples in the range vector `v`, returning an instant vector with the given deltas and equivalent labels."},{insertText:"increase",label:"increase",detail:"increase(v range-vector)",documentation:"Calculates the increase in the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. The increase is extrapolated to cover the full time range as specified in the range vector selector, so that it is possible to get a non-integer result even if a counter increases only by integer increments."},{insertText:"irate",label:"irate",detail:"irate(v range-vector)",documentation:"Calculates the per-second instant rate of increase of the time series in the range vector. This is based on the last two data points. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for."},{insertText:"label_join",label:"label_join",detail:"label_join(v instant-vector, dst_label string, separator string, src_label_1 string, src_label_2 string, ...)",documentation:"For each timeseries in `v`, joins all the values of all the `src_labels` using `separator` and returns the timeseries with the label `dst_label` containing the joined value. There can be any number of `src_labels` in this function."},{insertText:"label_replace",label:"label_replace",detail:"label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)",documentation:"For each timeseries in `v`, `label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)`  matches the regular expression `regex` against the label `src_label`.  If it matches, then the timeseries is returned with the label `dst_label` replaced by the expansion of `replacement`. `$1` is replaced with the first matching subgroup, `$2` with the second etc. If the regular expression doesn't match then the timeseries is returned unchanged."},{insertText:"ln",label:"ln",detail:"ln(v instant-vector)",documentation:"Calculates the natural logarithm for all elements in `v`.\nSpecial cases are:\n * `ln(+Inf) = +Inf`\n * `ln(0) = -Inf`\n * `ln(x < 0) = NaN`\n * `ln(NaN) = NaN`"},{insertText:"log2",label:"log2",detail:"log2(v instant-vector)",documentation:"Calculates the binary logarithm for all elements in `v`. The special cases are equivalent to those in `ln`."},{insertText:"log10",label:"log10",detail:"log10(v instant-vector)",documentation:"Calculates the decimal logarithm for all elements in `v`. The special cases are equivalent to those in `ln`."},{insertText:"minute",label:"minute",detail:"minute(v=vector(time()) instant-vector)",documentation:"Returns the minute of the hour for each of the given times in UTC. Returned values are from 0 to 59."},{insertText:"month",label:"month",detail:"month(v=vector(time()) instant-vector)",documentation:"Returns the month of the year for each of the given times in UTC. Returned values are from 1 to 12, where 1 means January etc."},{insertText:"predict_linear",label:"predict_linear",detail:"predict_linear(v range-vector, t scalar)",documentation:"Predicts the value of time series `t` seconds from now, based on the range vector `v`, using simple linear regression."},{insertText:"rate",label:"rate",detail:"rate(v range-vector)",documentation:"Calculates the per-second average rate of increase of the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. Also, the calculation extrapolates to the ends of the time range, allowing for missed scrapes or imperfect alignment of scrape cycles with the range's time period."},{insertText:"resets",label:"resets",detail:"resets(v range-vector)",documentation:"For each input time series, `resets(v range-vector)` returns the number of counter resets within the provided time range as an instant vector. Any decrease in the value between two consecutive samples is interpreted as a counter reset."},{insertText:"round",label:"round",detail:"round(v instant-vector, to_nearest=1 scalar)",documentation:"Rounds the sample values of all elements in `v` to the nearest integer. Ties are resolved by rounding up. The optional `to_nearest` argument allows specifying the nearest multiple to which the sample values should be rounded. This multiple may also be a fraction."},{insertText:"scalar",label:"scalar",detail:"scalar(v instant-vector)",documentation:"Given a single-element input vector, `scalar(v instant-vector)` returns the sample value of that single element as a scalar. If the input vector does not have exactly one element, `scalar` will return `NaN`."},{insertText:"sgn",label:"sgn",detail:"sgn(v instant-vector)",documentation:"Returns a vector with all sample values converted to their sign, defined as this: 1 if v is positive, -1 if v is negative and 0 if v is equal to zero."},{insertText:"sort",label:"sort",detail:"sort(v instant-vector)",documentation:"Returns vector elements sorted by their sample values, in ascending order."},{insertText:"sort_desc",label:"sort_desc",detail:"sort_desc(v instant-vector)",documentation:"Returns vector elements sorted by their sample values, in descending order."},{insertText:"sqrt",label:"sqrt",detail:"sqrt(v instant-vector)",documentation:"Calculates the square root of all elements in `v`."},{insertText:"time",label:"time",detail:"time()",documentation:"Returns the number of seconds since January 1, 1970 UTC. Note that this does not actually return the current time, but the time at which the expression is to be evaluated."},{insertText:"timestamp",label:"timestamp",detail:"timestamp(v instant-vector)",documentation:"Returns the timestamp of each of the samples of the given vector as the number of seconds since January 1, 1970 UTC."},{insertText:"vector",label:"vector",detail:"vector(s scalar)",documentation:"Returns the scalar `s` as a vector with no labels."},{insertText:"year",label:"year",detail:"year(v=vector(time()) instant-vector)",documentation:"Returns the year for each of the given times in UTC."},{insertText:"avg_over_time",label:"avg_over_time",detail:"avg_over_time(range-vector)",documentation:"The average value of all points in the specified interval."},{insertText:"min_over_time",label:"min_over_time",detail:"min_over_time(range-vector)",documentation:"The minimum value of all points in the specified interval."},{insertText:"max_over_time",label:"max_over_time",detail:"max_over_time(range-vector)",documentation:"The maximum value of all points in the specified interval."},{insertText:"sum_over_time",label:"sum_over_time",detail:"sum_over_time(range-vector)",documentation:"The sum of all values in the specified interval."},{insertText:"count_over_time",label:"count_over_time",detail:"count_over_time(range-vector)",documentation:"The count of all values in the specified interval."},{insertText:"quantile_over_time",label:"quantile_over_time",detail:"quantile_over_time(scalar, range-vector)",documentation:"The φ-quantile (0 ≤ φ ≤ 1) of the values in the specified interval."},{insertText:"stddev_over_time",label:"stddev_over_time",detail:"stddev_over_time(range-vector)",documentation:"The population standard deviation of the values in the specified interval."},{insertText:"stdvar_over_time",label:"stdvar_over_time",detail:"stdvar_over_time(range-vector)",documentation:"The population standard variance of the values in the specified interval."},{insertText:"last_over_time",label:"last_over_time",detail:"last_over_time(range-vector)",documentation:"The most recent point value in specified interval."}],r={comment:{pattern:/#.*/},"context-aggregation":{pattern:/((by|without)\s*)\([^)]*\)/,lookbehind:!0,inside:{"label-key":{pattern:/[^(),\s][^,)]*[^),\s]*/,alias:"attr-name"},punctuation:/[()]/}},"context-labels":{pattern:/\{[^}]*(?=}?)/,greedy:!0,inside:{comment:{pattern:/#.*/},"label-key":{pattern:/[a-z_]\w*(?=\s*(=|!=|=~|!~))/,alias:"attr-name",greedy:!0},"label-value":{pattern:/"(?:\\.|[^\\"])*"/,greedy:!0,alias:"attr-value"},punctuation:/[{]/}},function:new RegExp(`\\b(?:${a.map((e=>e.label)).join("|")})(?=\\s*\\()`,"i"),"context-range":[{pattern:/\[[^\]]*(?=])/,inside:{"range-duration":{pattern:/\b\d+[smhdwy]\b/i,alias:"number"}}},{pattern:/(offset\s+)\w+/,lookbehind:!0,inside:{"range-duration":{pattern:/\b\d+[smhdwy]\b/i,alias:"number"}}}],idList:{pattern:/\d+(\|\d+)+/,alias:"number"},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,operator:new RegExp(`/[-+*/=%^~]|&&?|\\|?\\||!=?|<(?:=>?|<|>)?|>[>=]?|\\b(?:${["by","group_left","group_right","ignoring","on","offset","without"].join("|")})\\b`,"i"),punctuation:/[{};()`,.]/}},"./.yarn/__virtual__/react-use-virtual-ca2705900f/0/cache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/usePrevious.js":(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var n=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js");function a(e){var t=(0,n.useRef)();return(0,n.useEffect)((function(){t.current=e})),t.current}},"./.yarn/cache/lru-cache-npm-6.0.0-b4c8668fe1-f97f499f89.zip/node_modules/lru-cache/index.js":(e,t,s)=>{"use strict";const n=s("./.yarn/cache/yallist-npm-4.0.0-b493d9e907-343617202a.zip/node_modules/yallist/yallist.js"),a=Symbol("max"),r=Symbol("length"),i=Symbol("lengthCalculator"),l=Symbol("allowStale"),o=Symbol("maxAge"),c=Symbol("dispose"),d=Symbol("noDisposeOnSet"),u=Symbol("lruList"),m=Symbol("cache"),p=Symbol("updateAgeOnGet"),h=()=>1;const v=(e,t,s)=>{const n=e[m].get(t);if(n){const t=n.value;if(g(e,t)){if(b(e,n),!e[l])return}else s&&(e[p]&&(n.value.now=Date.now()),e[u].unshiftNode(n));return t.value}},g=(e,t)=>{if(!t||!t.maxAge&&!e[o])return!1;const s=Date.now()-t.now;return t.maxAge?s>t.maxAge:e[o]&&s>e[o]},f=e=>{if(e[r]>e[a])for(let t=e[u].tail;e[r]>e[a]&&null!==t;){const s=t.prev;b(e,t),t=s}},b=(e,t)=>{if(t){const s=t.value;e[c]&&e[c](s.key,s.value),e[r]-=s.length,e[m].delete(s.key),e[u].removeNode(t)}};class y{constructor(e,t,s,n,a){this.key=e,this.value=t,this.length=s,this.now=n,this.maxAge=a||0}}const _=(e,t,s,n)=>{let a=s.value;g(e,a)&&(b(e,s),e[l]||(a=void 0)),a&&t.call(n,a.value,a.key,e)};e.exports=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[a]=e.max||1/0;const t=e.length||h;if(this[i]="function"!=typeof t?h:t,this[l]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[o]=e.maxAge||0,this[c]=e.dispose,this[d]=e.noDisposeOnSet||!1,this[p]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[a]=e||1/0,f(this)}get max(){return this[a]}set allowStale(e){this[l]=!!e}get allowStale(){return this[l]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[o]=e,f(this)}get maxAge(){return this[o]}set lengthCalculator(e){"function"!=typeof e&&(e=h),e!==this[i]&&(this[i]=e,this[r]=0,this[u].forEach((e=>{e.length=this[i](e.value,e.key),this[r]+=e.length}))),f(this)}get lengthCalculator(){return this[i]}get length(){return this[r]}get itemCount(){return this[u].length}rforEach(e,t){t=t||this;for(let s=this[u].tail;null!==s;){const n=s.prev;_(this,e,s,t),s=n}}forEach(e,t){t=t||this;for(let s=this[u].head;null!==s;){const n=s.next;_(this,e,s,t),s=n}}keys(){return this[u].toArray().map((e=>e.key))}values(){return this[u].toArray().map((e=>e.value))}reset(){this[c]&&this[u]&&this[u].length&&this[u].forEach((e=>this[c](e.key,e.value))),this[m]=new Map,this[u]=new n,this[r]=0}dump(){return this[u].map((e=>!g(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[u]}set(e,t,s){if((s=s||this[o])&&"number"!=typeof s)throw new TypeError("maxAge must be a number");const n=s?Date.now():0,l=this[i](t,e);if(this[m].has(e)){if(l>this[a])return b(this,this[m].get(e)),!1;const i=this[m].get(e).value;return this[c]&&(this[d]||this[c](e,i.value)),i.now=n,i.maxAge=s,i.value=t,this[r]+=l-i.length,i.length=l,this.get(e),f(this),!0}const p=new y(e,t,l,n,s);return p.length>this[a]?(this[c]&&this[c](e,t),!1):(this[r]+=p.length,this[u].unshift(p),this[m].set(e,this[u].head),f(this),!0)}has(e){if(!this[m].has(e))return!1;const t=this[m].get(e).value;return!g(this,t)}get(e){return v(this,e,!0)}peek(e){return v(this,e,!1)}pop(){const e=this[u].tail;return e?(b(this,e),e.value):null}del(e){b(this,this[m].get(e))}load(e){this.reset();const t=Date.now();for(let s=e.length-1;s>=0;s--){const n=e[s],a=n.e||0;if(0===a)this.set(n.k,n.v);else{const e=a-t;e>0&&this.set(n.k,n.v,e)}}}prune(){this[m].forEach(((e,t)=>v(this,t,!1)))}}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/comparator.js":(e,t,s)=>{const n=Symbol("SemVer ANY");class a{static get ANY(){return n}constructor(e,t){if(t=r(t),e instanceof a){if(e.loose===!!t.loose)return e;e=e.value}c("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===n?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(e){const t=this.options.loose?i[l.COMPARATORLOOSE]:i[l.COMPARATOR],s=e.match(t);if(!s)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==s[1]?s[1]:"","="===this.operator&&(this.operator=""),s[2]?this.semver=new d(s[2],this.options.loose):this.semver=n}toString(){return this.value}test(e){if(c("Comparator.test",e,this.options.loose),this.semver===n||e===n)return!0;if("string"==typeof e)try{e=new d(e,this.options)}catch(e){return!1}return o(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof a))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new u(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new u(this.value,t).test(e.semver);const s=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),n=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),r=this.semver.version===e.semver.version,i=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),l=o(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),c=o(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return s||n||r&&i||l||c}}e.exports=a;const r=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/parse-options.js"),{re:i,t:l}=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/re.js"),o=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/cmp.js"),c=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/debug.js"),d=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/semver.js"),u=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/range.js")},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/range.js":(e,t,s)=>{class n{constructor(e,t){if(t=r(t),e instanceof n)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new n(e.raw,t);if(e instanceof i)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!h(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&v(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,s=a.get(t);if(s)return s;const n=this.options.loose,r=n?c[d.HYPHENRANGELOOSE]:c[d.HYPHENRANGE];e=e.replace(r,N(this.options.includePrerelease)),l("hyphen replace",e),e=e.replace(c[d.COMPARATORTRIM],u),l("comparator trim",e,c[d.COMPARATORTRIM]),e=(e=(e=e.replace(c[d.TILDETRIM],m)).replace(c[d.CARETTRIM],p)).split(/\s+/).join(" ");const o=n?c[d.COMPARATORLOOSE]:c[d.COMPARATOR],v=e.split(" ").map((e=>f(e,this.options))).join(" ").split(/\s+/).map((e=>S(e,this.options))).filter(this.options.loose?e=>!!e.match(o):()=>!0).map((e=>new i(e,this.options))),g=(v.length,new Map);for(const e of v){if(h(e))return[e];g.set(e.value,e)}g.size>1&&g.has("")&&g.delete("");const b=[...g.values()];return a.set(t,b),b}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Range is required");return this.set.some((s=>g(s,t)&&e.set.some((e=>g(e,t)&&s.every((s=>e.every((e=>s.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new o(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(O(this.set[t],e,this.options))return!0;return!1}}e.exports=n;const a=new(s("./.yarn/cache/lru-cache-npm-6.0.0-b4c8668fe1-f97f499f89.zip/node_modules/lru-cache/index.js"))({max:1e3}),r=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/parse-options.js"),i=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/comparator.js"),l=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/debug.js"),o=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/semver.js"),{re:c,t:d,comparatorTrimReplace:u,tildeTrimReplace:m,caretTrimReplace:p}=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/re.js"),h=e=>"<0.0.0-0"===e.value,v=e=>""===e.value,g=(e,t)=>{let s=!0;const n=e.slice();let a=n.pop();for(;s&&n.length;)s=n.every((e=>a.intersects(e,t))),a=n.pop();return s},f=(e,t)=>(l("comp",e,t),e=x(e,t),l("caret",e),e=y(e,t),l("tildes",e),e=w(e,t),l("xrange",e),e=I(e,t),l("stars",e),e),b=e=>!e||"x"===e.toLowerCase()||"*"===e,y=(e,t)=>e.trim().split(/\s+/).map((e=>_(e,t))).join(" "),_=(e,t)=>{const s=t.loose?c[d.TILDELOOSE]:c[d.TILDE];return e.replace(s,((t,s,n,a,r)=>{let i;return l("tilde",e,t,s,n,a,r),b(s)?i="":b(n)?i=`>=${s}.0.0 <${+s+1}.0.0-0`:b(a)?i=`>=${s}.${n}.0 <${s}.${+n+1}.0-0`:r?(l("replaceTilde pr",r),i=`>=${s}.${n}.${a}-${r} <${s}.${+n+1}.0-0`):i=`>=${s}.${n}.${a} <${s}.${+n+1}.0-0`,l("tilde return",i),i}))},x=(e,t)=>e.trim().split(/\s+/).map((e=>j(e,t))).join(" "),j=(e,t)=>{l("caret",e,t);const s=t.loose?c[d.CARETLOOSE]:c[d.CARET],n=t.includePrerelease?"-0":"";return e.replace(s,((t,s,a,r,i)=>{let o;return l("caret",e,t,s,a,r,i),b(s)?o="":b(a)?o=`>=${s}.0.0${n} <${+s+1}.0.0-0`:b(r)?o="0"===s?`>=${s}.${a}.0${n} <${s}.${+a+1}.0-0`:`>=${s}.${a}.0${n} <${+s+1}.0.0-0`:i?(l("replaceCaret pr",i),o="0"===s?"0"===a?`>=${s}.${a}.${r}-${i} <${s}.${a}.${+r+1}-0`:`>=${s}.${a}.${r}-${i} <${s}.${+a+1}.0-0`:`>=${s}.${a}.${r}-${i} <${+s+1}.0.0-0`):(l("no pr"),o="0"===s?"0"===a?`>=${s}.${a}.${r}${n} <${s}.${a}.${+r+1}-0`:`>=${s}.${a}.${r}${n} <${s}.${+a+1}.0-0`:`>=${s}.${a}.${r} <${+s+1}.0.0-0`),l("caret return",o),o}))},w=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map((e=>E(e,t))).join(" ")),E=(e,t)=>{e=e.trim();const s=t.loose?c[d.XRANGELOOSE]:c[d.XRANGE];return e.replace(s,((s,n,a,r,i,o)=>{l("xRange",e,s,n,a,r,i,o);const c=b(a),d=c||b(r),u=d||b(i),m=u;return"="===n&&m&&(n=""),o=t.includePrerelease?"-0":"",c?s=">"===n||"<"===n?"<0.0.0-0":"*":n&&m?(d&&(r=0),i=0,">"===n?(n=">=",d?(a=+a+1,r=0,i=0):(r=+r+1,i=0)):"<="===n&&(n="<",d?a=+a+1:r=+r+1),"<"===n&&(o="-0"),s=`${n+a}.${r}.${i}${o}`):d?s=`>=${a}.0.0${o} <${+a+1}.0.0-0`:u&&(s=`>=${a}.${r}.0${o} <${a}.${+r+1}.0-0`),l("xRange return",s),s}))},I=(e,t)=>(l("replaceStars",e,t),e.trim().replace(c[d.STAR],"")),S=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(c[t.includePrerelease?d.GTE0PRE:d.GTE0],"")),N=e=>(t,s,n,a,r,i,l,o,c,d,u,m,p)=>`${s=b(n)?"":b(a)?`>=${n}.0.0${e?"-0":""}`:b(r)?`>=${n}.${a}.0${e?"-0":""}`:i?`>=${s}`:`>=${s}${e?"-0":""}`} ${o=b(c)?"":b(d)?`<${+c+1}.0.0-0`:b(u)?`<${c}.${+d+1}.0-0`:m?`<=${c}.${d}.${u}-${m}`:e?`<${c}.${d}.${+u+1}-0`:`<=${o}`}`.trim(),O=(e,t,s)=>{for(let s=0;s<e.length;s++)if(!e[s].test(t))return!1;if(t.prerelease.length&&!s.includePrerelease){for(let s=0;s<e.length;s++)if(l(e[s].semver),e[s].semver!==i.ANY&&e[s].semver.prerelease.length>0){const n=e[s].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/semver.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/debug.js"),{MAX_LENGTH:a,MAX_SAFE_INTEGER:r}=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/constants.js"),{re:i,t:l}=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/re.js"),o=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/parse-options.js"),{compareIdentifiers:c}=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/identifiers.js");class d{constructor(e,t){if(t=o(t),e instanceof d){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>a)throw new TypeError(`version is longer than ${a} characters`);n("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const s=e.trim().match(t.loose?i[l.LOOSE]:i[l.FULL]);if(!s)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>r||this.major<0)throw new TypeError("Invalid major version");if(this.minor>r||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>r||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<r)return t}return e})):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(n("SemVer.compare",this.version,this.options,e),!(e instanceof d)){if("string"==typeof e&&e===this.version)return 0;e=new d(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof d||(e=new d(e,this.options)),c(this.major,e.major)||c(this.minor,e.minor)||c(this.patch,e.patch)}comparePre(e){if(e instanceof d||(e=new d(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const s=this.prerelease[t],a=e.prerelease[t];if(n("prerelease compare",t,s,a),void 0===s&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===s)return-1;if(s!==a)return c(s,a)}while(++t)}compareBuild(e){e instanceof d||(e=new d(e,this.options));let t=0;do{const s=this.build[t],a=e.build[t];if(n("prerelease compare",t,s,a),void 0===s&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===s)return-1;if(s!==a)return c(s,a)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}e.exports=d},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/clean.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/parse.js");e.exports=(e,t)=>{const s=n(e.trim().replace(/^[=v]+/,""),t);return s?s.version:null}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/cmp.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/eq.js"),a=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/neq.js"),r=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/gt.js"),i=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/gte.js"),l=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/lt.js"),o=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/lte.js");e.exports=(e,t,s,c)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof s&&(s=s.version),e===s;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof s&&(s=s.version),e!==s;case"":case"=":case"==":return n(e,s,c);case"!=":return a(e,s,c);case">":return r(e,s,c);case">=":return i(e,s,c);case"<":return l(e,s,c);case"<=":return o(e,s,c);default:throw new TypeError(`Invalid operator: ${t}`)}}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/coerce.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/semver.js"),a=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/parse.js"),{re:r,t:i}=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/re.js");e.exports=(e,t)=>{if(e instanceof n)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let s=null;if((t=t||{}).rtl){let t;for(;(t=r[i.COERCERTL].exec(e))&&(!s||s.index+s[0].length!==e.length);)s&&t.index+t[0].length===s.index+s[0].length||(s=t),r[i.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;r[i.COERCERTL].lastIndex=-1}else s=e.match(r[i.COERCE]);return null===s?null:a(`${s[2]}.${s[3]||"0"}.${s[4]||"0"}`,t)}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare-build.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/semver.js");e.exports=(e,t,s)=>{const a=new n(e,s),r=new n(t,s);return a.compare(r)||a.compareBuild(r)}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare-loose.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare.js");e.exports=(e,t)=>n(e,t,!0)},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/semver.js");e.exports=(e,t,s)=>new n(e,s).compare(new n(t,s))},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/diff.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/parse.js"),a=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/eq.js");e.exports=(e,t)=>{if(a(e,t))return null;{const s=n(e),a=n(t),r=s.prerelease.length||a.prerelease.length,i=r?"pre":"",l=r?"prerelease":"";for(const e in s)if(("major"===e||"minor"===e||"patch"===e)&&s[e]!==a[e])return i+e;return l}}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/eq.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare.js");e.exports=(e,t,s)=>0===n(e,t,s)},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/gt.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare.js");e.exports=(e,t,s)=>n(e,t,s)>0},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/gte.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare.js");e.exports=(e,t,s)=>n(e,t,s)>=0},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/inc.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/semver.js");e.exports=(e,t,s,a)=>{"string"==typeof s&&(a=s,s=void 0);try{return new n(e,s).inc(t,a).version}catch(e){return null}}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/lt.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare.js");e.exports=(e,t,s)=>n(e,t,s)<0},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/lte.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare.js");e.exports=(e,t,s)=>n(e,t,s)<=0},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/major.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/semver.js");e.exports=(e,t)=>new n(e,t).major},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/minor.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/semver.js");e.exports=(e,t)=>new n(e,t).minor},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/neq.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare.js");e.exports=(e,t,s)=>0!==n(e,t,s)},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/parse.js":(e,t,s)=>{const{MAX_LENGTH:n}=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/constants.js"),{re:a,t:r}=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/re.js"),i=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/semver.js"),l=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/parse-options.js");e.exports=(e,t)=>{if(t=l(t),e instanceof i)return e;if("string"!=typeof e)return null;if(e.length>n)return null;if(!(t.loose?a[r.LOOSE]:a[r.FULL]).test(e))return null;try{return new i(e,t)}catch(e){return null}}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/patch.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/semver.js");e.exports=(e,t)=>new n(e,t).patch},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/prerelease.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/parse.js");e.exports=(e,t)=>{const s=n(e,t);return s&&s.prerelease.length?s.prerelease:null}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/rcompare.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare.js");e.exports=(e,t,s)=>n(t,e,s)},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/rsort.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare-build.js");e.exports=(e,t)=>e.sort(((e,s)=>n(s,e,t)))},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/satisfies.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/range.js");e.exports=(e,t,s)=>{try{t=new n(t,s)}catch(e){return!1}return t.test(e)}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/sort.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare-build.js");e.exports=(e,t)=>e.sort(((e,s)=>n(e,s,t)))},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/valid.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/parse.js");e.exports=(e,t)=>{const s=n(e,t);return s?s.version:null}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/index.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/re.js");e.exports={re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/constants.js").SEMVER_SPEC_VERSION,SemVer:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/semver.js"),compareIdentifiers:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/identifiers.js").compareIdentifiers,rcompareIdentifiers:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/identifiers.js").rcompareIdentifiers,parse:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/parse.js"),valid:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/valid.js"),clean:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/clean.js"),inc:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/inc.js"),diff:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/diff.js"),major:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/major.js"),minor:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/minor.js"),patch:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/patch.js"),prerelease:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/prerelease.js"),compare:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare.js"),rcompare:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/rcompare.js"),compareLoose:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare-loose.js"),compareBuild:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare-build.js"),sort:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/sort.js"),rsort:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/rsort.js"),gt:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/gt.js"),lt:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/lt.js"),eq:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/eq.js"),neq:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/neq.js"),gte:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/gte.js"),lte:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/lte.js"),cmp:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/cmp.js"),coerce:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/coerce.js"),Comparator:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/comparator.js"),Range:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/range.js"),satisfies:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/satisfies.js"),toComparators:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/to-comparators.js"),maxSatisfying:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/max-satisfying.js"),minSatisfying:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/min-satisfying.js"),minVersion:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/min-version.js"),validRange:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/valid.js"),outside:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/outside.js"),gtr:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/gtr.js"),ltr:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/ltr.js"),intersects:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/intersects.js"),simplifyRange:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/simplify.js"),subset:s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/subset.js")}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/constants.js":e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:t,MAX_SAFE_COMPONENT_LENGTH:16}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/debug.js":e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/identifiers.js":e=>{const t=/^[0-9]+$/,s=(e,s)=>{const n=t.test(e),a=t.test(s);return n&&a&&(e=+e,s=+s),e===s?0:n&&!a?-1:a&&!n?1:e<s?-1:1};e.exports={compareIdentifiers:s,rcompareIdentifiers:(e,t)=>s(t,e)}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/parse-options.js":e=>{const t=["includePrerelease","loose","rtl"];e.exports=e=>e?"object"!=typeof e?{loose:!0}:t.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/re.js":(e,t,s)=>{const{MAX_SAFE_COMPONENT_LENGTH:n}=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/constants.js"),a=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/internal/debug.js"),r=(t=e.exports={}).re=[],i=t.src=[],l=t.t={};let o=0;const c=(e,t,s)=>{const n=o++;a(n,t),l[e]=n,i[n]=t,r[n]=new RegExp(t,s?"g":void 0)};c("NUMERICIDENTIFIER","0|[1-9]\\d*"),c("NUMERICIDENTIFIERLOOSE","[0-9]+"),c("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),c("MAINVERSION",`(${i[l.NUMERICIDENTIFIER]})\\.(${i[l.NUMERICIDENTIFIER]})\\.(${i[l.NUMERICIDENTIFIER]})`),c("MAINVERSIONLOOSE",`(${i[l.NUMERICIDENTIFIERLOOSE]})\\.(${i[l.NUMERICIDENTIFIERLOOSE]})\\.(${i[l.NUMERICIDENTIFIERLOOSE]})`),c("PRERELEASEIDENTIFIER",`(?:${i[l.NUMERICIDENTIFIER]}|${i[l.NONNUMERICIDENTIFIER]})`),c("PRERELEASEIDENTIFIERLOOSE",`(?:${i[l.NUMERICIDENTIFIERLOOSE]}|${i[l.NONNUMERICIDENTIFIER]})`),c("PRERELEASE",`(?:-(${i[l.PRERELEASEIDENTIFIER]}(?:\\.${i[l.PRERELEASEIDENTIFIER]})*))`),c("PRERELEASELOOSE",`(?:-?(${i[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${i[l.PRERELEASEIDENTIFIERLOOSE]})*))`),c("BUILDIDENTIFIER","[0-9A-Za-z-]+"),c("BUILD",`(?:\\+(${i[l.BUILDIDENTIFIER]}(?:\\.${i[l.BUILDIDENTIFIER]})*))`),c("FULLPLAIN",`v?${i[l.MAINVERSION]}${i[l.PRERELEASE]}?${i[l.BUILD]}?`),c("FULL",`^${i[l.FULLPLAIN]}$`),c("LOOSEPLAIN",`[v=\\s]*${i[l.MAINVERSIONLOOSE]}${i[l.PRERELEASELOOSE]}?${i[l.BUILD]}?`),c("LOOSE",`^${i[l.LOOSEPLAIN]}$`),c("GTLT","((?:<|>)?=?)"),c("XRANGEIDENTIFIERLOOSE",`${i[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),c("XRANGEIDENTIFIER",`${i[l.NUMERICIDENTIFIER]}|x|X|\\*`),c("XRANGEPLAIN",`[v=\\s]*(${i[l.XRANGEIDENTIFIER]})(?:\\.(${i[l.XRANGEIDENTIFIER]})(?:\\.(${i[l.XRANGEIDENTIFIER]})(?:${i[l.PRERELEASE]})?${i[l.BUILD]}?)?)?`),c("XRANGEPLAINLOOSE",`[v=\\s]*(${i[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[l.XRANGEIDENTIFIERLOOSE]})(?:${i[l.PRERELEASELOOSE]})?${i[l.BUILD]}?)?)?`),c("XRANGE",`^${i[l.GTLT]}\\s*${i[l.XRANGEPLAIN]}$`),c("XRANGELOOSE",`^${i[l.GTLT]}\\s*${i[l.XRANGEPLAINLOOSE]}$`),c("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),c("COERCERTL",i[l.COERCE],!0),c("LONETILDE","(?:~>?)"),c("TILDETRIM",`(\\s*)${i[l.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",c("TILDE",`^${i[l.LONETILDE]}${i[l.XRANGEPLAIN]}$`),c("TILDELOOSE",`^${i[l.LONETILDE]}${i[l.XRANGEPLAINLOOSE]}$`),c("LONECARET","(?:\\^)"),c("CARETTRIM",`(\\s*)${i[l.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",c("CARET",`^${i[l.LONECARET]}${i[l.XRANGEPLAIN]}$`),c("CARETLOOSE",`^${i[l.LONECARET]}${i[l.XRANGEPLAINLOOSE]}$`),c("COMPARATORLOOSE",`^${i[l.GTLT]}\\s*(${i[l.LOOSEPLAIN]})$|^$`),c("COMPARATOR",`^${i[l.GTLT]}\\s*(${i[l.FULLPLAIN]})$|^$`),c("COMPARATORTRIM",`(\\s*)${i[l.GTLT]}\\s*(${i[l.LOOSEPLAIN]}|${i[l.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",c("HYPHENRANGE",`^\\s*(${i[l.XRANGEPLAIN]})\\s+-\\s+(${i[l.XRANGEPLAIN]})\\s*$`),c("HYPHENRANGELOOSE",`^\\s*(${i[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${i[l.XRANGEPLAINLOOSE]})\\s*$`),c("STAR","(<|>)?=?\\s*\\*"),c("GTE0","^\\s*>=\\s*0.0.0\\s*$"),c("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/gtr.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/outside.js");e.exports=(e,t,s)=>n(e,t,">",s)},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/intersects.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/range.js");e.exports=(e,t,s)=>(e=new n(e,s),t=new n(t,s),e.intersects(t))},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/ltr.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/outside.js");e.exports=(e,t,s)=>n(e,t,"<",s)},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/max-satisfying.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/semver.js"),a=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/range.js");e.exports=(e,t,s)=>{let r=null,i=null,l=null;try{l=new a(t,s)}catch(e){return null}return e.forEach((e=>{l.test(e)&&(r&&-1!==i.compare(e)||(r=e,i=new n(r,s)))})),r}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/min-satisfying.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/semver.js"),a=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/range.js");e.exports=(e,t,s)=>{let r=null,i=null,l=null;try{l=new a(t,s)}catch(e){return null}return e.forEach((e=>{l.test(e)&&(r&&1!==i.compare(e)||(r=e,i=new n(r,s)))})),r}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/min-version.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/semver.js"),a=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/range.js"),r=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/gt.js");e.exports=(e,t)=>{e=new a(e,t);let s=new n("0.0.0");if(e.test(s))return s;if(s=new n("0.0.0-0"),e.test(s))return s;s=null;for(let t=0;t<e.set.length;++t){const a=e.set[t];let i=null;a.forEach((e=>{const t=new n(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":i&&!r(t,i)||(i=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!i||s&&!r(s,i)||(s=i)}return s&&e.test(s)?s:null}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/outside.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/semver.js"),a=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/comparator.js"),{ANY:r}=a,i=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/range.js"),l=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/satisfies.js"),o=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/gt.js"),c=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/lt.js"),d=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/lte.js"),u=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/gte.js");e.exports=(e,t,s,m)=>{let p,h,v,g,f;switch(e=new n(e,m),t=new i(t,m),s){case">":p=o,h=d,v=c,g=">",f=">=";break;case"<":p=c,h=u,v=o,g="<",f="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(l(e,t,m))return!1;for(let s=0;s<t.set.length;++s){const n=t.set[s];let i=null,l=null;if(n.forEach((e=>{e.semver===r&&(e=new a(">=0.0.0")),i=i||e,l=l||e,p(e.semver,i.semver,m)?i=e:v(e.semver,l.semver,m)&&(l=e)})),i.operator===g||i.operator===f)return!1;if((!l.operator||l.operator===g)&&h(e,l.semver))return!1;if(l.operator===f&&v(e,l.semver))return!1}return!0}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/simplify.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/satisfies.js"),a=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare.js");e.exports=(e,t,s)=>{const r=[];let i=null,l=null;const o=e.sort(((e,t)=>a(e,t,s)));for(const e of o){n(e,t,s)?(l=e,i||(i=e)):(l&&r.push([i,l]),l=null,i=null)}i&&r.push([i,null]);const c=[];for(const[e,t]of r)e===t?c.push(e):t||e!==o[0]?t?e===o[0]?c.push(`<=${t}`):c.push(`${e} - ${t}`):c.push(`>=${e}`):c.push("*");const d=c.join(" || "),u="string"==typeof t.raw?t.raw:String(t);return d.length<u.length?d:t}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/subset.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/range.js"),a=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/comparator.js"),{ANY:r}=a,i=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/satisfies.js"),l=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/functions/compare.js"),o=(e,t,s)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===r){if(1===t.length&&t[0].semver===r)return!0;e=s.includePrerelease?[new a(">=0.0.0-0")]:[new a(">=0.0.0")]}if(1===t.length&&t[0].semver===r){if(s.includePrerelease)return!0;t=[new a(">=0.0.0")]}const n=new Set;let o,u,m,p,h,v,g;for(const t of e)">"===t.operator||">="===t.operator?o=c(o,t,s):"<"===t.operator||"<="===t.operator?u=d(u,t,s):n.add(t.semver);if(n.size>1)return null;if(o&&u){if(m=l(o.semver,u.semver,s),m>0)return null;if(0===m&&(">="!==o.operator||"<="!==u.operator))return null}for(const e of n){if(o&&!i(e,String(o),s))return null;if(u&&!i(e,String(u),s))return null;for(const n of t)if(!i(e,String(n),s))return!1;return!0}let f=!(!u||s.includePrerelease||!u.semver.prerelease.length)&&u.semver,b=!(!o||s.includePrerelease||!o.semver.prerelease.length)&&o.semver;f&&1===f.prerelease.length&&"<"===u.operator&&0===f.prerelease[0]&&(f=!1);for(const e of t){if(g=g||">"===e.operator||">="===e.operator,v=v||"<"===e.operator||"<="===e.operator,o)if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),">"===e.operator||">="===e.operator){if(p=c(o,e,s),p===e&&p!==o)return!1}else if(">="===o.operator&&!i(o.semver,String(e),s))return!1;if(u)if(f&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===f.major&&e.semver.minor===f.minor&&e.semver.patch===f.patch&&(f=!1),"<"===e.operator||"<="===e.operator){if(h=d(u,e,s),h===e&&h!==u)return!1}else if("<="===u.operator&&!i(u.semver,String(e),s))return!1;if(!e.operator&&(u||o)&&0!==m)return!1}return!(o&&v&&!u&&0!==m)&&(!(u&&g&&!o&&0!==m)&&(!b&&!f))},c=(e,t,s)=>{if(!e)return t;const n=l(e.semver,t.semver,s);return n>0?e:n<0||">"===t.operator&&">="===e.operator?t:e},d=(e,t,s)=>{if(!e)return t;const n=l(e.semver,t.semver,s);return n<0?e:n>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,s={})=>{if(e===t)return!0;e=new n(e,s),t=new n(t,s);let a=!1;e:for(const n of e.set){for(const e of t.set){const t=o(n,e,s);if(a=a||null!==t,t)continue e}if(a)return!1}return!0}},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/to-comparators.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/range.js");e.exports=(e,t)=>new n(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},"./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/ranges/valid.js":(e,t,s)=>{const n=s("./.yarn/cache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/classes/range.js");e.exports=(e,t)=>{try{return new n(e,t).range||"*"}catch(e){return null}}},"./.yarn/cache/yallist-npm-4.0.0-b493d9e907-343617202a.zip/node_modules/yallist/iterator.js":e=>{"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},"./.yarn/cache/yallist-npm-4.0.0-b493d9e907-343617202a.zip/node_modules/yallist/yallist.js":(e,t,s)=>{"use strict";function n(e){var t=this;if(t instanceof n||(t=new n),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var s=0,a=arguments.length;s<a;s++)t.push(arguments[s]);return t}function a(e,t,s){var n=t===e.head?new l(s,null,t,e):new l(s,t,t.next,e);return null===n.next&&(e.tail=n),null===n.prev&&(e.head=n),e.length++,n}function r(e,t){e.tail=new l(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function i(e,t){e.head=new l(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function l(e,t,s,n){if(!(this instanceof l))return new l(e,t,s,n);this.list=n,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,s?(s.prev=this,this.next=s):this.next=null}e.exports=n,n.Node=l,n.create=n,n.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,s=e.prev;return t&&(t.prev=s),s&&(s.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=s),e.list.length--,e.next=null,e.prev=null,e.list=null,t},n.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},n.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},n.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)r(this,arguments[e]);return this.length},n.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)i(this,arguments[e]);return this.length},n.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},n.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},n.prototype.forEach=function(e,t){t=t||this;for(var s=this.head,n=0;null!==s;n++)e.call(t,s.value,n,this),s=s.next},n.prototype.forEachReverse=function(e,t){t=t||this;for(var s=this.tail,n=this.length-1;null!==s;n--)e.call(t,s.value,n,this),s=s.prev},n.prototype.get=function(e){for(var t=0,s=this.head;null!==s&&t<e;t++)s=s.next;if(t===e&&null!==s)return s.value},n.prototype.getReverse=function(e){for(var t=0,s=this.tail;null!==s&&t<e;t++)s=s.prev;if(t===e&&null!==s)return s.value},n.prototype.map=function(e,t){t=t||this;for(var s=new n,a=this.head;null!==a;)s.push(e.call(t,a.value,this)),a=a.next;return s},n.prototype.mapReverse=function(e,t){t=t||this;for(var s=new n,a=this.tail;null!==a;)s.push(e.call(t,a.value,this)),a=a.prev;return s},n.prototype.reduce=function(e,t){var s,n=this.head;if(arguments.length>1)s=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");n=this.head.next,s=this.head.value}for(var a=0;null!==n;a++)s=e(s,n.value,a),n=n.next;return s},n.prototype.reduceReverse=function(e,t){var s,n=this.tail;if(arguments.length>1)s=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");n=this.tail.prev,s=this.tail.value}for(var a=this.length-1;null!==n;a--)s=e(s,n.value,a),n=n.prev;return s},n.prototype.toArray=function(){for(var e=new Array(this.length),t=0,s=this.head;null!==s;t++)e[t]=s.value,s=s.next;return e},n.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,s=this.tail;null!==s;t++)e[t]=s.value,s=s.prev;return e},n.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var s=new n;if(t<e||t<0)return s;e<0&&(e=0),t>this.length&&(t=this.length);for(var a=0,r=this.head;null!==r&&a<e;a++)r=r.next;for(;null!==r&&a<t;a++,r=r.next)s.push(r.value);return s},n.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var s=new n;if(t<e||t<0)return s;e<0&&(e=0),t>this.length&&(t=this.length);for(var a=this.length,r=this.tail;null!==r&&a>t;a--)r=r.prev;for(;null!==r&&a>e;a--,r=r.prev)s.push(r.value);return s},n.prototype.splice=function(e,t,...s){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var n=0,r=this.head;null!==r&&n<e;n++)r=r.next;var i=[];for(n=0;r&&n<t;n++)i.push(r.value),r=this.removeNode(r);null===r&&(r=this.tail),r!==this.head&&r!==this.tail&&(r=r.prev);for(n=0;n<s.length;n++)r=a(this,r,s[n]);return i},n.prototype.reverse=function(){for(var e=this.head,t=this.tail,s=e;null!==s;s=s.prev){var n=s.prev;s.prev=s.next,s.next=n}return this.head=t,this.tail=e,this};try{s("./.yarn/cache/yallist-npm-4.0.0-b493d9e907-343617202a.zip/node_modules/yallist/iterator.js")(n)}catch(e){}}}]);
//# sourceMappingURL=elasticsearchPlugin.07a78e2e5dfa22b54847.js.map